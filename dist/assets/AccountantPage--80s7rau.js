import{a as be,u as ge,m as ke,b as Ce,o as u,c as m,d as t,t as c,e as o,g as A,v as j,x as r,L as q,F as Q,r as W,P as xe,i as Y,f as G,j as V,A as J,a2 as ye,_ as De,k as d,D as B,O as Se,I as Ie,l as Fe,w as Ne,Q as K,B as $e,H as X,z as Z}from"../gn-invoice.js";import{_ as F,u as we}from"./SortableHeader-rArAiVJm.js";import{_ as Te,u as Me}from"./AppPagination-D5e3zrF_.js";import{_ as Ae}from"./PaymentBadges--3pmKKsT.js";import{_ as Le,I as Pe}from"./InvoiceActions-ZkZBOAub.js";import{_ as Ue}from"./EmptyState-C5htIWVL.js";const Ve={class:"page-header"},Be={class:"page-header__title"},Re={class:"page-header__subtitle",style:{margin:"0"}},Ee={class:"filter-bar"},He={class:"autocomplete",style:{flex:"1","min-width":"250px"}},ze=["placeholder"],Oe={value:""},je={value:"completed"},qe={value:"incomplete"},Qe={value:""},We=["value"],Ye=["innerHTML"],Ge={key:0},Je={key:1,class:"data-table-wrapper"},Ke={class:"data-table accountant-table"},Xe={class:"checkbox-cell"},Ze={class:"checkbox-cell"},et={class:"checkbox-cell"},tt={class:"checkbox-cell"},ot={class:"text-center"},st={class:"text-center"},lt=["onClick","href"],at={class:"text-truncate",style:{"max-width":"150px","font-weight":"500"}},nt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},ct={key:0,style:{"font-size":"var(--text-xs)"}},it={class:"checkbox-cell"},rt={class:"form-checkbox"},dt=["checked","onChange"],ut={class:"checkbox-cell"},mt={class:"form-checkbox"},ht=["checked","onChange"],ft={class:"checkbox-cell"},_t={class:"form-checkbox"},pt=["checked","onChange"],vt={class:"checkbox-cell"},bt={class:"form-checkbox"},gt=["checked","onChange"],kt={class:"text-center"},Ct=["onClick"],xt=["innerHTML"],yt={class:"text-center"},Dt={class:"accountant-note-modal"},St={key:0,style:{"margin-bottom":"var(--space-4)"}},It={class:"form-label"},Ft={class:"consultant-note"},Nt={class:"form-group"},$t={class:"form-label"},wt=["placeholder"],Bt={__name:"AccountantPage",setup(Tt){const ee=Fe(),i=be();ge();const te=ke(),{showToast:C}=Ie(),{t:l,tLabel:oe}=Ce(),{sortField:h,sortDir:x,toggleSort:se,sortItems:le}=we("createdAt","desc"),{currentPage:R,totalPages:ae,paginate:ne,resetPage:f}=Me(15),_=d(""),p=d(""),v=d(""),b=d(""),g=d(""),y=d(!1),k=d(null),N=d(""),D=d(!1),$=d(""),w=d("");let T=()=>{};const ce=B(()=>_.value||p.value||v.value||b.value||g.value);function E(s){return s.isRsUploaded&&s.isCreditChecked&&s.isReceiptChecked&&s.isCorrected}const H=B(()=>{let s=i.invoices.filter(e=>e.status==="standard");if(_.value){const e=_.value.toLowerCase();s=s.filter(n=>{const I=i.customerById(n.customerId);return n.number.toLowerCase().includes(e)||I&&I.name.toLowerCase().includes(e)||I&&I.taxId.includes(e)})}p.value&&(s=s.filter(e=>e.createdAt>=p.value)),v.value&&(s=s.filter(e=>e.createdAt<=v.value)),b.value==="completed"?s=s.filter(E):b.value==="incomplete"&&(s=s.filter(e=>!E(e))),g.value&&(s=s.filter(e=>e.payments.some(n=>n.method===g.value))),s=s.map(e=>{const n=i.customerById(e.customerId);return{...e,_customerName:n?n.name:"",_saleDate:e.soldDate||e.saleDate||""}});const a=h.value==="customer"?"_customerName":h.value==="saleDate"?"_saleDate":h.value;return le(s,a)}),z=B(()=>ne(H.value));function S(s){se(s),f()}const ie=Se(()=>f(),400);function re(){ie()}function de(){f()}function ue(){_.value="",p.value="",v.value="",b.value="",g.value="",f()}function me(s){const a=i.customerById(s);return a?a.name:"—"}function he(s){const a=i.customerById(s);return a?a.taxId:""}function L(s){return Math.max(0,s.totalAmount-s.paidAmount)}function O(s){te.setNavReturn("/accountant"),ee.push(`/invoices/${s}`)}function fe(s){$.value=l("msg.titleMarkSold"),w.value=l("msg.confirmMarkSold",{number:s.number}),T=()=>{const a=i.invoiceById(s.id);if(a){if(a.totalAmount-a.paidAmount>0){C("warning",l("msg.outstandingWarning",{number:a.number}));return}a.items.forEach(e=>{e.itemStatus!=="none"&&(e.itemStatus="sold")}),a.saleDate=a.saleDate||new Date().toISOString().split("T")[0],a.soldDate=a.soldDate||new Date().toISOString().split("T")[0],a.lifecycleStatus="sold",i.saveInvoice({...a}),C("success",l("msg.invoiceMarkedSold",{number:a.number}))}},D.value=!0}function _e(s){$.value=l("msg.titleDeleteInvoice"),w.value=l("msg.confirmDelete",{number:s.number}),T=()=>{i.deleteInvoice(s.id),C("success",l("msg.invoiceDeleted"))},D.value=!0}function M(s,a,e){const n=e.target.checked;e.target.checked=!n;const P={isRsUploaded:l("page.accountant.rsUploaded"),isCreditChecked:l("page.accountant.creditChecked"),isReceiptChecked:l("page.accountant.receiptChecked"),isCorrected:l("page.accountant.corrected")}[a];$.value=l("msg.titleEnableField",{action:l(n?"msg.enable":"msg.disable"),field:P}),w.value=l("msg.confirmFieldMark",{action:l(n?"msg.mark":"msg.unmark"),field:P,number:s.number}),T=()=>{const U=i.invoiceById(s.id);U&&(U[a]=n,i.saveInvoice({...U}),C("success",`${P} ${l(n?"msg.enabled":"msg.disabled")}`))},D.value=!0}function pe(s){k.value=s,N.value=s.accountantNote||"",y.value=!0}function ve(){if(k.value){const s=i.invoiceById(k.value.id);s&&(s.accountantNote=N.value,i.saveInvoice({...s}),C("success",l("msg.noteSaved")))}y.value=!1}return(s,a)=>(u(),m("div",null,[t("div",Ve,[t("div",null,[t("h1",Be,c(o(l)("page.accountant.title")),1),t("p",Re,c(o(l)("page.accountant.subtitle")),1)])]),t("div",Ee,[t("div",He,[A(t("input",{type:"text",class:"form-input form-input--search","onUpdate:modelValue":a[0]||(a[0]=e=>_.value=e),placeholder:o(l)("page.accountant.searchPlaceholder"),onInput:re},null,40,ze),[[j,_.value]])]),r(Le,{dateFrom:p.value,"onUpdate:dateFrom":a[1]||(a[1]=e=>p.value=e),dateTo:v.value,"onUpdate:dateTo":a[2]||(a[2]=e=>v.value=e),prefix:"acc",onChange:de},null,8,["dateFrom","dateTo"]),A(t("select",{class:"form-select","onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),onChange:a[4]||(a[4]=(...e)=>o(f)&&o(f)(...e)),style:{"min-width":"130px"}},[t("option",Oe,c(o(l)("filter.allStatus")),1),t("option",je,c(o(l)("filter.completed")),1),t("option",qe,c(o(l)("filter.incomplete")),1)],544),[[q,b.value]]),A(t("select",{class:"form-select","onUpdate:modelValue":a[5]||(a[5]=e=>g.value=e),onChange:a[6]||(a[6]=(...e)=>o(f)&&o(f)(...e)),style:{"min-width":"130px"}},[t("option",Qe,c(o(l)("filter.allTypes")),1),(u(!0),m(Q,null,W(o(xe),(e,n)=>(u(),m("option",{key:n,value:n},c(o(oe)(e)),9,We))),128))],544),[[q,g.value]]),ce.value?(u(),m("button",{key:0,class:"btn btn--ghost btn--sm",onClick:ue},[t("span",{innerHTML:o(Y)("x",14)},null,8,Ye),G(" "+c(o(l)("btn.reset")),1)])):V("",!0)]),z.value.length===0?(u(),m("div",Ge,[r(Ue,{title:o(l)("page.accountant.notFound"),message:o(l)("page.accountant.adjustFilters")},null,8,["title","message"])])):(u(),m("div",Je,[t("table",Ke,[t("thead",null,[t("tr",null,[r(F,{label:o(l)("col.invoiceNumber"),field:"number",sortField:o(h),sortDir:o(x),onSort:S},null,8,["label","sortField","sortDir"]),r(F,{label:o(l)("col.invoiceDate"),field:"createdAt",sortField:o(h),sortDir:o(x),onSort:S},null,8,["label","sortField","sortDir"]),r(F,{label:o(l)("col.soldDate"),field:"saleDate",sortField:o(h),sortDir:o(x),onSort:S},null,8,["label","sortField","sortDir"]),r(F,{label:o(l)("col.client"),field:"customer",sortField:o(h),sortDir:o(x),onSort:S},null,8,["label","sortField","sortDir"]),t("th",null,c(o(l)("col.payment")),1),r(F,{label:o(l)("col.total"),field:"totalAmount",sortField:o(h),sortDir:o(x),onSort:S},null,8,["label","sortField","sortDir"]),t("th",Xe,c(o(l)("col.rs")),1),t("th",Ze,c(o(l)("col.credit")),1),t("th",et,c(o(l)("col.receipt")),1),t("th",tt,c(o(l)("col.corrected")),1),t("th",ot,c(o(l)("col.notes")),1),t("th",st,c(o(l)("col.actions")),1)])]),t("tbody",null,[(u(!0),m(Q,null,W(z.value,e=>(u(),m("tr",{key:e.id},[t("td",null,[t("a",{onClick:Ne(n=>O(e.id),["prevent"]),href:`#/invoices/${e.id}`,style:{"font-weight":"600"}},c(e.number),9,lt)]),t("td",null,c(o(K)(e.createdAt)),1),t("td",null,c(o($e)(e).label==="Sold"?o(K)(e.soldDate||e.saleDate):"—"),1),t("td",null,[t("div",at,c(me(e.customerId)),1),t("div",nt,c(he(e.customerId)),1)]),t("td",null,[r(Ae,{payments:e.payments},null,8,["payments"])]),t("td",{class:X(L(e)>0?"text-danger font-semibold":"font-medium")},[G(c(o(Z)(e.totalAmount))+" ",1),L(e)>0?(u(),m("div",ct,"rem: "+c(o(Z)(L(e))),1)):V("",!0)],2),t("td",it,[t("label",rt,[t("input",{type:"checkbox",checked:e.isRsUploaded,onChange:n=>M(e,"isRsUploaded",n)},null,40,dt)])]),t("td",ut,[t("label",mt,[t("input",{type:"checkbox",checked:e.isCreditChecked,onChange:n=>M(e,"isCreditChecked",n)},null,40,ht)])]),t("td",ft,[t("label",_t,[t("input",{type:"checkbox",checked:e.isReceiptChecked,onChange:n=>M(e,"isReceiptChecked",n)},null,40,pt)])]),t("td",vt,[t("label",bt,[t("input",{type:"checkbox",checked:e.isCorrected,onChange:n=>M(e,"isCorrected",n)},null,40,gt)])]),t("td",kt,[t("button",{class:X(["accountant-note-btn",{"has-note":e.accountantNote||e.consultantNote}]),onClick:n=>pe(e)},[t("span",{innerHTML:o(Y)("message-square",16)},null,8,xt)],10,Ct)]),t("td",yt,[r(Pe,{invoice:e,onView:n=>O(e.id),onEdit:n=>s.$router.push(`/invoices/${e.id}/edit`),onMarkSold:n=>fe(e),onDelete:n=>_e(e)},null,8,["invoice","onView","onEdit","onMarkSold","onDelete"])])]))),128))])]),r(Te,{currentPage:o(R),totalPages:o(ae),total:H.value.length,onPageChange:a[7]||(a[7]=e=>R.value=e)},null,8,["currentPage","totalPages","total"])])),r(ye,{visible:y.value,"onUpdate:visible":a[10]||(a[10]=e=>y.value=e),title:`${o(l)("col.notes")} - ${k.value?.number||""}`},{footer:J(()=>[t("button",{class:"btn btn--secondary",onClick:a[9]||(a[9]=e=>y.value=!1)},c(o(l)("btn.cancel")),1),t("button",{class:"btn btn--primary",onClick:ve},c(o(l)("btn.save")),1)]),default:J(()=>[t("div",Dt,[k.value?.consultantNote?(u(),m("div",St,[t("label",It,c(o(l)("form.consultantNote")),1),t("div",Ft,c(k.value.consultantNote),1)])):V("",!0),t("div",Nt,[t("label",$t,c(o(l)("form.accountantNote")),1),A(t("textarea",{class:"form-textarea","onUpdate:modelValue":a[8]||(a[8]=e=>N.value=e),placeholder:o(l)("form.addNote")},null,8,wt),[[j,N.value]])])])]),_:1},8,["visible","title"]),r(De,{visible:D.value,"onUpdate:visible":a[11]||(a[11]=e=>D.value=e),title:$.value,message:w.value,onConfirm:o(T)},null,8,["visible","title","message","onConfirm"])]))}};export{Bt as default};
