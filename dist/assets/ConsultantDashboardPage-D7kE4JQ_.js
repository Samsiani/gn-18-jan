import{a as ee,u as te,m as ne,b as se,o as d,c as u,d as e,t as o,e as s,x as g,A as R,i as m,f as b,z as N,y as ae,F as U,r as Y,_ as oe,E as ie,k,D as y,l as le,H as z,j as re,B as F,w as ce,I as de,J as ue}from"../gn-invoice.js";import{_ as _e,I as ve}from"./InvoiceActions-ZkZBOAub.js";import{_ as pe}from"./AppBadge-BenmxPAy.js";import{_ as me}from"./SparklineChart-CSzQouGK.js";const ge={class:"page-header"},he={class:"page-header__title"},fe={class:"page-header__subtitle",style:{margin:"0"}},ke={class:"page-header__actions"},ye=["innerHTML"],be=["innerHTML"],Me={class:"filter-bar",style:{"margin-bottom":"var(--space-4)"}},Ie={class:"dashboard-grid"},Te={class:"kpi-card__top"},we={class:"kpi-card__label"},Se={class:"kpi-card__value"},De=["innerHTML"],Ae={class:"kpi-card__bottom"},$e={class:"kpi-card__change kpi-card__change--flat"},xe={class:"kpi-card__sparkline"},Ce={class:"kpi-card__top"},Le={class:"kpi-card__label"},He={class:"kpi-card__value"},Re=["innerHTML"],Ne={class:"kpi-card__bottom"},Fe={class:"kpi-card__change kpi-card__change--flat"},Be={class:"kpi-card__top"},Oe={class:"kpi-card__label"},Ee={class:"kpi-card__value"},Ve=["innerHTML"],Ue={class:"kpi-card__bottom"},Ye={key:0,class:"kpi-card__change kpi-card__change--down"},ze=["innerHTML"],je={key:1,class:"kpi-card__change kpi-card__change--flat"},Je={class:"kpi-card__top"},Pe={class:"kpi-card__label"},We={class:"kpi-card__value"},qe=["innerHTML"],Ge={class:"kpi-card__bottom"},Ke={class:"kpi-card__change kpi-card__change--flat"},Qe={class:"dashboard-bottom"},Xe={class:"card animate-fade-in-up",style:{"animation-delay":"250ms"}},Ze={class:"card__header"},et={class:"card__title"},tt=["innerHTML"],nt={class:"card__body"},st={key:0,style:{"text-align":"center",color:"var(--color-text-tertiary)",margin:"0"}},at=["onClick"],ot={style:{flex:"1"}},it={style:{"font-weight":"500",color:"var(--color-text-primary)"}},lt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},rt={key:0,class:"badge badge--danger"},ct={class:"card animate-fade-in-up",style:{"animation-delay":"300ms"}},dt={class:"card__header"},ut={class:"card__title"},_t=["innerHTML"],vt={class:"card__body",style:{padding:"0"}},pt={key:0,style:{"text-align":"center",color:"var(--color-text-tertiary)",padding:"var(--space-6)"}},mt={key:1,class:"data-table"},gt={class:"text-center",style:{width:"60px"}},ht=["onClick"],ft={class:"text-truncate",style:{"max-width":"150px"}},Tt={__name:"ConsultantDashboardPage",setup(kt){const j=le(),h=ee(),B=te(),J=ne(),{showToast:A}=de(),{t:i,tLabel:P}=se(),_=k(""),v=k(""),M=k(!1),$=k(""),x=k(""),C=k(!1);let L=()=>{};const H=y(()=>B.getMyInvoices(h.invoices)),f=y(()=>{let a=H.value;_.value&&(a=a.filter(r=>r.createdAt>=_.value)),v.value&&(a=a.filter(r=>r.createdAt<=v.value));const t=a.filter(r=>r.status==="standard"),l=t.reduce((r,p)=>r+p.paidAmount,0),n=t.filter(r=>F(r).label!=="Sold").reduce((r,p)=>r+Math.max(0,p.totalAmount-p.paidAmount),0),c=new Date,w=new Date(c.getFullYear(),c.getMonth(),1).toISOString().split("T")[0],S=a.filter(r=>r.createdAt>=w).length,V=[];for(let r=5;r>=0;r--){const p=new Date(c.getFullYear(),c.getMonth()-r,1),Q=new Date(p.getFullYear(),p.getMonth(),1).toISOString().split("T")[0],X=new Date(p.getFullYear(),p.getMonth()+1,0).toISOString().split("T")[0];V.push(t.filter(D=>D.createdAt>=Q&&D.createdAt<=X).reduce((D,Z)=>D+Z.paidAmount,0))}return{totalRevenue:l,totalInvoices:a.length,thisMonth:S,totalOutstanding:n,monthlyRevenue:V}}),I=y(()=>{const a=[];let t=H.value;return _.value&&(t=t.filter(l=>l.createdAt>=_.value)),v.value&&(t=t.filter(l=>l.createdAt<=v.value)),t.filter(l=>l.lifecycleStatus==="active").forEach(l=>{l.items.forEach(n=>{if(n.itemStatus==="reserved"&&n.reservationDays>0){const c=ue(l.createdAt,n.reservationDays),w=h.productById(n.productId),S=h.customerById(l.customerId);a.push({invoiceId:l.id,invoiceNumber:l.number,productName:w?w.name:i("common.unknown"),customerName:S?S.name:i("common.unknown"),daysRemaining:c,totalDays:n.reservationDays})}})}),a.sort((l,n)=>l.daysRemaining-n.daysRemaining)}),O=y(()=>I.value.filter(a=>a.daysRemaining<=3)),W=y(()=>{const a=f.value.monthlyRevenue;if(!a||a.length<2)return null;const t=a[a.length-2],l=a[a.length-1];return t?((l-t)/t*100).toFixed(1):null}),E=y(()=>{let a=H.value;return _.value&&(a=a.filter(t=>t.createdAt>=_.value)),v.value&&(a=a.filter(t=>t.createdAt<=v.value)),[...a].sort((t,l)=>new Date(l.createdAt)-new Date(t.createdAt)).slice(0,5)});function T(a,t){let l=a;const n=[];_.value&&n.push(`dateFrom=${_.value}`),v.value&&n.push(`dateTo=${v.value}`),n.length&&(l+=(l.includes("?")?"&":"?")+n.join("&")),t&&J.setDrilldownHighlight(t),j.push(l)}function q(a){const t=h.customerById(a);return t?t.name:"â€”"}function G(a){$.value=i("msg.titleMarkSold"),x.value=i("msg.confirmMarkSold",{number:a.number}),C.value=!1,L=()=>{const t=h.invoiceById(a.id);if(t){if(t.totalAmount-t.paidAmount>0){A("warning",i("msg.outstandingWarning",{number:t.number}));return}t.items.forEach(l=>{l.itemStatus!=="none"&&(l.itemStatus="sold")}),t.saleDate=t.saleDate||new Date().toISOString().split("T")[0],t.soldDate=t.soldDate||new Date().toISOString().split("T")[0],t.lifecycleStatus="sold",h.saveInvoice({...t}),A("success",i("msg.invoiceMarkedSold",{number:t.number}))}},M.value=!0}function K(a){$.value=i("msg.titleDeleteInvoice"),x.value=i("msg.confirmDelete",{number:a.number}),C.value=!0,L=()=>{h.deleteInvoice(a.id),A("success",i("msg.invoiceDeleted"))},M.value=!0}return(a,t)=>{const l=ie("router-link");return d(),u("div",null,[e("div",ge,[e("div",null,[e("h1",he,o(s(i)("page.consultant.welcome",{name:s(B).currentUser?.name||"Consultant"})),1),e("p",fe,o(s(i)("page.consultant.subtitle")),1)]),e("div",ke,[g(l,{to:"/stock",class:"btn btn--secondary"},{default:R(()=>[e("span",{innerHTML:s(m)("package",16)},null,8,ye),b(" "+o(s(i)("btn.viewStock")),1)]),_:1}),g(l,{to:"/invoices/new",class:"btn btn--primary"},{default:R(()=>[e("span",{innerHTML:s(m)("plus",16)},null,8,be),b(" "+o(s(i)("btn.newInvoice")),1)]),_:1})])]),e("div",Me,[g(_e,{dateFrom:_.value,"onUpdate:dateFrom":t[0]||(t[0]=n=>_.value=n),dateTo:v.value,"onUpdate:dateTo":t[1]||(t[1]=n=>v.value=n),prefix:"cons",onChange:()=>{}},null,8,["dateFrom","dateTo"])]),e("div",Ie,[e("div",{class:"card kpi-card animate-fade-in-up",style:{cursor:"pointer","animation-delay":"0ms"},onClick:t[2]||(t[2]=n=>T("/invoices","remaining"))},[e("div",Te,[e("div",null,[e("span",we,o(s(i)("page.consultant.myRevenue")),1),e("div",Se,o(s(N)(f.value.totalRevenue)),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--success",innerHTML:s(m)("dollar-sign")},null,8,De)]),e("div",Ae,[e("span",$e,o(s(i)("page.consultant.totalInvoices",{n:f.value.totalInvoices})),1),e("div",xe,[g(me,{data:s(ae)(W.value),color:"#16a34a"},null,8,["data"])])])]),e("div",{class:"card kpi-card animate-fade-in-up",style:{cursor:"pointer","animation-delay":"50ms"},onClick:t[3]||(t[3]=n=>T("/invoices","number"))},[e("div",Ce,[e("div",null,[e("span",Le,o(s(i)("page.consultant.myInvoices")),1),e("div",He,o(f.value.totalInvoices),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--primary",innerHTML:s(m)("file-text")},null,8,Re)]),e("div",Ne,[e("span",Fe,o(s(i)("page.consultant.thisMonth",{n:f.value.thisMonth})),1),t[8]||(t[8]=e("div",{class:"kpi-card__sparkline"},null,-1))])]),e("div",{class:"card kpi-card animate-fade-in-up",style:{cursor:"pointer","animation-delay":"100ms"},onClick:t[4]||(t[4]=n=>T("/invoices?filter=reserved","lifecycle"))},[e("div",Be,[e("div",null,[e("span",Oe,o(s(i)("page.consultant.myReservations")),1),e("div",Ee,o(I.value.length),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--warning",innerHTML:s(m)("clock")},null,8,Ve)]),e("div",Ue,[O.value.length>0?(d(),u("span",Ye,[e("span",{innerHTML:s(m)("alert-triangle",12)},null,8,ze),b(" "+o(s(i)("page.consultant.expiringSoon",{n:O.value.length})),1)])):(d(),u("span",je,o(s(i)("page.consultant.activeReservations")),1)),t[9]||(t[9]=e("div",{class:"kpi-card__sparkline"},null,-1))])]),e("div",{class:"card kpi-card animate-fade-in-up",style:{cursor:"pointer","animation-delay":"150ms"},onClick:t[5]||(t[5]=n=>T("/invoices?filter=outstanding","remaining"))},[e("div",Je,[e("div",null,[e("span",Pe,o(s(i)("page.consultant.outstanding")),1),e("div",We,o(s(N)(f.value.totalOutstanding)),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--danger",innerHTML:s(m)("wallet")},null,8,qe)]),e("div",Ge,[e("span",Ke,o(s(i)("page.consultant.pendingCollection")),1),t[10]||(t[10]=e("div",{class:"kpi-card__sparkline"},null,-1))])])]),e("div",Qe,[e("div",Xe,[e("div",Ze,[e("h3",et,[e("span",{innerHTML:s(m)("alert-triangle",18)},null,8,tt),b(" "+o(s(i)("page.consultant.expiringTitle")),1)])]),e("div",nt,[I.value.length===0?(d(),u("p",st,o(s(i)("page.consultant.noReservations")),1)):(d(!0),u(U,{key:1},Y(I.value,n=>(d(),u("div",{key:n.invoiceId+"-"+n.productName,class:z(["reservation-alert",{"reservation-alert--urgent":n.daysRemaining<=3}]),style:{cursor:"pointer"},onClick:c=>a.$router.push(`/invoices/${n.invoiceId}`)},[e("span",{class:z(["reservation-alert__days",{"text-danger":n.daysRemaining<=3}])},o(s(i)("common.daysLeft",{n:n.daysRemaining})),3),e("div",ot,[e("div",it,o(n.productName),1),e("div",lt,o(n.invoiceNumber)+" - "+o(n.customerName),1)]),n.daysRemaining<=3?(d(),u("span",rt,o(s(i)("common.urgent")),1)):re("",!0)],10,at))),128))])]),e("div",ct,[e("div",dt,[e("h3",ut,o(s(i)("page.consultant.recentInvoices")),1),g(l,{to:"/invoices",class:"btn btn--ghost btn--sm"},{default:R(()=>[b(o(s(i)("btn.viewAll"))+" ",1),e("span",{innerHTML:s(m)("chevron-right",14)},null,8,_t)]),_:1})]),e("div",vt,[E.value.length===0?(d(),u("p",pt,o(s(i)("page.consultant.noInvoices")),1)):(d(),u("table",mt,[e("thead",null,[e("tr",null,[e("th",null,o(s(i)("col.invoiceNumber")),1),e("th",null,o(s(i)("col.customer")),1),e("th",null,o(s(i)("col.total")),1),e("th",null,o(s(i)("col.status")),1),e("th",gt,o(s(i)("col.actions")),1)])]),e("tbody",null,[(d(!0),u(U,null,Y(E.value,n=>(d(),u("tr",{key:n.id,style:{cursor:"pointer"},onClick:c=>a.$router.push(`/invoices/${n.id}`)},[e("td",null,[e("strong",null,o(n.number),1)]),e("td",ft,o(q(n.customerId)),1),e("td",null,o(s(N)(n.totalAmount)),1),e("td",null,[g(pe,{label:s(P)(s(F)(n)),color:s(F)(n).color,dot:!0},null,8,["label","color"])]),e("td",{class:"text-center",onClick:t[6]||(t[6]=ce(()=>{},["stop"]))},[g(ve,{invoice:n,onView:c=>a.$router.push(`/invoices/${n.id}`),onEdit:c=>a.$router.push(`/invoices/${n.id}/edit`),onMarkSold:c=>G(n),onDelete:c=>K(n)},null,8,["invoice","onView","onEdit","onMarkSold","onDelete"])])],8,ht))),128))])]))])])]),g(oe,{visible:M.value,"onUpdate:visible":t[7]||(t[7]=n=>M.value=n),title:$.value,message:x.value,danger:C.value,onConfirm:s(L)},null,8,["visible","title","message","danger","onConfirm"])])}}};export{Tt as default};
