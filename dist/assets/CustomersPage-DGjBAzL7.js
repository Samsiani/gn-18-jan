import{a as X,m as Z,b as tt,p as et,o as r,c as d,d as t,t as o,e,i as x,g as st,v as ot,x as c,F as $,r as H,A as V,f as D,j as S,z as y,k as F,D as v,O as at,l as lt,H as N,w as B,Q as nt,B as E}from"../gn-invoice.js";import{_ as b,u as it}from"./SortableHeader-rArAiVJm.js";import{_ as rt,u as dt}from"./AppPagination-D5e3zrF_.js";import{_ as ct}from"./AppBadge-BenmxPAy.js";import{_ as ut}from"./SlidePanel-C0PmUBV1.js";import{_ as mt,I as _t}from"./InvoiceActions-ZkZBOAub.js";import{_ as vt}from"./EmptyState-C5htIWVL.js";const pt={class:"page-header"},ht={class:"page-header__title"},ft={class:"page-header__subtitle",style:{margin:"0"}},gt={class:"filter-bar",style:{"margin-bottom":"var(--space-4)"}},xt={style:{position:"relative",flex:"1","min-width":"280px"}},yt=["innerHTML"],bt=["placeholder"],Ct={key:0},Dt={key:1,class:"data-table-wrapper"},Ft={class:"data-table"},It={class:"text-center",style:{width:"60px"}},Tt=["onClick"],St={style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},wt={class:"sidebar__user-avatar",style:{width:"32px",height:"32px","font-size":"var(--text-xs)"}},kt={class:"font-medium"},Lt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},zt={style:{"font-size":"var(--text-sm)"}},Mt={style:{"font-size":"var(--text-sm)"}},Pt={style:{"font-size":"var(--text-sm)"}},At={class:"font-medium"},$t={class:"text-center"},Ht=["onClick"],Vt=["innerHTML"],Nt={key:0,class:"customer-detail"},Bt={class:"customer-detail__header"},Et={class:"customer-detail__avatar"},Rt={class:"customer-detail__name"},Ut={style:{"font-size":"var(--text-sm)",color:"var(--color-text-tertiary)"}},jt={style:{"font-size":"var(--text-sm)",color:"var(--color-text-tertiary)"}},Ot={style:{"margin-bottom":"var(--space-4)"}},Qt={style:{"font-size":"var(--text-sm)",color:"var(--color-text-secondary)","margin-bottom":"2px"}},qt=["innerHTML"],Yt=["href"],Gt=["innerHTML"],Jt=["href"],Kt=["innerHTML"],Wt={class:"customer-detail__stats"},Xt={class:"customer-detail__stat"},Zt={class:"customer-detail__stat-value"},te={class:"customer-detail__stat-label"},ee={class:"customer-detail__stat"},se={class:"customer-detail__stat-value"},oe={class:"customer-detail__stat-label"},ae={class:"customer-detail__stat"},le={class:"customer-detail__stat-value text-danger"},ne={class:"customer-detail__stat-label"},ie={style:{"margin-bottom":"var(--space-3)","font-size":"var(--text-md)"}},re={key:0,style:{color:"var(--color-text-tertiary)","font-size":"var(--text-sm)"}},de={key:1,class:"data-table",style:{"font-size":"var(--text-sm)"}},ce=["onClick","href"],ue={class:"text-center"},ye={__name:"CustomersPage",setup(me){const R=lt(),I=X(),w=Z(),{t:n,tLabel:U}=tt(),{sortField:p,sortDir:h,toggleSort:j,sortItems:O}=it("totalSpent","desc"),{currentPage:k,totalPages:Q,paginate:q,resetPage:L}=dt(15),C=F(""),u=F(null),m=F(""),_=F(""),z=v(()=>{let l=[...I.customers];if(C.value){const a=C.value.toLowerCase();l=l.filter(s=>s.name.toLowerCase().includes(a)||s.nameEn.toLowerCase().includes(a)||s.taxId.includes(a)||s.phone.includes(a)||s.email.toLowerCase().includes(a))}return O(l)}),M=v(()=>q(z.value)),i=v(()=>u.value?I.customerById(u.value):null),f=v(()=>{if(!u.value)return[];let l=I.invoices.filter(a=>a.customerId===u.value);return m.value&&(l=l.filter(a=>a.createdAt>=m.value)),_.value&&(l=l.filter(a=>a.createdAt<=_.value)),l.sort((a,s)=>new Date(s.createdAt)-new Date(a.createdAt))}),Y=v(()=>f.value.reduce((l,a)=>l+a.paidAmount,0)),G=v(()=>f.value.reduce((l,a)=>l+Math.max(0,a.totalAmount-a.paidAmount),0)),J=at(()=>L(),400);function K(){J()}function g(l){j(l),L()}function P(l){u.value=l}function W(){u.value=null,m.value="",_.value=""}function A(l){w.setNavReturn("/customers",{selectedCustomerId:u.value,panelDateFilter:{dateFrom:m.value,dateTo:_.value}}),R.push(`/invoices/${l}`)}return et(()=>{const l=w.consumePageRestore();l&&l.selectedCustomerId&&(u.value=l.selectedCustomerId,l.panelDateFilter&&(m.value=l.panelDateFilter.dateFrom||"",_.value=l.panelDateFilter.dateTo||""))}),(l,a)=>(r(),d("div",null,[t("div",pt,[t("div",null,[t("h1",ht,o(e(n)("page.customers.title")),1),t("p",ft,o(e(n)("page.customers.subtitle")),1)])]),t("div",gt,[t("div",xt,[t("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--color-text-tertiary)"},innerHTML:e(x)("search",16)},null,8,yt),st(t("input",{type:"text",class:"form-input form-input--search","onUpdate:modelValue":a[0]||(a[0]=s=>C.value=s),onInput:K,placeholder:e(n)("page.customers.searchPlaceholder"),style:{"padding-left":"36px"}},null,40,bt),[[ot,C.value]])])]),M.value.length===0?(r(),d("div",Ct,[c(vt,{title:e(n)("page.customers.notFound"),message:e(n)("page.customers.adjustSearch")},null,8,["title","message"])])):(r(),d("div",Dt,[t("table",Ft,[t("thead",null,[t("tr",null,[c(b,{label:e(n)("col.name"),field:"name",sortField:e(p),sortDir:e(h),onSort:g},null,8,["label","sortField","sortDir"]),c(b,{label:e(n)("col.taxId"),field:"taxId",sortField:e(p),sortDir:e(h),onSort:g},null,8,["label","sortField","sortDir"]),t("th",null,o(e(n)("col.phone")),1),t("th",null,o(e(n)("col.email")),1),c(b,{label:e(n)("col.totalSpent"),field:"totalSpent",sortField:e(p),sortDir:e(h),onSort:g},null,8,["label","sortField","sortDir"]),c(b,{label:e(n)("col.invoices"),field:"invoiceCount",sortField:e(p),sortDir:e(h),onSort:g},null,8,["label","sortField","sortDir"]),c(b,{label:e(n)("col.outstanding"),field:"outstanding",sortField:e(p),sortDir:e(h),onSort:g},null,8,["label","sortField","sortDir"]),t("th",It,o(e(n)("col.actions")),1)])]),t("tbody",null,[(r(!0),d($,null,H(M.value,s=>(r(),d("tr",{key:s.id,class:N(["customer-row",{selected:u.value===s.id}]),onClick:T=>P(s.id)},[t("td",null,[t("div",St,[t("div",wt,o(s.name.charAt(0))+o(s.name.includes(" ")?s.name.split(" ").pop().charAt(0):""),1),t("div",null,[t("div",kt,o(s.name),1),t("div",Lt,o(s.nameEn),1)])])]),t("td",zt,o(s.taxId),1),t("td",Mt,o(s.phone),1),t("td",Pt,o(s.email),1),t("td",At,o(e(y)(s.totalSpent)),1),t("td",null,o(s.invoiceCount),1),t("td",{class:N(s.outstanding>0?"text-danger font-semibold":"")},o(e(y)(s.outstanding)),3),t("td",$t,[t("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:B(T=>P(s.id),["stop"]),"data-tooltip":"View details"},[t("span",{innerHTML:e(x)("eye",14)},null,8,Vt)],8,Ht)])],10,Tt))),128))])]),c(rt,{currentPage:e(k),totalPages:e(Q),total:z.value.length,onPageChange:a[1]||(a[1]=s=>k.value=s)},null,8,["currentPage","totalPages","total"])])),c(ut,{visible:!!u.value,onClose:W,size:"lg"},{header:V(()=>[D(o(e(n)("page.customers.panelHeader")),1)]),default:V(()=>[i.value?(r(),d("div",Nt,[t("div",Bt,[t("div",Et,o(i.value.name.charAt(0)),1),t("div",null,[t("div",Rt,o(i.value.name),1),t("div",Ut,o(i.value.nameEn),1),t("div",jt,o(e(n)("col.taxId"))+": "+o(i.value.taxId),1)])]),t("div",Ot,[t("div",Qt,[t("span",{innerHTML:e(x)("building",14)},null,8,qt),D(" "+o(i.value.address),1)]),i.value.phone?(r(),d("a",{key:0,href:`tel:${i.value.phone}`,style:{display:"flex","align-items":"center",gap:"6px","font-size":"var(--text-sm)",color:"var(--color-text-secondary)","text-decoration":"none","margin-bottom":"2px"}},[t("span",{innerHTML:e(x)("phone",14)},null,8,Gt),D(o(i.value.phone),1)],8,Yt)):S("",!0),i.value.email?(r(),d("a",{key:1,href:`mailto:${i.value.email}`,style:{display:"flex","align-items":"center",gap:"6px","font-size":"var(--text-sm)",color:"var(--color-text-secondary)","text-decoration":"none"}},[t("span",{innerHTML:e(x)("mail",14)},null,8,Kt),D(o(i.value.email),1)],8,Jt)):S("",!0)]),t("div",Wt,[t("div",Xt,[t("div",Zt,o(e(y)(Y.value)),1),t("div",te,o(e(n)("page.customers.totalPaid")),1)]),t("div",ee,[t("div",se,o(f.value.length),1),t("div",oe,o(e(n)("col.invoices")),1)]),t("div",ae,[t("div",le,o(e(y)(G.value)),1),t("div",ne,o(e(n)("col.outstanding")),1)])]),t("h4",ie,o(e(n)("section.invoiceHistory")),1),c(mt,{dateFrom:m.value,"onUpdate:dateFrom":a[2]||(a[2]=s=>m.value=s),dateTo:_.value,"onUpdate:dateTo":a[3]||(a[3]=s=>_.value=s),prefix:"cust-panel",onChange:()=>{}},null,8,["dateFrom","dateTo"]),a[5]||(a[5]=t("div",{style:{"margin-bottom":"var(--space-4)"}},null,-1)),f.value.length===0?(r(),d("p",re,o(e(n)("page.customers.noInvoices")),1)):(r(),d("table",de,[t("thead",null,[t("tr",null,[t("th",null,o(e(n)("col.invoiceNumber")),1),t("th",null,o(e(n)("col.date")),1),t("th",null,o(e(n)("col.total")),1),t("th",null,o(e(n)("col.status")),1),a[4]||(a[4]=t("th",{class:"text-center",style:{width:"40px"}},null,-1))])]),t("tbody",null,[(r(!0),d($,null,H(f.value,s=>(r(),d("tr",{key:s.id},[t("td",null,[t("a",{onClick:B(T=>A(s.id),["prevent"]),href:`#/invoices/${s.id}`,class:"font-medium"},o(s.number),9,ce)]),t("td",null,o(e(nt)(s.createdAt)),1),t("td",null,o(e(y)(s.totalAmount)),1),t("td",null,[c(ct,{label:e(U)(e(E)(s)),color:e(E)(s).color,dot:!0},null,8,["label","color"])]),t("td",ue,[c(_t,{compact:"",invoice:s,onView:T=>A(s.id)},null,8,["invoice","onView"])])]))),128))])]))])):S("",!0)]),_:1},8,["visible"])]))}};export{ye as default};
