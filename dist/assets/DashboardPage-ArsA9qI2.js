import{a as Ce,u as Me,m as Te,b as we,p as Se,q as De,s as ne,o as y,c as C,d as e,t as s,e as n,x as h,i as v,y as R,f as se,z as f,F as Z,r as J,A as Pe,_ as Ie,B as M,C as K,k as T,D as x,E as xe,l as Le,G as $e,P as oe,H as He,w as Re,I as Ae,J as Ne}from"../gn-invoice.js";import{_ as ie,u as le}from"./AppPagination-D5e3zrF_.js";import{_ as Ee,I as Be}from"./InvoiceActions-ZkZBOAub.js";import{_ as re}from"./AppBadge-BenmxPAy.js";import{_ as A}from"./SparklineChart-CSzQouGK.js";import{C as N}from"./auto-sRkgK8jz.js";const Fe={class:"page-header"},Oe={class:"page-header__title"},Ve={class:"page-header__subtitle",style:{margin:"0"}},Ue={class:"filter-bar",style:{"margin-bottom":"var(--space-4)"}},Ye={class:"kpi-grid"},qe={class:"kpi-card__top"},ze={class:"kpi-card__label"},We={class:"kpi-card__value"},je=["innerHTML"],Ge={class:"kpi-card__bottom"},Ze=["innerHTML"],Je={class:"kpi-card__sparkline"},Ke={class:"kpi-card__top"},Qe={class:"kpi-card__label"},Xe={class:"kpi-card__value"},ea=["innerHTML"],aa={class:"kpi-card__bottom"},ta={class:"kpi-card__change kpi-card__change--flat"},na=["innerHTML"],sa={class:"kpi-card__top"},oa={class:"kpi-card__label"},ia={class:"kpi-card__value"},la=["innerHTML"],ra={class:"kpi-card__bottom"},ca=["innerHTML"],da={class:"kpi-card__sparkline"},ua={class:"kpi-card__top"},_a={class:"kpi-card__label"},pa={class:"kpi-card__value"},ma=["innerHTML"],ha={class:"kpi-card__bottom"},va=["innerHTML"],ga={class:"kpi-card__sparkline"},fa={class:"kpi-card__top"},ka={class:"kpi-card__label"},ba={class:"kpi-card__value"},ya=["innerHTML"],Ca={class:"kpi-card__bottom"},Ma=["innerHTML"],Ta={class:"kpi-card__sparkline"},wa=["onClick"],Sa={class:"kpi-card__top"},Da={class:"kpi-card__label"},Pa={class:"kpi-card__value"},Ia=["innerHTML"],xa={class:"kpi-card__bottom"},La={class:"kpi-card__change kpi-card__change--flat"},$a={class:"dashboard-charts"},Ha={class:"card animate-fade-in-up",style:{"animation-delay":"200ms"}},Ra={class:"card__header"},Aa={class:"card__title"},Na={class:"chart-container"},Ea={class:"card animate-fade-in-up",style:{"animation-delay":"250ms"}},Ba={class:"card__header"},Fa={class:"card__title"},Oa={class:"chart-container"},Va={class:"dashboard-bottom"},Ua={class:"card animate-fade-in-up",style:{"animation-delay":"300ms"}},Ya={class:"card__header"},qa={class:"card__title"},za=["innerHTML"],Wa={class:"card__body",style:{padding:"0"}},ja={class:"data-table"},Ga={class:"text-center",style:{width:"60px"}},Za=["onClick"],Ja={class:"text-truncate",style:{"max-width":"150px"}},Ka={class:"card animate-fade-in-up",style:{"animation-delay":"350ms"}},Qa={class:"card__header"},Xa={class:"card__title"},et={class:"card__body",style:{padding:"0"}},at={key:0,style:{"text-align":"center",color:"var(--color-text-tertiary)",margin:"0",padding:"var(--space-5) var(--space-6)"}},tt={key:1,class:"data-table"},nt={class:"text-center"},st={class:"text-truncate",style:{"max-width":"140px"}},ot={class:"text-truncate",style:{"max-width":"120px"}},it={class:"text-center"},mt={__name:"DashboardPage",setup(lt){const ce=Le(),u=Ce();Me();const Q=Te(),{showToast:E}=Ae(),{t:i,tLabel:B,locale:de}=we(),k=T(""),b=T(""),F=T(null),O=T(null);let L=[];const ue={cash:{iconColor:"success",iconName:"dollar-sign",delay:200},company_transfer:{iconColor:"primary",iconName:"credit-card",delay:240},credit:{iconColor:"info",iconName:"trending-up",delay:280},consignment:{iconColor:"warning",iconName:"package",delay:320},other:{iconColor:"danger",iconName:"info",delay:360}},$=T(!1),V=T(""),U=T(""),Y=T(!1);let q=()=>{};const m=x(()=>{let l=u.invoices;k.value&&(l=l.filter(r=>r.createdAt>=k.value)),b.value&&(l=l.filter(r=>r.createdAt<=b.value));const a=l.filter(r=>r.status==="standard"),c=a.filter(r=>M(r).label!=="Canceled"),t=c.reduce((r,_)=>r+K(_),0),d=a.length,g=l.filter(r=>M(r).label==="Reserved").length,S=c.filter(r=>M(r).label!=="Sold").reduce((r,_)=>r+Math.max(0,K(_)-_.paidAmount),0),D={cash:0,company_transfer:0,credit:0,consignment:0,other:0};let P=0;u.invoices.filter(r=>r.status==="standard"&&M(r).label!=="Canceled").forEach(r=>{r.payments.forEach(_=>{k.value&&_.date<k.value||b.value&&_.date>b.value||(_.method in D&&(D[_.method]+=_.amount),_.method!=="consignment"&&(P+=_.amount))})});const o=u.getMonthlyTrend(6),p=u.getMonthOverMonthChange(d,o.map(r=>r.count)),I=u.getMonthOverMonthChange(t,o.map(r=>r.revenue)),j=u.getMonthOverMonthChange(P,o.map(r=>r.paid)),G=u.getMonthOverMonthChange(S,o.map(r=>r.outstanding));return{totalInvoices:d,pendingReservations:g,grossRevenue:t,totalPaid:P,outstandingBalance:S,methodTotals:D,trend:o,invoicesChange:p,revenueChange:I,paidChange:j,outstandingChange:G}}),X=x(()=>[...u.invoices].sort((l,a)=>new Date(a.createdAt)-new Date(l.createdAt))),{currentPage:ee,totalPages:_e,paginate:pe}=le(10),me=x(()=>pe(X.value)),z=x(()=>{const l=[];return u.invoices.filter(a=>a.lifecycleStatus==="active").forEach(a=>{a.items.forEach(c=>{if(c.itemStatus==="reserved"&&c.reservationDays>0){const t=Ne(a.createdAt,c.reservationDays),d=u.productById(c.productId),g=u.customerById(a.customerId);l.push({invoiceNumber:a.number,productName:d?d.name:i("common.unknown"),sku:d&&d.sku||"—",customerName:g?g.name:i("common.unknown"),daysRemaining:t,totalDays:c.reservationDays})}})}),l.sort((a,c)=>a.daysRemaining-c.daysRemaining)}),{currentPage:ae,totalPages:he,paginate:ve}=le(10),ge=x(()=>ve(z.value));function H(l){if(l===null)return'<span class="kpi-card__change kpi-card__change--flat">—</span>';const a=parseFloat(l);return a>0?`<span class="kpi-card__change kpi-card__change--up">${v("trending-up",12)} +${l}%</span>`:a<0?`<span class="kpi-card__change kpi-card__change--down">${v("trending-down",12)} ${l}%</span>`:'<span class="kpi-card__change kpi-card__change--flat">0%</span>'}function w(l,a){let c=l;const t=[];k.value&&t.push(`dateFrom=${k.value}`),b.value&&t.push(`dateTo=${b.value}`),t.length&&(c+=(c.includes("?")?"&":"?")+t.join("&")),a?Q.setDrilldownHighlight(a):l.includes("paymentMethod=")&&Q.setDrilldownHighlight("payment"),ce.push(c)}function fe(l){const a=u.customerById(l);return a?a.name:"—"}function ke(l){V.value=i("msg.titleMarkSold"),U.value=i("msg.confirmMarkSold",{number:l.number}),Y.value=!1,q=()=>{const a=u.invoiceById(l.id);if(a){if(a.totalAmount-a.paidAmount>0){E("warning",i("msg.outstandingWarning",{number:a.number}));return}a.items.forEach(c=>{c.itemStatus!=="none"&&(c.itemStatus="sold")}),a.saleDate=a.saleDate||new Date().toISOString().split("T")[0],a.soldDate=a.soldDate||new Date().toISOString().split("T")[0],a.lifecycleStatus="sold",u.saveInvoice({...a}),E("success",i("msg.invoiceMarkedSold",{number:a.number}))}},$.value=!0}function be(l){V.value=i("msg.titleDeleteInvoice"),U.value=i("msg.confirmDelete",{number:l.number}),Y.value=!0,q=()=>{u.deleteInvoice(l.id),E("success",i("msg.invoiceDeleted"))},$.value=!0}function W(){te();const l=getComputedStyle(document.documentElement),a=l.getPropertyValue("--color-primary").trim()||"#4f46e5",c=l.getPropertyValue("--color-text-secondary").trim()||"#475569",t=l.getPropertyValue("--color-border").trim()||"#e2e8f0";N.defaults.font.family="'FiraGO', sans-serif",N.defaults.color=c;const d=new Date,g=[];for(let o=5;o>=0;o--){const p=new Date(d.getFullYear(),d.getMonth()-o,1),I=p.toLocaleDateString("en",{month:"short",year:"2-digit"}),j=new Date(p.getFullYear(),p.getMonth(),1).toISOString().split("T")[0],G=new Date(p.getFullYear(),p.getMonth()+1,0).toISOString().split("T")[0],r=u.invoices.filter(_=>_.status==="standard"&&M(_).label!=="Canceled"&&_.createdAt>=j&&_.createdAt<=G).reduce((_,ye)=>_+K(ye),0);g.push({label:I,value:r})}F.value&&L.push(new N(F.value,{type:"bar",data:{labels:g.map(o=>o.label),datasets:[{label:i("chart.revenue"),data:g.map(o=>o.value),backgroundColor:a+"cc",borderColor:a,borderWidth:1,borderRadius:6,borderSkipped:!1,barPercentage:.6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:o=>f(o.raw)}}},scales:{y:{beginAtZero:!0,grid:{color:t+"80"},ticks:{callback:o=>f(o)}},x:{grid:{display:!1}}}}}));const S={};u.invoices.filter(o=>o.status==="standard"&&M(o).label!=="Canceled").forEach(o=>{o.items.forEach(p=>{S[p.productId]=(S[p.productId]||0)+p.qty*p.price})});const D=Object.entries(S).map(([o,p])=>{const I=u.productById(parseInt(o));return{name:I?I.name:i("common.unknown"),revenue:p}}).sort((o,p)=>p.revenue-o.revenue).slice(0,5),P=[a,"#16a34a","#f59e0b","#0ea5e9","#dc2626"];O.value&&L.push(new N(O.value,{type:"bar",data:{labels:D.map(o=>o.name.length>20?o.name.slice(0,20)+"...":o.name),datasets:[{label:i("chart.revenue"),data:D.map(o=>o.revenue),backgroundColor:P.map(o=>o+"cc"),borderColor:P,borderWidth:1,borderRadius:6,borderSkipped:!1,barPercentage:.6}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:o=>f(o.raw)}}},scales:{x:{beginAtZero:!0,grid:{color:t+"80"},ticks:{callback:o=>f(o)}},y:{grid:{display:!1}}}}}))}function te(){L.forEach(l=>l.destroy()),L=[]}return Se(()=>W()),De(()=>te()),ne(()=>u.theme,()=>{W()}),ne(de,()=>{W()}),(l,a)=>{const c=xe("router-link");return y(),C("div",null,[e("div",Fe,[e("div",null,[e("h1",Oe,s(n(i)("page.dashboard.title")),1),e("p",Ve,s(n(i)("page.dashboard.subtitle")),1)])]),e("div",Ue,[h(Ee,{dateFrom:k.value,"onUpdate:dateFrom":a[0]||(a[0]=t=>k.value=t),dateTo:b.value,"onUpdate:dateTo":a[1]||(a[1]=t=>b.value=t),prefix:"dash",onChange:()=>{}},null,8,["dateFrom","dateTo"])]),e("div",Ye,[e("div",{class:"card kpi-card animate-fade-in-up",onClick:a[2]||(a[2]=t=>w("/invoices?filter=standard")),style:{cursor:"pointer","animation-delay":"0ms"}},[e("div",qe,[e("div",null,[e("span",ze,s(n(i)("page.dashboard.standardInvoices")),1),e("div",We,s(m.value.totalInvoices),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--primary",innerHTML:n(v)("file-text")},null,8,je)]),e("div",Ge,[e("span",{innerHTML:H(m.value.invoicesChange)},null,8,Ze),e("div",Je,[h(A,{data:n(R)(m.value.invoicesChange),color:"#4f46e5"},null,8,["data"])])])]),e("div",{class:"card kpi-card animate-fade-in-up",onClick:a[3]||(a[3]=t=>w("/invoices?filter=reserved","lifecycle")),style:{cursor:"pointer","animation-delay":"40ms"}},[e("div",Ke,[e("div",null,[e("span",Qe,s(n(i)("page.dashboard.pendingReservations")),1),e("div",Xe,s(m.value.pendingReservations),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--warning",innerHTML:n(v)("clock")},null,8,ea)]),e("div",aa,[e("span",ta,[e("span",{innerHTML:n(v)("alert-triangle",12)},null,8,na),se(" "+s(n(i)("page.dashboard.requiresAttention")),1)]),a[11]||(a[11]=e("div",{class:"kpi-card__sparkline"},null,-1))])]),e("div",{class:"card kpi-card animate-fade-in-up",onClick:a[4]||(a[4]=t=>w("/statistics")),style:{cursor:"pointer","animation-delay":"80ms"}},[e("div",sa,[e("div",null,[e("span",oa,s(n(i)("page.dashboard.grossRevenue")),1),e("div",ia,s(n(f)(m.value.grossRevenue)),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--success",innerHTML:n(v)("dollar-sign")},null,8,la)]),e("div",ra,[e("span",{innerHTML:H(m.value.revenueChange)},null,8,ca),e("div",da,[h(A,{data:n(R)(m.value.revenueChange),color:"#16a34a"},null,8,["data"])])])]),e("div",{class:"card kpi-card animate-fade-in-up",onClick:a[5]||(a[5]=t=>w("/statistics")),style:{cursor:"pointer","animation-delay":"120ms"}},[e("div",ua,[e("div",null,[e("span",_a,s(n(i)("page.dashboard.totalPaid")),1),e("div",pa,s(n(f)(m.value.totalPaid)),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--info",innerHTML:n(v)("check-circle")},null,8,ma)]),e("div",ha,[e("span",{innerHTML:H(m.value.paidChange)},null,8,va),e("div",ga,[h(A,{data:n(R)(m.value.paidChange),color:"#0ea5e9"},null,8,["data"])])])]),e("div",{class:"card kpi-card animate-fade-in-up",onClick:a[6]||(a[6]=t=>w("/invoices?filter=outstanding","remaining")),style:{cursor:"pointer","animation-delay":"160ms"}},[e("div",fa,[e("div",null,[e("span",ka,s(n(i)("page.dashboard.outstandingBalance")),1),e("div",ba,s(n(f)(m.value.outstandingBalance)),1)]),e("div",{class:"kpi-card__icon kpi-card__icon--danger",innerHTML:n(v)("wallet")},null,8,ya)]),e("div",Ca,[e("span",{innerHTML:H(m.value.outstandingChange)},null,8,Ma),e("div",Ta,[h(A,{data:n(R)(m.value.outstandingChange),color:"#dc2626"},null,8,["data"])])])]),(y(),C(Z,null,J(ue,(t,d)=>e("div",{key:d,class:"card kpi-card animate-fade-in-up",onClick:g=>w(`/invoices?paymentMethod=${d}`,"payment"),style:$e([{cursor:"pointer"},{animationDelay:t.delay+"ms"}])},[e("div",Sa,[e("div",null,[e("span",Da,s(n(i)("payment.totalLabel"))+" "+s(n(B)(n(oe)[d])),1),e("div",Pa,s(n(f)(m.value.methodTotals[d]||0)),1)]),e("div",{class:He(["kpi-card__icon",`kpi-card__icon--${t.iconColor}`]),innerHTML:n(v)(t.iconName)},null,10,Ia)]),e("div",xa,[e("span",La,s(n(B)(n(oe)[d])),1),a[12]||(a[12]=e("div",{class:"kpi-card__sparkline"},null,-1))])],12,wa)),64))]),e("div",$a,[e("div",Ha,[e("div",Ra,[e("h3",Aa,s(n(i)("page.dashboard.monthlyRevenue")),1)]),e("div",Na,[e("canvas",{ref_key:"revenueChartRef",ref:F},null,512)])]),e("div",Ea,[e("div",Ba,[e("h3",Fa,s(n(i)("page.dashboard.topSellers")),1)]),e("div",Oa,[e("canvas",{ref_key:"topProductsChartRef",ref:O},null,512)])])]),e("div",Va,[e("div",Ua,[e("div",Ya,[e("h3",qa,s(n(i)("page.dashboard.recentInvoices")),1),h(c,{to:"/invoices",class:"btn btn--ghost btn--sm"},{default:Pe(()=>[se(s(n(i)("btn.viewAll"))+" ",1),e("span",{innerHTML:n(v)("chevron-right",14)},null,8,za)]),_:1})]),e("div",Wa,[e("table",ja,[e("thead",null,[e("tr",null,[e("th",null,s(n(i)("col.invoiceNumber")),1),e("th",null,s(n(i)("col.customer")),1),e("th",null,s(n(i)("col.total")),1),e("th",null,s(n(i)("col.status")),1),e("th",Ga,s(n(i)("col.actions")),1)])]),e("tbody",null,[(y(!0),C(Z,null,J(me.value,t=>(y(),C("tr",{key:t.id,style:{cursor:"pointer"},onClick:d=>l.$router.push(`/invoices/${t.id}`)},[e("td",null,[e("strong",null,s(t.number),1)]),e("td",Ja,s(fe(t.customerId)),1),e("td",null,s(n(f)(t.totalAmount)),1),e("td",null,[h(re,{label:n(B)(n(M)(t)),color:n(M)(t).color,dot:!0},null,8,["label","color"])]),e("td",{class:"text-center",onClick:a[7]||(a[7]=Re(()=>{},["stop"]))},[h(Be,{invoice:t,onView:d=>l.$router.push(`/invoices/${t.id}`),onEdit:d=>l.$router.push(`/invoices/${t.id}/edit`),onMarkSold:d=>ke(t),onDelete:d=>be(t)},null,8,["invoice","onView","onEdit","onMarkSold","onDelete"])])],8,Za))),128))])])]),h(ie,{currentPage:n(ee),totalPages:n(_e),total:X.value.length,onPageChange:a[8]||(a[8]=t=>ee.value=t)},null,8,["currentPage","totalPages","total"])]),e("div",Ka,[e("div",Qa,[e("h3",Xa,s(n(i)("page.dashboard.expiringReservations")),1)]),e("div",et,[z.value.length===0?(y(),C("p",at,s(n(i)("page.dashboard.noExpiring")),1)):(y(),C("table",tt,[e("thead",null,[e("tr",null,[e("th",null,s(n(i)("col.product")),1),e("th",null,s(n(i)("col.sku")),1),e("th",null,s(n(i)("col.invoiceNumber")),1),e("th",null,s(n(i)("col.customer")),1),e("th",nt,s(n(i)("col.daysLeft")),1)])]),e("tbody",null,[(y(!0),C(Z,null,J(ge.value,t=>(y(),C("tr",{key:t.invoiceNumber+t.productName},[e("td",st,s(t.productName),1),e("td",null,s(t.sku),1),e("td",null,[e("strong",null,s(t.invoiceNumber),1)]),e("td",ot,s(t.customerName),1),e("td",it,[h(re,{label:t.daysRemaining+"d",color:t.daysRemaining<=3?"danger":t.daysRemaining<=7?"warning":"neutral"},null,8,["label","color"])])]))),128))])]))]),h(ie,{currentPage:n(ae),totalPages:n(he),total:z.value.length,onPageChange:a[9]||(a[9]=t=>ae.value=t)},null,8,["currentPage","totalPages","total"])])]),h(Ie,{visible:$.value,"onUpdate:visible":a[10]||(a[10]=t=>$.value=t),title:V.value,message:U.value,danger:Y.value,onConfirm:n(q)},null,8,["visible","title","message","danger","onConfirm"])])}}};export{mt as default};
