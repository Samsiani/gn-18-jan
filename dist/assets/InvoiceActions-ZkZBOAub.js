import{b as F,o as v,c as m,d as i,F as H,r as E,H as R,t as C,k as D,D as _,u as U,p as V,q as j,e as k,i as T,w as x,R as N,G as z,f as I,j as S,U as P}from"../gn-invoice.js";const W={class:"filter-dates"},G={class:"quick-dates"},Q=["onClick"],Y={class:"date-range-inputs",style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},J=["value"],K=["value"],ce=Object.assign({inheritAttrs:!1},{__name:"DateFilter",props:{dateFrom:{type:String,default:""},dateTo:{type:String,default:""},prefix:{type:String,default:""}},emits:["update:dateFrom","update:dateTo","change"],setup(u,{emit:b}){const t=u,a=b,{t:n}=F(),f=D("all"),g=_(()=>[{period:"today",label:n("filter.today")},{period:"yesterday",label:n("filter.yesterday")},{period:"week",label:n("filter.week")},{period:"month",label:n("filter.month")},{period:"all",label:n("filter.all")}]);function h(){return new Date().toISOString().split("T")[0]}function y(s){f.value=s;const o=new Date;let e="",d="";switch(s){case"today":e=d=h();break;case"yesterday":{const p=new Date(o);p.setDate(p.getDate()-1),e=d=p.toISOString().split("T")[0];break}case"week":{const p=new Date(o);p.setDate(p.getDate()-7),e=p.toISOString().split("T")[0],d=h();break}case"month":{e=new Date(o.getFullYear(),o.getMonth(),1).toISOString().split("T")[0],d=h();break}case"all":e="",d="";break}a("update:dateFrom",e),a("update:dateTo",d),a("change",{dateFrom:e,dateTo:d})}function w(s){f.value="",a("update:dateFrom",s),a("change",{dateFrom:s,dateTo:t.dateTo})}function M(s){f.value="",a("update:dateTo",s),a("change",{dateFrom:t.dateFrom,dateTo:s})}return(s,o)=>(v(),m("div",W,[i("div",G,[(v(!0),m(H,null,E(g.value,e=>(v(),m("button",{key:e.period,class:R(["btn","btn--ghost","btn--sm","quick-date-btn",{active:f.value===e.period}]),onClick:d=>y(e.period)},C(e.label),11,Q))),128))]),i("div",Y,[i("input",{type:"date",class:"form-input form-input--sm",value:u.dateFrom,onChange:o[0]||(o[0]=e=>w(e.target.value)),style:{width:"140px"}},null,40,J),o[2]||(o[2]=i("span",{style:{color:"var(--color-text-tertiary)"}},"â€”",-1)),i("input",{type:"date",class:"form-input form-input--sm",value:u.dateTo,onChange:o[1]||(o[1]=e=>M(e.target.value)),style:{width:"140px"}},null,40,K)])]))}}),X=(u,b)=>{const t=u.__vccOpts||u;for(const[a,n]of b)t[a]=n;return t},Z=["innerHTML"],ee={key:0,class:"quick-action"},te=["innerHTML"],ne=["innerHTML"],oe=["innerHTML"],ie=["innerHTML"],r=D(null);let ae=0;const se={__name:"InvoiceActions",props:{invoice:{type:Object,required:!0},compact:{type:Boolean,default:!1}},emits:["view","edit","mark-sold","delete"],setup(u,{emit:b}){const t=u,a=b,n=U(),{t:f}=F(),g=++ae,h=_(()=>r.value===g),y=D(null),w=D({}),M=_(()=>n.isAccountantRole?!1:t.invoice.lifecycleStatus==="completed"||t.invoice.lifecycleStatus==="sold"?n.isAdmin:n.isAdmin||t.invoice.authorId===n.currentUser?.id),s=_(()=>n.isAccountantRole||t.invoice.lifecycleStatus!=="active"||!t.invoice.items||!t.invoice.items.some(l=>l.itemStatus==="reserved")?!1:n.isAdmin||t.invoice.authorId===n.currentUser?.id),o=_(()=>n.isAdmin),e=_(()=>M.value||s.value||o.value);function d(){if(!y.value)return;const l=y.value.getBoundingClientRect(),c=140;window.innerHeight-l.bottom<c&&l.top>c?w.value={position:"fixed",bottom:`${window.innerHeight-l.top+4}px`,top:"auto",right:`${window.innerWidth-l.right}px`}:w.value={position:"fixed",top:`${l.bottom+4}px`,bottom:"auto",right:`${window.innerWidth-l.right}px`}}function p(){r.value===g?r.value=null:(d(),r.value=g)}function L(l){r.value===g&&!y.value?.contains(l.target)&&(r.value=null)}function q(){r.value=null}function $(){r.value=null,a("edit",t.invoice)}function A(){r.value=null,a("mark-sold",t.invoice)}function O(){r.value=null,a("delete",t.invoice)}return V(()=>{document.addEventListener("click",L),window.addEventListener("scroll",q,!0)}),j(()=>{r.value===g&&(r.value=null),document.removeEventListener("click",L),window.removeEventListener("scroll",q,!0)}),(l,c)=>(v(),m("div",{class:"invoice-actions",onClick:c[2]||(c[2]=x(()=>{},["stop"]))},[i("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:c[0]||(c[0]=B=>l.$emit("view",u.invoice)),"data-tooltip":"View details"},[i("span",{innerHTML:k(T)("eye",14)},null,8,Z)]),!u.compact&&e.value?(v(),m("div",ee,[i("button",{ref_key:"triggerRef",ref:y,class:"quick-action__trigger",onClick:x(p,["stop"])},[i("span",{innerHTML:k(T)("more-vertical",16)},null,8,te)],512),(v(),N(P,{to:"body"},[h.value?(v(),m("div",{key:0,class:"quick-action__menu quick-action__menu--fixed",style:z(w.value),onClick:c[1]||(c[1]=x(()=>{},["stop"]))},[M.value?(v(),m("button",{key:0,class:"quick-action__item",onClick:$},[i("span",{innerHTML:k(T)("edit",14)},null,8,ne),I(" "+C(k(f)("btn.edit")),1)])):S("",!0),s.value?(v(),m("button",{key:1,class:"quick-action__item",onClick:A,style:{color:"var(--color-success)"}},[i("span",{innerHTML:k(T)("check-circle",14)},null,8,oe),I(" "+C(k(f)("msg.titleMarkSold")),1)])):S("",!0),o.value?(v(),m(H,{key:2},[c[3]||(c[3]=i("div",{class:"quick-action__divider"},null,-1)),i("button",{class:"quick-action__item quick-action__item--danger",onClick:O},[i("span",{innerHTML:k(T)("trash-2",14)},null,8,ie),I(" "+C(k(f)("btn.delete")),1)])],64)):S("",!0)],4)):S("",!0)]))])):S("",!0)]))}},ue=X(se,[["__scopeId","data-v-302b59e3"]]);export{ue as I,ce as _};
