import{k as y,s as ve,n as Be,p as fe,q as Ue,o as r,c,d as e,H as F,R as Oe,G as le,F as U,r as Q,T as Re,t as o,j as h,U as Ke,D as L,a as We,u as ze,V as Je,K as Qe,b as Ye,W as X,X as je,e as t,x as J,A as ae,f as g,i as f,g as A,v as P,z as k,L as Ge,P as ne,E as Xe,l as Ze,I as et,Y as tt,Z as st,Q as at,$ as nt,B as me,a0 as lt}from"../gn-invoice.js";import{_ as _e}from"./AppBadge-BenmxPAy.js";const ot=["value","placeholder","disabled"],it=["onClick","onMousemove"],ut={class:"autocomplete__item-main"},pe={__name:"Autocomplete",props:{modelValue:{type:String,default:""},items:{type:Array,default:()=>[]},displayKey:{type:[String,Function],default:"name"},searchFields:{type:Array,default:null},placeholder:{type:String,default:""},inputClass:{type:String,default:""},disabled:{type:Boolean,default:!1},minDropdownWidth:{type:Number,default:0},minChars:{type:Number,default:1}},emits:["update:modelValue","select"],setup(O,{emit:Z}){const _=O,w=Z,Y=y(null),B=y(null),T=y(null),I=y(!1),n=y(-1),$=y({}),q=y(_.modelValue);ve(()=>_.modelValue,u=>{q.value=u});const C=u=>typeof _.displayKey=="function"?_.displayKey(u):u[_.displayKey]||"",s=L(()=>{const u=(q.value||"").toLowerCase().trim();return u.length<_.minChars?[]:_.items.filter(S=>{if(_.searchFields&&_.searchFields.length>0)return _.searchFields.some(x=>{const D=S[x];return D&&String(D).toLowerCase().includes(u)});const m=C(S);return m&&m.toLowerCase().includes(u)}).slice(0,10)});function H(){if(!B.value)return;const u=B.value.getBoundingClientRect(),S=Math.max(u.width,_.minDropdownWidth),m=280;window.innerHeight-u.bottom<m&&u.top>m?$.value={position:"fixed",top:"auto",bottom:`${window.innerHeight-u.top+4}px`,left:`${u.left}px`,width:`${S}px`,maxHeight:`${m}px`,zIndex:9999}:$.value={position:"fixed",top:`${u.bottom+4}px`,bottom:"auto",left:`${u.left}px`,width:`${S}px`,maxHeight:`${m}px`,zIndex:9999}}ve(I,u=>{u&&Be(H)});function N(){!_.disabled&&q.value&&q.value.length>=_.minChars&&(H(),I.value=!0,n.value=-1)}function R(u){_.disabled||(q.value=u,w("update:modelValue",u),H(),I.value=!0,n.value=-1)}function j(u){w("select",u),I.value=!1}function G(u){!Y.value?.contains(u.target)&&!T.value?.contains(u.target)&&(I.value=!1)}function E(u){I.value&&(T.value?.contains(u.target)||H())}function V(u){!I.value||s.value.length===0||(u.key==="ArrowDown"?(u.preventDefault(),n.value=Math.min(n.value+1,s.value.length-1)):u.key==="ArrowUp"?(u.preventDefault(),n.value=Math.max(n.value-1,0)):u.key==="Enter"&&n.value>=0?(u.preventDefault(),j(s.value[n.value])):u.key==="Escape"&&(I.value=!1))}return fe(()=>{document.addEventListener("mousedown",G),window.addEventListener("scroll",E,!0)}),Ue(()=>{document.removeEventListener("mousedown",G),window.removeEventListener("scroll",E,!0)}),(u,S)=>(r(),c("div",{class:"autocomplete",ref_key:"wrapperEl",ref:Y},[e("input",{ref_key:"inputEl",ref:B,class:F(O.inputClass||"form-input"),value:q.value,placeholder:O.placeholder,disabled:O.disabled,onInput:S[0]||(S[0]=m=>R(m.target.value)),onFocus:N,onKeydown:V},null,42,ot),(r(),Oe(Ke,{to:"body"},[I.value&&s.value.length?(r(),c("div",{key:0,ref_key:"listEl",ref:T,class:"autocomplete__list",style:le($.value)},[(r(!0),c(U,null,Q(s.value,(m,x)=>(r(),c("div",{key:x,class:F(["autocomplete__item",{highlighted:n.value===x}]),onClick:D=>j(m),onMousemove:D=>n.value=x},[Re(u.$slots,"item",{item:m},()=>[e("span",ut,o(C(m)),1)])],42,it))),128))],4)):h("",!0)]))],512))}},rt={key:0,class:"empty-state"},ct={key:1,class:"invoice-form"},dt={class:"page-header"},vt={style:{display:"flex","align-items":"center",gap:"var(--space-4)"}},mt=["title","innerHTML"],_t={class:"page-header__title"},pt={class:"page-header__subtitle",style:{margin:"0"}},ft={class:"page-header__actions"},ht={class:"card",style:{"margin-bottom":"var(--space-6)"}},yt={class:"card__body"},bt={class:"invoice-form__header"},gt={class:"invoice-form__number"},kt={class:"form-group",style:{margin:"0"}},St={class:"form-label"},wt=["disabled"],Mt={class:"form-group",style:{margin:"0"}},Tt={class:"form-label"},xt={class:"form-switch__label"},Lt={class:"card",style:{"margin-bottom":"var(--space-6)"}},It={class:"card__body"},Ct={class:"buyer-section-header"},Ht={class:"invoice-form__section-title",style:{"margin-bottom":"0"}},Dt=["innerHTML"],At={key:0,class:"buyer-linked-chip"},Ft=["innerHTML"],Nt=["innerHTML"],Et={class:"buyer-fields"},$t={class:"form-group buyer-fields__full"},qt={class:"form-label"},Vt={class:"autocomplete__item-main"},Pt={class:"autocomplete__item-sub"},Bt={class:"form-group"},Ut={class:"form-label"},Ot=["disabled"],Rt={class:"form-group"},Kt={class:"form-label"},Wt=["disabled"],zt={class:"form-group"},Jt={class:"form-label"},Qt=["disabled"],Yt={class:"form-group"},jt={class:"form-label"},Gt=["disabled"],Xt={class:"card",style:{"margin-bottom":"var(--space-6)"}},Zt={class:"card__body"},es={class:"invoice-form__section-title"},ts=["innerHTML"],ss={class:"items-table-wrapper"},as={class:"data-table items-table"},ns={class:"text-center"},ls={style:{width:"30px",color:"var(--color-text-tertiary)"}},os={class:"product-cell"},is={class:"product-result"},us={class:"product-result__main"},rs={class:"product-result__name"},cs={class:"product-result__meta"},ds={class:"product-result__sku"},vs={class:"product-result__price"},ms={style:{width:"60px"}},_s={class:"stock-thumb"},ps={style:{width:"100px","font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},fs={class:"qty-cell"},hs=["onClick","disabled"],ys=["value","max","onChange","disabled"],bs=["onClick","disabled"],gs={class:"price-cell"},ks=["value","onChange","disabled"],Ss={class:"total-cell font-medium"},ws={class:"status-cell"},Ms=["value","onChange","disabled"],Ts=["value"],xs={style:{width:"120px"}},Ls=["value","onChange","disabled"],Is={value:""},Cs=["value"],Hs={style:{width:"80px"}},Ds=["value","onChange","disabled"],As={key:1,style:{color:"var(--color-text-tertiary)"}},Fs={class:"actions-cell text-center"},Ns=["onClick"],Es=["innerHTML"],$s=["innerHTML"],qs={class:"card__body"},Vs={class:"invoice-form__section-title"},Ps=["innerHTML"],Bs={key:0,class:"fictive-notice"},Us=["innerHTML"],Os={class:"pmt-progress"},Rs={class:"pmt-progress__track"},Ks={class:"pmt-progress__labels"},Ws={key:0},zs={key:1,style:{color:"var(--color-text-tertiary)"}},Js={key:2,style:{color:"var(--color-danger)"}},Qs={key:3,style:{color:"var(--color-warning)"}},Ys={key:4,style:{color:"var(--color-success)"}},js={class:"pmt-ledger"},Gs={key:0,class:"pmt-ledger__empty"},Xs=["innerHTML"],Zs={class:"pmt-ledger__icon"},ea=["innerHTML"],ta={class:"pmt-ledger__meta"},sa={class:"pmt-ledger__date"},aa=["onClick"],na=["innerHTML"],la={key:1,class:"pmt-add-panel"},oa={class:"pmt-add-panel__inputs"},ia={class:"form-group",style:{margin:"0",flex:"0 0 140px"}},ua={class:"form-label"},ra={class:"form-group",style:{margin:"0",flex:"1","min-width":"140px"}},ca={class:"form-label"},da=["value"],va={class:"form-group",style:{margin:"0",flex:"0 0 120px"}},ma={class:"form-label"},_a=["innerHTML"],pa={key:0,class:"pmt-add-panel__quick"},fa=["innerHTML"],ha=["innerHTML"],ya={class:"invoice-totals",style:{"margin-top":"var(--space-4)"}},ba={class:"invoice-totals__table"},ga={class:"invoice-totals__row"},ka={class:"font-semibold"},Sa={key:0,class:"invoice-totals__row"},wa={class:"text-success font-medium"},Ma={key:1,class:"invoice-totals__row"},Ta={class:"text-danger font-medium"},xa={key:2,class:"invoice-totals__row"},La={style:{color:"var(--color-info)"}},Ia={key:3,class:"invoice-totals__row"},Ca={class:"font-medium"},Ha={class:"card",style:{"margin-bottom":"var(--space-6)"}},Da={class:"card__body"},Aa={class:"invoice-form__section-title"},Fa=["innerHTML"],Na={class:"form-group"},Ea={class:"form-label"},$a=["disabled"],qa={key:0,class:"invoice-form__actions"},Va=["innerHTML"],Pa=["innerHTML"],Ba=["innerHTML"],Ra={__name:"InvoiceFormPage",props:{id:[String,Number]},setup(O){const Z=O,_=Ze(),w=We(),Y=ze(),B=Je(),{showToast:T}=et(),I=Qe(),{t:n,tLabel:$,tWarranty:q}=Ye(),C=y(!1),s=y(null);let H=null,N=null;const R=y(null);let j=null;function G(a){R.value=null,clearTimeout(j),requestAnimationFrame(()=>{R.value=a,j=setTimeout(()=>{R.value=null},500)})}const E=y(""),V=y(""),u=y(""),S=y(""),m=y(""),x=y(X()),D=y("company_transfer"),K=y(0);fe(()=>{if(Z.id){const a=w.invoiceById(Z.id);a&&(s.value=JSON.parse(JSON.stringify(a)),C.value=!1)}else{const a=w.invoices,l=w.company,M=l.startingInvoiceNumber+a.length;s.value={id:je(a),number:`${l.invoicePrefix}-${M}`,customerId:null,status:"standard",lifecycleStatus:"draft",items:[],payments:[],totalAmount:0,paidAmount:0,createdAt:X(),saleDate:null,soldDate:null,authorId:Y.currentUser?.id||1,generalNote:"",isRsUploaded:!1,isCreditChecked:!1,isReceiptChecked:!1,isCorrected:!1,accountantNote:"",consultantNote:""},C.value=!0}if(s.value){if(E.value="",V.value="",u.value="",S.value="",m.value="",s.value.customerId){const l=w.customerById(s.value.customerId);l&&(E.value=l.name,V.value=l.taxId,u.value=l.address,S.value=l.phone,m.value=l.email)}const a=B.consumePendingCartItems();a&&a.length>0&&(s.value.items=s.value.items.concat(a))}});const v=L(()=>s.value?me(s.value).label==="Sold"&&!Y.isAdmin:!1),ie=L(()=>me(s.value)||lt.draft),W=L(()=>s.value?s.value.items.filter(a=>a.itemStatus!=="canceled").reduce((a,l)=>a+l.qty*l.price,0):0),ee=L(()=>s.value?s.value.payments.filter(a=>a.method!=="consignment").reduce((a,l)=>a+l.amount,0):0),ue=L(()=>s.value?s.value.payments.filter(a=>a.method==="consignment").reduce((a,l)=>a+l.amount,0):0),he=L(()=>{if(!s.value)return[];let a=W.value;return s.value.payments.map(l=>(a=a-l.amount,{...l,balance:a}))}),b=L(()=>W.value-ee.value),te=L(()=>s.value?s.value.payments.filter(a=>a.method!=="consignment"&&a.amount>0).reduce((a,l)=>a+l.amount,0):0),oe=L(()=>s.value?s.value.payments.filter(a=>a.method==="refund").reduce((a,l)=>a+Math.abs(l.amount),0):0),z=L(()=>Math.max(0,-b.value)),ye=L(()=>W.value<=0?100:Math.max(0,Math.min(100,ee.value/W.value*100)));function re(a){return w.productById(a)}function be(a){const l=w.productById(a);return l?l.name:""}function ge(a){const l=(a.stock||0)-(a.reserved||0);return l<=0?n("page.invoiceForm.outOfStock"):l<=5?n("page.invoiceForm.lowStock",{n:l}):n("page.invoiceForm.inStock",{n:l})}function ke(a){const l=(a.stock||0)-(a.reserved||0);return l<=0?"product-result__stock--out":l<=5?"product-result__stock--low":"product-result__stock--ok"}function Se(a){s.value.customerId=a.id,E.value=a.name,V.value=a.taxId,u.value=a.address,S.value=a.phone,m.value=a.email}function we(){s.value.customerId=null,E.value="",V.value="",u.value="",S.value="",m.value=""}function Me(a,l){s.value.items[a].productId=l.id,s.value.items[a].price=l.price}function Te(){const a=s.value.status==="fictive";s.value.items.push({productId:null,qty:1,price:0,itemStatus:a?"none":"reserved",warranty:a?"":"1_year",reservationDays:a?0:14})}function xe(a){s.value.items.splice(a,1)}function se(a){const l=w.productById(s.value.items[a].productId);if(!l)return 9999;const M=(l.stock||0)-(l.reserved||0);return Math.max(1,M)}function Le(a){const l=se(a);s.value.items[a].qty<l?s.value.items[a].qty++:(G(a),T("warning",n("msg.onlyNAvailable",{n:l})))}function Ie(a){s.value.items[a].qty>1&&s.value.items[a].qty--}function Ce(a,l){const M=se(a),i=parseInt(l.target.value)||1;i>M?(s.value.items[a].qty=M,l.target.value=M,G(a),T("warning",n("msg.onlyNAvailable",{n:M}))):s.value.items[a].qty=Math.max(1,i)}function He(a,l){s.value.items[a].price=Math.max(0,parseFloat(l.target.value)||0)}function De(a,l){const M=l.target.value;s.value.items[a].itemStatus=M,M!=="reserved"?s.value.items[a].reservationDays=0:s.value.items[a].reservationDays=s.value.items[a].reservationDays||14}function Ae(){v.value||(s.value.status==="standard"?(H=s.value.items.map(a=>({itemStatus:a.itemStatus,reservationDays:a.reservationDays})),N=JSON.parse(JSON.stringify(s.value.payments)),s.value.items.forEach(a=>{a.itemStatus="none"}),s.value.payments=[],s.value.saleDate=null,s.value.lifecycleStatus="draft",s.value.status="fictive",N.length>0&&T("info",n("msg.paymentsHidden"),n("msg.switchBackToRestore"))):(s.value.items.forEach((a,l)=>{H&&H[l]&&a.itemStatus==="none"?(a.itemStatus=H[l].itemStatus,a.reservationDays=H[l].reservationDays):a.itemStatus==="none"&&(a.itemStatus="reserved",a.reservationDays=14)}),N&&N.length>0&&(s.value.payments=N,T("success",n("msg.paymentsRestored"))),H=null,N=null,s.value.status="standard"))}function Fe(){if(K.value<=0){T("warning",n("msg.enterValidAmount"));return}s.value.payments.push({date:x.value,method:D.value,amount:K.value}),s.value.status==="standard"&&!s.value.saleDate&&(s.value.saleDate=X(),s.value.lifecycleStatus="active"),I.push({type:"invoice",titleKey:"notif.newPayment",message:`${s.value.number} · ${k(K.value)}`,icon:"credit-card",invoiceId:s.value.id}),K.value=0}function Ne(){if(b.value<=0){T("info",n("msg.invoiceFullyPaid"));return}s.value.payments.push({date:x.value,method:D.value,amount:b.value}),s.value.status==="standard"&&!s.value.saleDate&&(s.value.saleDate=X(),s.value.lifecycleStatus="active")}function Ee(){z.value<=0||s.value.payments.push({date:x.value,method:"refund",amount:-z.value})}function $e(a){s.value.payments.splice(a,1)}function ce(){return s.value.totalAmount=W.value,s.value.paidAmount=ee.value,JSON.parse(JSON.stringify(s.value))}function qe(){N=null;const a=ce();w.saveInvoice(a),B.clearCart(),T("success",n("msg.invoiceSavedDraft")),C.value&&(_.replace(`/invoices/${s.value.id}/edit`),C.value=!1)}function Ve(){s.value.status==="standard"&&(s.value.lifecycleStatus="active",s.value.saleDate||(s.value.saleDate=X()));const a=ce();w.saveInvoice(a),B.clearCart(),T("success",n("msg.invoiceSaved")),_.push(`/invoices/${s.value.id}`)}function Pe(){!C.value&&s.value?_.push(`/invoices/${s.value.id}`):_.push("/invoices")}return(a,l)=>{const M=Xe("router-link");return r(),c("div",null,[s.value?(r(),c("div",ct,[e("div",dt,[e("div",vt,[e("button",{class:"btn btn--ghost btn--icon",onClick:Pe,title:t(n)("btn.back"),innerHTML:t(f)("arrow-left")},null,8,mt),e("div",null,[e("h1",_t,o(C.value?t(n)("page.invoiceForm.newTitle"):t(n)("page.invoiceForm.editTitle",{number:s.value.number})),1),e("p",pt,o(v.value?t(n)("page.invoiceForm.subtitleSold"):t(n)("page.invoiceForm.subtitleEdit")),1)])]),e("div",ft,[J(_e,{label:t($)(ie.value),color:ie.value.color,dot:!0},null,8,["label","color"])])]),e("div",ht,[e("div",yt,[e("div",bt,[e("div",gt,o(s.value.number),1),e("div",kt,[e("label",St,o(t(n)("form.date")),1),A(e("input",{type:"date",class:"form-input","onUpdate:modelValue":l[0]||(l[0]=i=>s.value.createdAt=i),disabled:v.value},null,8,wt),[[P,s.value.createdAt]])]),e("div",Mt,[e("label",Tt,o(t(n)("form.type")),1),e("div",{class:F(["form-switch",{active:s.value.status==="fictive"}]),onClick:Ae,style:le({cursor:v.value?"default":"pointer"})},[l[10]||(l[10]=e("div",{class:"form-switch__track"},[e("div",{class:"form-switch__thumb"})],-1)),e("span",xt,o(s.value.status==="fictive"?t(n)("filter.fictive"):t(n)("filter.standard")),1)],6)])])])]),e("div",Lt,[e("div",It,[e("div",Ct,[e("div",Ht,[e("span",{innerHTML:t(f)("users")},null,8,Dt),g(" "+o(t(n)("section.buyerInfo")),1)]),s.value.customerId&&!v.value?(r(),c("span",At,[e("span",{innerHTML:t(f)("check-circle",12)},null,8,Ft),g(" "+o(t(n)("page.invoiceForm.autoFilled"))+" ",1),e("button",{class:"buyer-linked-chip__clear",onClick:we,title:"Unlink customer"},[e("span",{innerHTML:t(f)("x",12)},null,8,Nt)])])):h("",!0)]),e("div",Et,[e("div",$t,[e("label",qt,o(t(n)("form.companyName")),1),J(pe,{modelValue:E.value,"onUpdate:modelValue":l[1]||(l[1]=i=>E.value=i),items:t(w).customers,searchFields:["name","nameEn","taxId"],placeholder:t(n)("form.searchCustomer"),disabled:v.value,onSelect:Se},{item:ae(({item:i})=>[e("div",null,[e("div",Vt,o(i.name),1),e("div",Pt,o(t(n)("common.taxId"))+" "+o(i.taxId),1)])]),_:1},8,["modelValue","items","placeholder","disabled"])]),e("div",Bt,[e("label",Ut,o(t(n)("form.taxId")),1),A(e("input",{type:"text",class:"form-input","onUpdate:modelValue":l[2]||(l[2]=i=>V.value=i),disabled:v.value},null,8,Ot),[[P,V.value]])]),e("div",Rt,[e("label",Kt,o(t(n)("form.phone")),1),A(e("input",{type:"text",class:"form-input","onUpdate:modelValue":l[3]||(l[3]=i=>S.value=i),disabled:v.value},null,8,Wt),[[P,S.value]])]),e("div",zt,[e("label",Jt,o(t(n)("form.address")),1),A(e("input",{type:"text",class:"form-input","onUpdate:modelValue":l[4]||(l[4]=i=>u.value=i),disabled:v.value},null,8,Qt),[[P,u.value]])]),e("div",Yt,[e("label",jt,o(t(n)("form.email")),1),A(e("input",{type:"email",class:"form-input","onUpdate:modelValue":l[5]||(l[5]=i=>m.value=i),disabled:v.value},null,8,Gt),[[P,m.value]])])])])]),e("div",Xt,[e("div",Zt,[e("div",es,[e("span",{innerHTML:t(f)("package")},null,8,ts),g(" "+o(t(n)("section.items")),1)]),e("div",ss,[e("table",as,[e("thead",null,[e("tr",null,[l[11]||(l[11]=e("th",null,"#",-1)),e("th",null,o(t(n)("col.product")),1),e("th",null,o(t(n)("col.image")),1),e("th",null,o(t(n)("col.brand")),1),e("th",null,o(t(n)("col.qty")),1),e("th",null,o(t(n)("col.price")),1),e("th",null,o(t(n)("col.total")),1),e("th",null,o(t(n)("col.status")),1),e("th",null,o(t(n)("col.warranty")),1),e("th",null,o(t(n)("col.resDays")),1),e("th",ns,o(t(n)("col.actions")),1)])]),e("tbody",null,[(r(!0),c(U,null,Q(s.value.items,(i,p)=>(r(),c("tr",{key:p},[e("td",ls,o(p+1),1),e("td",os,[J(pe,{modelValue:be(i.productId),items:t(w).products,searchFields:["name","sku","brand"],placeholder:t(n)("form.nameOrSku"),disabled:v.value,minDropdownWidth:400,minChars:3,onSelect:d=>Me(p,d)},{item:ae(({item:d})=>[e("div",is,[e("div",us,[e("div",rs,o(d.name),1),e("div",cs,[e("span",ds,o(d.sku),1),d.brand?(r(),c(U,{key:0},[g(" · "+o(d.brand),1)],64)):h("",!0),e("span",{class:F(["product-result__stock",ke(d)])}," · "+o(ge(d)),3)])]),e("div",vs,o(t(k)(d.price)),1)])]),_:1},8,["modelValue","items","placeholder","disabled","onSelect"])]),e("td",ms,[e("div",_s,o(re(i.productId)?.sku?.slice(-3)||"—"),1)]),e("td",ps,o(re(i.productId)?.brand||"—"),1),e("td",fs,[e("div",{class:F(["qty-stepper",{"qty-stepper--exceed":R.value===p}])},[e("button",{class:"qty-stepper__btn",onClick:d=>Ie(p),disabled:v.value||i.qty<=1},"-",8,hs),e("input",{type:"number",class:"qty-stepper__input",value:i.qty,min:"1",max:se(p),onChange:d=>Ce(p,d),disabled:v.value},null,40,ys),e("button",{class:"qty-stepper__btn",onClick:d=>Le(p),disabled:v.value||i.qty>=se(p)},"+",8,bs)],2)]),e("td",gs,[e("input",{type:"number",class:"form-input form-input--sm",value:i.price,step:"0.01",min:"0",onChange:d=>He(p,d),disabled:v.value,style:{width:"100px"}},null,40,ks)]),e("td",Ss,o(t(k)(i.qty*i.price)),1),e("td",ws,[e("select",{class:"form-select form-input--sm",value:i.itemStatus,onChange:d=>De(p,d),disabled:v.value||s.value.status==="fictive"},[(r(!0),c(U,null,Q(t(tt),(d,de)=>(r(),c("option",{key:de,value:de},o(t($)(d)),9,Ts))),128))],40,Ms)]),e("td",xs,[e("select",{class:"form-select form-input--sm",value:i.warranty,onChange:d=>i.warranty=d.target.value,disabled:v.value},[e("option",Is,o(t(n)("form.none")),1),(r(!0),c(U,null,Q(t(st),d=>(r(),c("option",{key:d.value,value:d.value},o(t(q)(d)),9,Cs))),128))],40,Ls)]),e("td",Hs,[i.itemStatus==="reserved"&&s.value.status!=="fictive"?(r(),c("input",{key:0,type:"number",class:"form-input form-input--sm",value:i.reservationDays||14,min:"1",max:"90",onChange:d=>i.reservationDays=Math.max(1,Math.min(90,parseInt(d.target.value)||14)),disabled:v.value,style:{width:"60px"}},null,40,Ds)):(r(),c("span",As,"—"))]),e("td",Fs,[v.value?h("",!0):(r(),c("button",{key:0,class:"btn btn--ghost btn--icon",onClick:d=>xe(p),style:{color:"var(--color-danger)"}},[e("span",{innerHTML:t(f)("trash-2",16)},null,8,Es)],8,Ns))])]))),128))])])]),v.value?h("",!0):(r(),c("button",{key:0,class:"btn btn--secondary btn--sm",onClick:Te},[e("span",{innerHTML:t(f)("plus",14)},null,8,$s),g(" "+o(t(n)("btn.addItem")),1)]))])]),e("div",{class:F(["card",{"section--fictive-disabled":s.value?.status==="fictive"}]),style:{"margin-bottom":"var(--space-6)"}},[e("div",qs,[e("div",Vs,[e("span",{innerHTML:t(f)("credit-card")},null,8,Ps),g(" "+o(t(n)("section.payments")),1)]),s.value?.status==="fictive"?(r(),c("div",Bs,[e("span",{innerHTML:t(f)("alert-circle",14)},null,8,Us),g(" "+o(t(n)("payment.fictiveNotice")),1)])):h("",!0),e("div",Os,[e("div",Rs,[e("div",{class:F(["pmt-progress__fill",{"pmt-progress__fill--settled":b.value===0,"pmt-progress__fill--over":b.value<0}]),style:le({width:ye.value+"%"})},null,6)]),e("div",Ks,[te.value>0?(r(),c("span",Ws,o(t(n)("payment.paidLabel"))+" "+o(t(k)(te.value)),1)):(r(),c("span",zs,o(t(n)("payment.noPayments")),1)),b.value>0?(r(),c("span",Js,o(t(n)("payment.remaining",{amount:t(k)(b.value)})),1)):b.value<0?(r(),c("span",Qs,o(t(n)("payment.refundDue",{amount:t(k)(z.value)})),1)):(r(),c("span",Ys,o(t(n)("payment.fullSettled")),1))])]),e("div",js,[s.value.payments.length===0?(r(),c("div",Gs,[e("span",{innerHTML:t(f)("inbox",20)},null,8,Xs),g(" "+o(t(n)("payment.noTransactions")),1)])):h("",!0),(r(!0),c(U,null,Q(he.value,(i,p)=>(r(),c("div",{key:p,class:F(["pmt-ledger__entry",i.amount<0?"pmt-ledger__entry--out":"pmt-ledger__entry--in"])},[e("div",Zs,[e("span",{innerHTML:t(f)(i.amount<0?"corner-up-left":"arrow-down-circle",15)},null,8,ea)]),e("div",ta,[J(_e,{label:t(ne)[i.method]?t($)(t(ne)[i.method]):i.method,color:t(ne)[i.method]?.color||"neutral"},null,8,["label","color"]),e("span",sa,o(t(at)(i.date)),1)]),e("div",{class:F(["pmt-ledger__amount",i.amount<0?"pmt-ledger__amount--out":"pmt-ledger__amount--in"])},o(i.amount<0?"−":"+")+o(t(k)(Math.abs(i.amount))),3),e("div",{class:"pmt-ledger__balance",style:le({color:i.balance===0?"var(--color-success)":i.balance<0?"var(--color-warning)":"var(--color-text-tertiary)"})},o(i.balance===0?"✓":t(k)(Math.abs(i.balance))),5),!v.value&&s.value?.status!=="fictive"?(r(),c("button",{key:0,class:"pmt-ledger__delete btn btn--ghost btn--icon",onClick:d=>$e(p),style:{color:"var(--color-danger)"}},[e("span",{innerHTML:t(f)("trash-2",14)},null,8,na)],8,aa)):h("",!0)],2))),128))]),!v.value&&s.value?.status!=="fictive"?(r(),c("div",la,[e("div",oa,[e("div",ia,[e("label",ua,o(t(n)("form.date")),1),A(e("input",{type:"date",class:"form-input form-input--sm","onUpdate:modelValue":l[6]||(l[6]=i=>x.value=i)},null,512),[[P,x.value]])]),e("div",ra,[e("label",ca,o(t(n)("form.method")),1),A(e("select",{class:"form-select","onUpdate:modelValue":l[7]||(l[7]=i=>D.value=i)},[(r(!0),c(U,null,Q(t(ne),(i,p)=>A((r(),c("option",{key:p,value:p},o(t($)(i)),9,da)),[[nt,p!=="refund"]])),128))],512),[[Ge,D.value]])]),e("div",va,[e("label",ma,o(t(n)("form.amount")),1),A(e("input",{type:"number",class:"form-input form-input--sm","onUpdate:modelValue":l[8]||(l[8]=i=>K.value=i),step:"0.01",min:"0",placeholder:"0.00"},null,512),[[P,K.value,void 0,{number:!0}]])]),e("button",{class:"btn btn--primary btn--sm",onClick:Fe,style:{"align-self":"flex-end"}},[e("span",{innerHTML:t(f)("plus",14)},null,8,_a),g(" "+o(t(n)("btn.add")),1)])]),b.value>0||z.value>0?(r(),c("div",pa,[b.value>0?(r(),c("button",{key:0,class:"btn btn--success btn--sm",onClick:Ne},[e("span",{innerHTML:t(f)("check-circle",14)},null,8,fa),g(" "+o(t(n)("btn.payFull",{amount:t(k)(b.value)})),1)])):h("",!0),z.value>0?(r(),c("button",{key:1,class:"btn btn--danger btn--sm",onClick:Ee},[e("span",{innerHTML:t(f)("corner-up-left",14)},null,8,ha),g(" "+o(t(n)("btn.issueRefund",{amount:t(k)(z.value)})),1)])):h("",!0)])):h("",!0)])):h("",!0),e("div",ya,[e("div",ba,[e("div",ga,[e("span",null,o(t(n)("payment.subtotal")),1),e("span",ka,o(t(k)(W.value)),1)]),te.value>0?(r(),c("div",Sa,[e("span",null,o(t(n)("payment.paid")),1),e("span",wa,o(t(k)(te.value)),1)])):h("",!0),oe.value>0?(r(),c("div",Ma,[e("span",null,o(t(n)("payment.refunded")),1),e("span",Ta,"− "+o(t(k)(oe.value)),1)])):h("",!0),ue.value>0?(r(),c("div",xa,[e("span",null,o(t(n)("payment.consignment")),1),e("span",La,o(t(k)(ue.value)),1)])):h("",!0),oe.value>0?(r(),c("div",Ia,[e("span",null,o(t(n)("payment.netPaid")),1),e("span",Ca,o(t(k)(ee.value)),1)])):h("",!0),e("div",{class:F(["invoice-totals__row",b.value>0?"invoice-totals__row--remaining":b.value<0?"invoice-totals__row--refund-due":"invoice-totals__row--total"])},[e("span",null,o(b.value>0?t(n)("payment.remainingLabel"):b.value<0?t(n)("payment.refundDueLabel"):t(n)("payment.fullSettled")),1),e("span",null,o(b.value!==0?t(k)(Math.abs(b.value)):"✓"),1)],2)])])])],2),e("div",Ha,[e("div",Da,[e("div",Aa,[e("span",{innerHTML:t(f)("message-square")},null,8,Fa),g(" "+o(t(n)("section.notes")),1)]),e("div",Na,[e("label",Ea,o(t(n)("form.generalNote")),1),A(e("textarea",{class:"form-textarea","onUpdate:modelValue":l[9]||(l[9]=i=>s.value.generalNote=i),disabled:v.value},null,8,$a),[[P,s.value.generalNote]])])])]),v.value?h("",!0):(r(),c("div",qa,[s.value.status==="fictive"?(r(),c("button",{key:0,class:"btn btn--secondary",onClick:qe},[e("span",{innerHTML:t(f)("save",16)},null,8,Va),g(" "+o(C.value?t(n)("btn.saveDraft"):t(n)("btn.updateDraft")),1)])):h("",!0),s.value.status==="standard"?(r(),c("button",{key:1,class:"btn btn--primary",onClick:Ve},[e("span",{innerHTML:t(f)("check",16)},null,8,Pa),g(" "+o(C.value?t(n)("btn.saveInvoice"):t(n)("btn.updateInvoice")),1)])):h("",!0),J(M,{to:`/invoices/${s.value.id}`,class:"btn btn--ghost"},{default:ae(()=>[e("span",{innerHTML:t(f)("printer",16)},null,8,Ba),g(" "+o(t(n)("btn.printPreview")),1)]),_:1},8,["to"])]))])):(r(),c("div",rt,[e("h3",null,o(t(n)("page.invoiceForm.notFound")),1),J(M,{to:"/invoices",class:"btn btn--primary"},{default:ae(()=>[g(o(t(n)("btn.backToInvoices")),1)]),_:1})]))])}}};export{Ra as default};
