import{k as y,s as me,n as Ue,p as he,q as Oe,o as r,c,d as e,H as N,R as Re,G as le,F as U,r as Q,T as We,t as o,j as h,U as Ke,D as I,a as ze,u as Je,V as Qe,K as Ye,b as je,W as X,X as ie,Y as Ge,e as s,x as J,A as ae,f as w,i as f,g as F,v as V,z as M,L as Xe,P as ne,E as Ze,l as et,I as tt,Z as st,$ as at,Q as nt,a0 as lt,B as _e,a1 as ot}from"../gn-invoice.js";import{_ as pe}from"./AppBadge-BenmxPAy.js";const it=["value","placeholder","disabled"],ut=["onClick","onMousemove"],rt={class:"autocomplete__item-main"},fe={__name:"Autocomplete",props:{modelValue:{type:String,default:""},items:{type:Array,default:()=>[]},displayKey:{type:[String,Function],default:"name"},searchFields:{type:Array,default:null},placeholder:{type:String,default:""},inputClass:{type:String,default:""},disabled:{type:Boolean,default:!1},minDropdownWidth:{type:Number,default:0},minChars:{type:Number,default:1}},emits:["update:modelValue","select"],setup(O,{emit:Z}){const _=O,b=Z,Y=y(null),B=y(null),T=y(null),L=y(!1),l=y(-1),q=y({}),P=y(_.modelValue);me(()=>_.modelValue,u=>{P.value=u});const C=u=>typeof _.displayKey=="function"?_.displayKey(u):u[_.displayKey]||"",a=I(()=>{const u=(P.value||"").toLowerCase().trim();return u.length<_.minChars?[]:_.items.filter(S=>{if(_.searchFields&&_.searchFields.length>0)return _.searchFields.some(x=>{const A=S[x];return A&&String(A).toLowerCase().includes(u)});const m=C(S);return m&&m.toLowerCase().includes(u)}).slice(0,10)});function H(){if(!B.value)return;const u=B.value.getBoundingClientRect(),S=Math.max(u.width,_.minDropdownWidth),m=280;window.innerHeight-u.bottom<m&&u.top>m?q.value={position:"fixed",top:"auto",bottom:`${window.innerHeight-u.top+4}px`,left:`${u.left}px`,width:`${S}px`,maxHeight:`${m}px`,zIndex:9999}:q.value={position:"fixed",top:`${u.bottom+4}px`,bottom:"auto",left:`${u.left}px`,width:`${S}px`,maxHeight:`${m}px`,zIndex:9999}}me(L,u=>{u&&Ue(H)});function $(){!_.disabled&&P.value&&P.value.length>=_.minChars&&(H(),L.value=!0,l.value=-1)}function R(u){_.disabled||(P.value=u,b("update:modelValue",u),H(),L.value=!0,l.value=-1)}function j(u){b("select",u),L.value=!1}function G(u){!Y.value?.contains(u.target)&&!T.value?.contains(u.target)&&(L.value=!1)}function D(u){L.value&&(T.value?.contains(u.target)||H())}function E(u){!L.value||a.value.length===0||(u.key==="ArrowDown"?(u.preventDefault(),l.value=Math.min(l.value+1,a.value.length-1)):u.key==="ArrowUp"?(u.preventDefault(),l.value=Math.max(l.value-1,0)):u.key==="Enter"&&l.value>=0?(u.preventDefault(),j(a.value[l.value])):u.key==="Escape"&&(L.value=!1))}return he(()=>{document.addEventListener("mousedown",G),window.addEventListener("scroll",D,!0)}),Oe(()=>{document.removeEventListener("mousedown",G),window.removeEventListener("scroll",D,!0)}),(u,S)=>(r(),c("div",{class:"autocomplete",ref_key:"wrapperEl",ref:Y},[e("input",{ref_key:"inputEl",ref:B,class:N(O.inputClass||"form-input"),value:P.value,placeholder:O.placeholder,disabled:O.disabled,onInput:S[0]||(S[0]=m=>R(m.target.value)),onFocus:$,onKeydown:E},null,42,it),(r(),Re(Ke,{to:"body"},[L.value&&a.value.length?(r(),c("div",{key:0,ref_key:"listEl",ref:T,class:"autocomplete__list",style:le(q.value)},[(r(!0),c(U,null,Q(a.value,(m,x)=>(r(),c("div",{key:x,class:N(["autocomplete__item",{highlighted:l.value===x}]),onClick:A=>j(m),onMousemove:A=>l.value=x},[We(u.$slots,"item",{item:m},()=>[e("span",rt,o(C(m)),1)])],42,ut))),128))],4)):h("",!0)]))],512))}},ct={key:0,class:"empty-state"},dt={key:1,class:"invoice-form"},vt={class:"page-header"},mt={style:{display:"flex","align-items":"center",gap:"var(--space-4)"}},_t=["title","innerHTML"],pt={class:"page-header__title"},ft={class:"page-header__subtitle",style:{margin:"0"}},ht={class:"page-header__actions"},yt={class:"card",style:{"margin-bottom":"var(--space-6)"}},bt={class:"card__body"},gt={class:"invoice-form__header"},kt={class:"invoice-form__number"},St={class:"form-group",style:{margin:"0"}},wt={class:"form-label"},Mt=["disabled"],Tt={class:"form-group",style:{margin:"0"}},xt={class:"form-label"},It={class:"form-switch__label"},Lt={class:"card",style:{"margin-bottom":"var(--space-6)"}},Ct={class:"card__body"},Ht={class:"buyer-section-header"},Dt={class:"invoice-form__section-title",style:{"margin-bottom":"0"}},At=["innerHTML"],Ft={key:0,class:"buyer-linked-chip"},Nt=["innerHTML"],$t=["innerHTML"],Et={class:"buyer-fields"},qt={class:"form-group buyer-fields__full"},Pt={class:"form-label"},Vt={class:"autocomplete__item-main"},Bt={class:"autocomplete__item-sub"},Ut={class:"form-group"},Ot={class:"form-label"},Rt=["disabled"],Wt={class:"form-group"},Kt={class:"form-label"},zt=["disabled"],Jt={class:"form-group"},Qt={class:"form-label"},Yt=["disabled"],jt={class:"form-group"},Gt={class:"form-label"},Xt=["disabled"],Zt={class:"card",style:{"margin-bottom":"var(--space-6)"}},es={class:"card__body"},ts={class:"invoice-form__section-title"},ss=["innerHTML"],as={class:"items-table-wrapper"},ns={class:"data-table items-table"},ls={class:"text-center"},os={style:{width:"30px",color:"var(--color-text-tertiary)"}},is={class:"product-cell"},us={class:"product-result"},rs={class:"product-result__main"},cs={class:"product-result__name"},ds={class:"product-result__meta"},vs={class:"product-result__sku"},ms={class:"product-result__price"},_s={style:{width:"60px"}},ps={class:"stock-thumb"},fs={style:{width:"100px","font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},hs={class:"qty-cell"},ys=["onClick","disabled"],bs=["value","max","onChange","disabled"],gs=["onClick","disabled"],ks={class:"price-cell"},Ss=["value","onChange","disabled"],ws={class:"total-cell font-medium"},Ms={class:"status-cell"},Ts=["value","onChange","disabled"],xs=["value"],Is={style:{width:"120px"}},Ls=["value","onChange","disabled"],Cs={value:""},Hs=["value"],Ds={style:{width:"80px"}},As=["value","onChange","disabled"],Fs={key:1,style:{color:"var(--color-text-tertiary)"}},Ns={class:"actions-cell text-center"},$s=["onClick"],Es=["innerHTML"],qs=["innerHTML"],Ps={class:"card__body"},Vs={class:"invoice-form__section-title"},Bs=["innerHTML"],Us={key:0,class:"fictive-notice"},Os=["innerHTML"],Rs={class:"pmt-progress"},Ws={class:"pmt-progress__track"},Ks={class:"pmt-progress__labels"},zs={key:0},Js={key:1,style:{color:"var(--color-text-tertiary)"}},Qs={key:2,style:{color:"var(--color-danger)"}},Ys={key:3,style:{color:"var(--color-warning)"}},js={key:4,style:{color:"var(--color-success)"}},Gs={class:"pmt-ledger"},Xs={key:0,class:"pmt-ledger__empty"},Zs=["innerHTML"],ea={class:"pmt-ledger__icon"},ta=["innerHTML"],sa={class:"pmt-ledger__meta"},aa={class:"pmt-ledger__date"},na=["onClick"],la=["innerHTML"],oa={key:1,class:"pmt-add-panel"},ia={class:"pmt-add-panel__inputs"},ua={class:"form-group",style:{margin:"0",flex:"0 0 140px"}},ra={class:"form-label"},ca={class:"form-group",style:{margin:"0",flex:"1","min-width":"140px"}},da={class:"form-label"},va=["value"],ma={class:"form-group",style:{margin:"0",flex:"0 0 120px"}},_a={class:"form-label"},pa=["innerHTML"],fa={key:0,class:"pmt-add-panel__quick"},ha=["innerHTML"],ya=["innerHTML"],ba={class:"invoice-totals",style:{"margin-top":"var(--space-4)"}},ga={class:"invoice-totals__table"},ka={class:"invoice-totals__row"},Sa={class:"font-semibold"},wa={key:0,class:"invoice-totals__row"},Ma={class:"text-success font-medium"},Ta={key:1,class:"invoice-totals__row"},xa={class:"text-danger font-medium"},Ia={key:2,class:"invoice-totals__row"},La={style:{color:"var(--color-info)"}},Ca={key:3,class:"invoice-totals__row"},Ha={class:"font-medium"},Da={class:"card",style:{"margin-bottom":"var(--space-6)"}},Aa={class:"card__body"},Fa={class:"invoice-form__section-title"},Na=["innerHTML"],$a={class:"form-group"},Ea={class:"form-label"},qa=["disabled"],Pa={key:0,class:"invoice-form__actions"},Va=["innerHTML"],Ba=["innerHTML"],Ua=["innerHTML"],Wa={__name:"InvoiceFormPage",props:{id:[String,Number]},setup(O){const Z=O,_=et(),b=ze(),Y=Je(),B=Qe(),{showToast:T}=tt(),L=Ye(),{t:l,tLabel:q,tWarranty:P}=je(),C=y(!1),a=y(null);let H=null,$=null;const R=y(null);let j=null;function G(t){R.value=null,clearTimeout(j),requestAnimationFrame(()=>{R.value=t,j=setTimeout(()=>{R.value=null},500)})}const D=y(""),E=y(""),u=y(""),S=y(""),m=y(""),x=y(X()),A=y("company_transfer"),W=y(0);he(async()=>{if(Z.id){const t=b.invoiceById(Z.id);t&&(a.value=JSON.parse(JSON.stringify(t)),C.value=!1)}else{let t;if(ie.isWordPress())try{t=(await ie.get("invoices/next-number"))?.data?.number||`${b.company.invoicePrefix||"N"}—`}catch{t=`${b.company.invoicePrefix||"N"}—`}else{const n=b.invoices,k=b.company;t=`${k.invoicePrefix}-${k.startingInvoiceNumber+n.length}`}a.value={id:ie.isWordPress()?null:Ge(b.invoices),number:t,customerId:null,status:"standard",lifecycleStatus:"draft",items:[],payments:[],totalAmount:0,paidAmount:0,createdAt:X(),saleDate:null,soldDate:null,authorId:Y.currentUser?.id||1,generalNote:"",isRsUploaded:!1,isCreditChecked:!1,isReceiptChecked:!1,isCorrected:!1,accountantNote:"",consultantNote:""},C.value=!0}if(a.value){if(D.value="",E.value="",u.value="",S.value="",m.value="",a.value.customerId){const n=b.customerById(a.value.customerId);n&&(D.value=n.name,E.value=n.taxId,u.value=n.address,S.value=n.phone,m.value=n.email)}const t=B.consumePendingCartItems();t&&t.length>0&&(a.value.items=a.value.items.concat(t))}});const v=I(()=>a.value?_e(a.value).label==="Sold"&&!Y.isAdmin:!1),ue=I(()=>_e(a.value)||ot.draft),K=I(()=>a.value?a.value.items.filter(t=>t.itemStatus!=="canceled").reduce((t,n)=>t+n.qty*n.price,0):0),ee=I(()=>a.value?a.value.payments.filter(t=>t.method!=="consignment").reduce((t,n)=>t+n.amount,0):0),re=I(()=>a.value?a.value.payments.filter(t=>t.method==="consignment").reduce((t,n)=>t+n.amount,0):0),ye=I(()=>{if(!a.value)return[];let t=K.value;return a.value.payments.map(n=>(t=t-n.amount,{...n,balance:t}))}),g=I(()=>K.value-ee.value),te=I(()=>a.value?a.value.payments.filter(t=>t.method!=="consignment"&&t.amount>0).reduce((t,n)=>t+n.amount,0):0),oe=I(()=>a.value?a.value.payments.filter(t=>t.method==="refund").reduce((t,n)=>t+Math.abs(n.amount),0):0),z=I(()=>Math.max(0,-g.value)),be=I(()=>K.value<=0?100:Math.max(0,Math.min(100,ee.value/K.value*100)));function ce(t){return b.productById(t)}function ge(t){const n=b.productById(t);return n?n.name:""}function ke(t){const n=(t.stock||0)-(t.reserved||0);return n<=0?l("page.invoiceForm.outOfStock"):n<=5?l("page.invoiceForm.lowStock",{n}):l("page.invoiceForm.inStock",{n})}function Se(t){const n=(t.stock||0)-(t.reserved||0);return n<=0?"product-result__stock--out":n<=5?"product-result__stock--low":"product-result__stock--ok"}function we(t){a.value.customerId=t.id,D.value=t.name,E.value=t.taxId,u.value=t.address,S.value=t.phone,m.value=t.email}function Me(){a.value.customerId=null,D.value="",E.value="",u.value="",S.value="",m.value=""}function Te(t,n){a.value.items[t].productId=n.id,a.value.items[t].name=n.name,a.value.items[t].sku=n.sku||"",a.value.items[t].description=n.description||"",a.value.items[t].image=n.image||"",a.value.items[t].price=n.price}function xe(){const t=a.value.status==="fictive";a.value.items.push({productId:null,qty:1,price:0,itemStatus:t?"none":"reserved",warranty:t?"":"1_year",reservationDays:t?0:14})}function Ie(t){a.value.items.splice(t,1)}function se(t){const n=b.productById(a.value.items[t].productId);if(!n)return 9999;const k=(n.stock||0)-(n.reserved||0);return Math.max(1,k)}function Le(t){const n=se(t);a.value.items[t].qty<n?a.value.items[t].qty++:(G(t),T("warning",l("msg.onlyNAvailable",{n})))}function Ce(t){a.value.items[t].qty>1&&a.value.items[t].qty--}function He(t,n){const k=se(t),i=parseInt(n.target.value)||1;i>k?(a.value.items[t].qty=k,n.target.value=k,G(t),T("warning",l("msg.onlyNAvailable",{n:k}))):a.value.items[t].qty=Math.max(1,i)}function De(t,n){a.value.items[t].price=Math.max(0,parseFloat(n.target.value)||0)}function Ae(t,n){const k=n.target.value;a.value.items[t].itemStatus=k,k!=="reserved"?a.value.items[t].reservationDays=0:a.value.items[t].reservationDays=a.value.items[t].reservationDays||14}function Fe(){v.value||(a.value.status==="standard"?(H=a.value.items.map(t=>({itemStatus:t.itemStatus,reservationDays:t.reservationDays})),$=JSON.parse(JSON.stringify(a.value.payments)),a.value.items.forEach(t=>{t.itemStatus="none"}),a.value.payments=[],a.value.saleDate=null,a.value.lifecycleStatus="draft",a.value.status="fictive",$.length>0&&T("info",l("msg.paymentsHidden"),l("msg.switchBackToRestore"))):(a.value.items.forEach((t,n)=>{H&&H[n]&&t.itemStatus==="none"?(t.itemStatus=H[n].itemStatus,t.reservationDays=H[n].reservationDays):t.itemStatus==="none"&&(t.itemStatus="reserved",t.reservationDays=14)}),$&&$.length>0&&(a.value.payments=$,T("success",l("msg.paymentsRestored"))),H=null,$=null,a.value.status="standard"))}function Ne(){if(W.value<=0){T("warning",l("msg.enterValidAmount"));return}a.value.payments.push({date:x.value,method:A.value,amount:W.value}),a.value.status==="standard"&&!a.value.saleDate&&(a.value.saleDate=X(),a.value.lifecycleStatus="active"),L.push({type:"invoice",titleKey:"notif.newPayment",message:`${a.value.number} · ${M(W.value)}`,icon:"credit-card",invoiceId:a.value.id}),W.value=0}function $e(){if(g.value<=0){T("info",l("msg.invoiceFullyPaid"));return}a.value.payments.push({date:x.value,method:A.value,amount:g.value}),a.value.status==="standard"&&!a.value.saleDate&&(a.value.saleDate=X(),a.value.lifecycleStatus="active")}function Ee(){z.value<=0||a.value.payments.push({date:x.value,method:"refund",amount:-z.value})}function qe(t){a.value.payments.splice(t,1)}function de(){a.value.totalAmount=K.value,a.value.paidAmount=ee.value;const t=JSON.parse(JSON.stringify(a.value));return t.buyer={name:D.value,taxId:E.value,phone:S.value,email:m.value,address:u.value},t}async function Pe(){$=null;const t=de();try{const n=await b.saveInvoice(t);n?.id&&(a.value.id=n.id),n?.number&&(a.value.number=n.number),B.clearCart(),T("success",l("msg.invoiceSavedDraft")),C.value&&(_.replace(`/invoices/${a.value.id}/edit`),C.value=!1)}catch(n){T("error",l("msg.error"),n.message)}}async function Ve(){a.value.status==="standard"&&(a.value.lifecycleStatus="active",a.value.saleDate||(a.value.saleDate=X()));const t=de();try{const k=(await b.saveInvoice(t))?.id||a.value.id;B.clearCart(),T("success",l("msg.invoiceSaved")),_.push(`/invoices/${k}`)}catch(n){T("error",l("msg.error"),n.message)}}function Be(){!C.value&&a.value?_.push(`/invoices/${a.value.id}`):_.push("/invoices")}return(t,n)=>{const k=Ze("router-link");return r(),c("div",null,[a.value?(r(),c("div",dt,[e("div",vt,[e("div",mt,[e("button",{class:"btn btn--ghost btn--icon",onClick:Be,title:s(l)("btn.back"),innerHTML:s(f)("arrow-left")},null,8,_t),e("div",null,[e("h1",pt,o(C.value?s(l)("page.invoiceForm.newTitle"):s(l)("page.invoiceForm.editTitle",{number:a.value.number})),1),e("p",ft,o(v.value?s(l)("page.invoiceForm.subtitleSold"):s(l)("page.invoiceForm.subtitleEdit")),1)])]),e("div",ht,[J(pe,{label:s(q)(ue.value),color:ue.value.color,dot:!0},null,8,["label","color"])])]),e("div",yt,[e("div",bt,[e("div",gt,[e("div",kt,o(a.value.number),1),e("div",St,[e("label",wt,o(s(l)("form.date")),1),F(e("input",{type:"date",class:"form-input","onUpdate:modelValue":n[0]||(n[0]=i=>a.value.createdAt=i),disabled:v.value},null,8,Mt),[[V,a.value.createdAt]])]),e("div",Tt,[e("label",xt,o(s(l)("form.type")),1),e("div",{class:N(["form-switch",{active:a.value.status==="fictive"}]),onClick:Fe,style:le({cursor:v.value?"default":"pointer"})},[n[10]||(n[10]=e("div",{class:"form-switch__track"},[e("div",{class:"form-switch__thumb"})],-1)),e("span",It,o(a.value.status==="fictive"?s(l)("filter.fictive"):s(l)("filter.standard")),1)],6)])])])]),e("div",Lt,[e("div",Ct,[e("div",Ht,[e("div",Dt,[e("span",{innerHTML:s(f)("users")},null,8,At),w(" "+o(s(l)("section.buyerInfo")),1)]),a.value.customerId&&!v.value?(r(),c("span",Ft,[e("span",{innerHTML:s(f)("check-circle",12)},null,8,Nt),w(" "+o(s(l)("page.invoiceForm.autoFilled"))+" ",1),e("button",{class:"buyer-linked-chip__clear",onClick:Me,title:"Unlink customer"},[e("span",{innerHTML:s(f)("x",12)},null,8,$t)])])):h("",!0)]),e("div",Et,[e("div",qt,[e("label",Pt,o(s(l)("form.companyName")),1),J(fe,{modelValue:D.value,"onUpdate:modelValue":n[1]||(n[1]=i=>D.value=i),items:s(b).customers,searchFields:["name","nameEn","taxId"],placeholder:s(l)("form.searchCustomer"),disabled:v.value,onSelect:we},{item:ae(({item:i})=>[e("div",null,[e("div",Vt,o(i.name),1),e("div",Bt,o(s(l)("common.taxId"))+" "+o(i.taxId),1)])]),_:1},8,["modelValue","items","placeholder","disabled"])]),e("div",Ut,[e("label",Ot,o(s(l)("form.taxId")),1),F(e("input",{type:"text",class:"form-input","onUpdate:modelValue":n[2]||(n[2]=i=>E.value=i),disabled:v.value},null,8,Rt),[[V,E.value]])]),e("div",Wt,[e("label",Kt,o(s(l)("form.phone")),1),F(e("input",{type:"text",class:"form-input","onUpdate:modelValue":n[3]||(n[3]=i=>S.value=i),disabled:v.value},null,8,zt),[[V,S.value]])]),e("div",Jt,[e("label",Qt,o(s(l)("form.address")),1),F(e("input",{type:"text",class:"form-input","onUpdate:modelValue":n[4]||(n[4]=i=>u.value=i),disabled:v.value},null,8,Yt),[[V,u.value]])]),e("div",jt,[e("label",Gt,o(s(l)("form.email")),1),F(e("input",{type:"email",class:"form-input","onUpdate:modelValue":n[5]||(n[5]=i=>m.value=i),disabled:v.value},null,8,Xt),[[V,m.value]])])])])]),e("div",Zt,[e("div",es,[e("div",ts,[e("span",{innerHTML:s(f)("package")},null,8,ss),w(" "+o(s(l)("section.items")),1)]),e("div",as,[e("table",ns,[e("thead",null,[e("tr",null,[n[11]||(n[11]=e("th",null,"#",-1)),e("th",null,o(s(l)("col.product")),1),e("th",null,o(s(l)("col.image")),1),e("th",null,o(s(l)("col.brand")),1),e("th",null,o(s(l)("col.qty")),1),e("th",null,o(s(l)("col.price")),1),e("th",null,o(s(l)("col.total")),1),e("th",null,o(s(l)("col.status")),1),e("th",null,o(s(l)("col.warranty")),1),e("th",null,o(s(l)("col.resDays")),1),e("th",ls,o(s(l)("col.actions")),1)])]),e("tbody",null,[(r(!0),c(U,null,Q(a.value.items,(i,p)=>(r(),c("tr",{key:p},[e("td",os,o(p+1),1),e("td",is,[J(fe,{modelValue:ge(i.productId),items:s(b).products,searchFields:["name","sku","brand"],placeholder:s(l)("form.nameOrSku"),disabled:v.value,minDropdownWidth:400,minChars:3,onSelect:d=>Te(p,d)},{item:ae(({item:d})=>[e("div",us,[e("div",rs,[e("div",cs,o(d.name),1),e("div",ds,[e("span",vs,o(d.sku),1),d.brand?(r(),c(U,{key:0},[w(" · "+o(d.brand),1)],64)):h("",!0),e("span",{class:N(["product-result__stock",Se(d)])}," · "+o(ke(d)),3)])]),e("div",ms,o(s(M)(d.price)),1)])]),_:1},8,["modelValue","items","placeholder","disabled","onSelect"])]),e("td",_s,[e("div",ps,o(ce(i.productId)?.sku?.slice(-3)||"—"),1)]),e("td",fs,o(ce(i.productId)?.brand||"—"),1),e("td",hs,[e("div",{class:N(["qty-stepper",{"qty-stepper--exceed":R.value===p}])},[e("button",{class:"qty-stepper__btn",onClick:d=>Ce(p),disabled:v.value||i.qty<=1},"-",8,ys),e("input",{type:"number",class:"qty-stepper__input",value:i.qty,min:"1",max:se(p),onChange:d=>He(p,d),disabled:v.value},null,40,bs),e("button",{class:"qty-stepper__btn",onClick:d=>Le(p),disabled:v.value||i.qty>=se(p)},"+",8,gs)],2)]),e("td",ks,[e("input",{type:"number",class:"form-input form-input--sm",value:i.price,step:"0.01",min:"0",onChange:d=>De(p,d),disabled:v.value,style:{width:"100px"}},null,40,Ss)]),e("td",ws,o(s(M)(i.qty*i.price)),1),e("td",Ms,[e("select",{class:"form-select form-input--sm",value:i.itemStatus,onChange:d=>Ae(p,d),disabled:v.value||a.value.status==="fictive"},[(r(!0),c(U,null,Q(s(st),(d,ve)=>(r(),c("option",{key:ve,value:ve},o(s(q)(d)),9,xs))),128))],40,Ts)]),e("td",Is,[e("select",{class:"form-select form-input--sm",value:i.warranty,onChange:d=>i.warranty=d.target.value,disabled:v.value},[e("option",Cs,o(s(l)("form.none")),1),(r(!0),c(U,null,Q(s(at),d=>(r(),c("option",{key:d.value,value:d.value},o(s(P)(d)),9,Hs))),128))],40,Ls)]),e("td",Ds,[i.itemStatus==="reserved"&&a.value.status!=="fictive"?(r(),c("input",{key:0,type:"number",class:"form-input form-input--sm",value:i.reservationDays||14,min:"1",max:"90",onChange:d=>i.reservationDays=Math.max(1,Math.min(90,parseInt(d.target.value)||14)),disabled:v.value,style:{width:"60px"}},null,40,As)):(r(),c("span",Fs,"—"))]),e("td",Ns,[v.value?h("",!0):(r(),c("button",{key:0,class:"btn btn--ghost btn--icon",onClick:d=>Ie(p),style:{color:"var(--color-danger)"}},[e("span",{innerHTML:s(f)("trash-2",16)},null,8,Es)],8,$s))])]))),128))])])]),v.value?h("",!0):(r(),c("button",{key:0,class:"btn btn--secondary btn--sm",onClick:xe},[e("span",{innerHTML:s(f)("plus",14)},null,8,qs),w(" "+o(s(l)("btn.addItem")),1)]))])]),e("div",{class:N(["card",{"section--fictive-disabled":a.value?.status==="fictive"}]),style:{"margin-bottom":"var(--space-6)"}},[e("div",Ps,[e("div",Vs,[e("span",{innerHTML:s(f)("credit-card")},null,8,Bs),w(" "+o(s(l)("section.payments")),1)]),a.value?.status==="fictive"?(r(),c("div",Us,[e("span",{innerHTML:s(f)("alert-circle",14)},null,8,Os),w(" "+o(s(l)("payment.fictiveNotice")),1)])):h("",!0),e("div",Rs,[e("div",Ws,[e("div",{class:N(["pmt-progress__fill",{"pmt-progress__fill--settled":g.value===0,"pmt-progress__fill--over":g.value<0}]),style:le({width:be.value+"%"})},null,6)]),e("div",Ks,[te.value>0?(r(),c("span",zs,o(s(l)("payment.paidLabel"))+" "+o(s(M)(te.value)),1)):(r(),c("span",Js,o(s(l)("payment.noPayments")),1)),g.value>0?(r(),c("span",Qs,o(s(l)("payment.remaining",{amount:s(M)(g.value)})),1)):g.value<0?(r(),c("span",Ys,o(s(l)("payment.refundDue",{amount:s(M)(z.value)})),1)):(r(),c("span",js,o(s(l)("payment.fullSettled")),1))])]),e("div",Gs,[a.value.payments.length===0?(r(),c("div",Xs,[e("span",{innerHTML:s(f)("inbox",20)},null,8,Zs),w(" "+o(s(l)("payment.noTransactions")),1)])):h("",!0),(r(!0),c(U,null,Q(ye.value,(i,p)=>(r(),c("div",{key:p,class:N(["pmt-ledger__entry",i.amount<0?"pmt-ledger__entry--out":"pmt-ledger__entry--in"])},[e("div",ea,[e("span",{innerHTML:s(f)(i.amount<0?"corner-up-left":"arrow-down-circle",15)},null,8,ta)]),e("div",sa,[J(pe,{label:s(ne)[i.method]?s(q)(s(ne)[i.method]):i.method,color:s(ne)[i.method]?.color||"neutral"},null,8,["label","color"]),e("span",aa,o(s(nt)(i.date)),1)]),e("div",{class:N(["pmt-ledger__amount",i.amount<0?"pmt-ledger__amount--out":"pmt-ledger__amount--in"])},o(i.amount<0?"−":"+")+o(s(M)(Math.abs(i.amount))),3),e("div",{class:"pmt-ledger__balance",style:le({color:i.balance===0?"var(--color-success)":i.balance<0?"var(--color-warning)":"var(--color-text-tertiary)"})},o(i.balance===0?"✓":s(M)(Math.abs(i.balance))),5),!v.value&&a.value?.status!=="fictive"?(r(),c("button",{key:0,class:"pmt-ledger__delete btn btn--ghost btn--icon",onClick:d=>qe(p),style:{color:"var(--color-danger)"}},[e("span",{innerHTML:s(f)("trash-2",14)},null,8,la)],8,na)):h("",!0)],2))),128))]),!v.value&&a.value?.status!=="fictive"?(r(),c("div",oa,[e("div",ia,[e("div",ua,[e("label",ra,o(s(l)("form.date")),1),F(e("input",{type:"date",class:"form-input form-input--sm","onUpdate:modelValue":n[6]||(n[6]=i=>x.value=i)},null,512),[[V,x.value]])]),e("div",ca,[e("label",da,o(s(l)("form.method")),1),F(e("select",{class:"form-select","onUpdate:modelValue":n[7]||(n[7]=i=>A.value=i)},[(r(!0),c(U,null,Q(s(ne),(i,p)=>F((r(),c("option",{key:p,value:p},o(s(q)(i)),9,va)),[[lt,p!=="refund"]])),128))],512),[[Xe,A.value]])]),e("div",ma,[e("label",_a,o(s(l)("form.amount")),1),F(e("input",{type:"number",class:"form-input form-input--sm","onUpdate:modelValue":n[8]||(n[8]=i=>W.value=i),step:"0.01",min:"0",placeholder:"0.00"},null,512),[[V,W.value,void 0,{number:!0}]])]),e("button",{class:"btn btn--primary btn--sm",onClick:Ne,style:{"align-self":"flex-end"}},[e("span",{innerHTML:s(f)("plus",14)},null,8,pa),w(" "+o(s(l)("btn.add")),1)])]),g.value>0||z.value>0?(r(),c("div",fa,[g.value>0?(r(),c("button",{key:0,class:"btn btn--success btn--sm",onClick:$e},[e("span",{innerHTML:s(f)("check-circle",14)},null,8,ha),w(" "+o(s(l)("btn.payFull",{amount:s(M)(g.value)})),1)])):h("",!0),z.value>0?(r(),c("button",{key:1,class:"btn btn--danger btn--sm",onClick:Ee},[e("span",{innerHTML:s(f)("corner-up-left",14)},null,8,ya),w(" "+o(s(l)("btn.issueRefund",{amount:s(M)(z.value)})),1)])):h("",!0)])):h("",!0)])):h("",!0),e("div",ba,[e("div",ga,[e("div",ka,[e("span",null,o(s(l)("payment.subtotal")),1),e("span",Sa,o(s(M)(K.value)),1)]),te.value>0?(r(),c("div",wa,[e("span",null,o(s(l)("payment.paid")),1),e("span",Ma,o(s(M)(te.value)),1)])):h("",!0),oe.value>0?(r(),c("div",Ta,[e("span",null,o(s(l)("payment.refunded")),1),e("span",xa,"− "+o(s(M)(oe.value)),1)])):h("",!0),re.value>0?(r(),c("div",Ia,[e("span",null,o(s(l)("payment.consignment")),1),e("span",La,o(s(M)(re.value)),1)])):h("",!0),oe.value>0?(r(),c("div",Ca,[e("span",null,o(s(l)("payment.netPaid")),1),e("span",Ha,o(s(M)(ee.value)),1)])):h("",!0),e("div",{class:N(["invoice-totals__row",g.value>0?"invoice-totals__row--remaining":g.value<0?"invoice-totals__row--refund-due":"invoice-totals__row--total"])},[e("span",null,o(g.value>0?s(l)("payment.remainingLabel"):g.value<0?s(l)("payment.refundDueLabel"):s(l)("payment.fullSettled")),1),e("span",null,o(g.value!==0?s(M)(Math.abs(g.value)):"✓"),1)],2)])])])],2),e("div",Da,[e("div",Aa,[e("div",Fa,[e("span",{innerHTML:s(f)("message-square")},null,8,Na),w(" "+o(s(l)("section.notes")),1)]),e("div",$a,[e("label",Ea,o(s(l)("form.generalNote")),1),F(e("textarea",{class:"form-textarea","onUpdate:modelValue":n[9]||(n[9]=i=>a.value.generalNote=i),disabled:v.value},null,8,qa),[[V,a.value.generalNote]])])])]),v.value?h("",!0):(r(),c("div",Pa,[a.value.status==="fictive"?(r(),c("button",{key:0,class:"btn btn--secondary",onClick:Pe},[e("span",{innerHTML:s(f)("save",16)},null,8,Va),w(" "+o(C.value?s(l)("btn.saveDraft"):s(l)("btn.updateDraft")),1)])):h("",!0),a.value.status==="standard"?(r(),c("button",{key:1,class:"btn btn--primary",onClick:Ve},[e("span",{innerHTML:s(f)("check",16)},null,8,Ba),w(" "+o(C.value?s(l)("btn.saveInvoice"):s(l)("btn.updateInvoice")),1)])):h("",!0),J(k,{to:`/invoices/${a.value.id}`,class:"btn btn--ghost"},{default:ae(()=>[e("span",{innerHTML:s(f)("printer",16)},null,8,Ua),w(" "+o(s(l)("btn.printPreview")),1)]),_:1},8,["to"])]))])):(r(),c("div",ct,[e("h3",null,o(s(l)("page.invoiceForm.notFound")),1),J(k,{to:"/invoices",class:"btn btn--primary"},{default:ae(()=>[w(o(s(l)("btn.backToInvoices")),1)]),_:1})]))])}}};export{Wa as default};
