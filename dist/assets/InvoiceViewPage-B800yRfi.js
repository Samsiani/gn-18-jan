import{a as ee,u as te,m as ae,b as ne,o as l,c,d as e,t,e as a,x as L,A as E,f as u,F as w,i as S,R as V,j as d,Q as A,r as q,H as h,z as _,G as F,D as v,E as oe,l as se,P as H,Z as $,S as R,a1 as le,B as ie,C as ce}from"../gn-invoice.js";import{_ as B}from"./AppBadge-BenmxPAy.js";const re={key:0,class:"empty-state"},ue={class:"page-header no-print"},de={style:{display:"flex","align-items":"center",gap:"var(--space-4)"}},ve=["title","innerHTML"],_e={class:"page-header__title"},me={class:"page-header__subtitle",style:{margin:"0"}},pe={class:"page-header__actions"},ye=["innerHTML"],he=["innerHTML"],be=["innerHTML"],ge={class:"card"},fe={class:"card__body"},we={class:"invoice-view"},ke={class:"invoice-view__header"},Le={class:"invoice-view__company"},Se={class:"invoice-view__company-name"},xe={class:"invoice-view__company-details"},Ie={class:"invoice-view__meta"},Te={class:"invoice-view__invoice-number"},Me={class:"invoice-view__date"},Ae={class:"invoice-view__buyer"},Be={class:"invoice-view__party-name"},Ce={class:"invoice-view__party-detail"},Ne={class:"invoice-view__party-detail"},Ee={class:"invoice-view__party-detail"},He={class:"invoice-view__party-detail"},De={key:1,class:"invoice-view__party-detail"},Pe={class:"table-scroll-wrapper"},ze={class:"invoice-view__items-table"},Ve={class:"no-print"},qe={key:0},Fe={key:0,style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},$e={class:"no-print"},Re={key:0},We={class:"invoice-view__summary"},Ue={class:"invoice-view__summary-table"},Ye={class:"invoice-view__summary-row"},je={key:0,class:"invoice-view__summary-row"},Ge={style:{color:"var(--color-success)"}},Oe={key:1,class:"invoice-view__summary-row"},Qe={style:{color:"var(--color-danger)"}},Ze={key:2,class:"invoice-view__summary-row"},Je={style:{color:"var(--color-info)"}},Ke={key:3,class:"invoice-view__summary-row"},Xe={key:0,class:"no-print",style:{"margin-bottom":"var(--space-6)"}},et={style:{"margin-bottom":"var(--space-3)","font-size":"var(--text-sm)",color:"var(--color-text-secondary)"}},tt={class:"pmt-progress",style:{"margin-bottom":"var(--space-3)"}},at={class:"pmt-progress__track"},nt={class:"pmt-progress__labels"},ot={key:0},st={key:1,style:{color:"var(--color-text-tertiary)"}},lt={key:2,style:{color:"var(--color-danger)"}},it={key:3,style:{color:"var(--color-warning)"}},ct={key:4,style:{color:"var(--color-success)"}},rt={class:"pmt-ledger"},ut={class:"pmt-ledger__icon"},dt=["innerHTML"],vt={class:"pmt-ledger__meta"},_t={class:"pmt-ledger__date"},mt={key:1,class:"no-print",style:{"margin-bottom":"var(--space-6)","font-size":"var(--text-sm)",color:"var(--color-text-secondary)"}},pt={class:"invoice-view__footer"},yt={class:"invoice-view__party-detail"},ht={key:0,class:"invoice-view__party-detail",style:{"margin-top":"var(--space-2)"}},bt={style:{"margin-bottom":"var(--space-1)"}},gt={class:"invoice-view__signature-line"},ft={style:{"margin-top":"var(--space-6)","font-size":"var(--text-xs)",color:"var(--color-text-tertiary)","text-align":"center"}},Lt={__name:"InvoiceViewPage",props:{id:[String,Number]},setup(W){const U=W,Y=se(),k=ee(),j=te(),G=ae(),{t:n,tLabel:x}=ne(),o=v(()=>k.invoiceById(U.id)),m=v(()=>k.company),g=v(()=>o.value?k.customerById(o.value.customerId):null),O=v(()=>o.value?k.userById(o.value.authorId):null),D=v(()=>R[o.value?.status]||R.standard),b=v(()=>o.value?ie(o.value):le.draft),P=v(()=>o.value?.payments.filter(i=>i.method==="consignment").reduce((i,r)=>i+r.amount,0)||0),f=v(()=>ce(o.value)),p=v(()=>f.value-(o.value?.paidAmount||0)),C=v(()=>o.value?.items.some(i=>i.warranty)||!1),I=v(()=>o.value?.payments.filter(i=>i.method!=="consignment"&&i.amount>0).reduce((i,r)=>i+r.amount,0)||0),N=v(()=>o.value?.payments.filter(i=>i.method==="refund").reduce((i,r)=>i+Math.abs(r.amount),0)||0),Q=v(()=>Math.max(0,-p.value)),Z=v(()=>f.value<=0?100:Math.max(0,Math.min(100,(o.value?.paidAmount||0)/f.value*100))),J=v(()=>{if(!o.value)return[];let i=f.value;return o.value.payments.map(r=>(i=i-r.amount,{...r,balance:i}))});function T(i){return k.productById(i)}function z(i){return $[i]||$.none}function K(){const i=document.title;document.title=`Invoice - ${o.value.number}`;const r=document.querySelector(".invoice-view"),y=document.createElement("div");y.id="invoice-print-portal",y.appendChild(r.cloneNode(!0)),document.body.appendChild(y),document.body.classList.add("printing-invoice"),window.onafterprint=()=>{document.title=i,document.body.classList.remove("printing-invoice"),document.body.removeChild(y),window.onafterprint=null},window.print()}function X(){const i=j.isAccountantRole?"/accountant":"/invoices";G.navigateBack(Y,i)}return(i,r)=>{const y=oe("router-link");return l(),c("div",null,[o.value?(l(),c(w,{key:1},[e("div",ue,[e("div",de,[e("button",{class:"btn btn--ghost btn--icon",onClick:X,title:a(n)("btn.back"),innerHTML:a(S)("arrow-left")},null,8,ve),e("div",null,[e("h1",_e,t(o.value.number),1),e("p",me,t(a(n)("page.invoiceView.subtitle")),1)])]),e("div",pe,[L(B,{label:a(x)(D.value),color:D.value.color},null,8,["label","color"]),L(B,{label:a(x)(b.value),color:b.value.color,dot:!0},null,8,["label","color"]),o.value.lifecycleStatus!=="completed"?(l(),V(y,{key:0,to:`/invoices/${o.value.id}/edit`,class:"btn btn--secondary"},{default:E(()=>[e("span",{innerHTML:a(S)("edit",16)},null,8,ye),u(" "+t(a(n)("btn.edit")),1)]),_:1},8,["to"])):d("",!0),C.value?(l(),V(y,{key:1,to:`/invoices/${o.value.id}/warranty`,class:"btn btn--secondary"},{default:E(()=>[e("span",{innerHTML:a(S)("shield",16)},null,8,he),u(" "+t(a(n)("btn.printWarranty")),1)]),_:1},8,["to"])):d("",!0),e("button",{class:"btn btn--primary",onClick:K},[e("span",{innerHTML:a(S)("printer",16)},null,8,be),u(" "+t(a(n)("btn.print")),1)])])]),e("div",ge,[e("div",fe,[e("div",we,[e("div",ke,[e("div",Le,[e("div",Se,t(m.value.name),1),e("div",xe,[u(t(a(n)("common.taxId"))+" "+t(m.value.taxId),1),r[0]||(r[0]=e("br",null,null,-1)),u(" "+t(m.value.address),1),r[1]||(r[1]=e("br",null,null,-1)),u(" "+t(m.value.phone),1),r[2]||(r[2]=e("br",null,null,-1)),u(" "+t(m.value.email),1),r[3]||(r[3]=e("br",null,null,-1)),m.value.website?(l(),c(w,{key:0},[u(t(m.value.website),1)],64)):d("",!0)])]),e("div",Ie,[e("div",Te,t(o.value.number),1),e("div",Me,[u(t(a(n)("common.date"))+" "+t(a(A)(o.value.createdAt))+" ",1),b.value.label==="Sold"&&o.value.soldDate?(l(),c(w,{key:0},[u("  |  "+t(a(n)("common.soldLabel"))+" "+t(a(A)(o.value.soldDate)),1)],64)):d("",!0)]),e("div",Ae,[g.value?(l(),c(w,{key:0},[e("div",Be,t(g.value.name),1),e("div",Ce,t(a(n)("common.taxId"))+" "+t(g.value.taxId),1),e("div",Ne,t(g.value.address),1),e("div",Ee,t(g.value.phone),1),e("div",He,t(g.value.email),1)],64)):(l(),c("div",De,t(a(n)("common.noBuyer")),1))])])]),e("div",Pe,[e("table",ze,[e("thead",null,[e("tr",null,[r[4]||(r[4]=e("th",null,"#",-1)),e("th",null,t(a(n)("col.product")),1),e("th",null,t(a(n)("col.brand")),1),e("th",null,t(a(n)("col.qty")),1),e("th",null,t(a(n)("col.price")),1),e("th",null,t(a(n)("col.total")),1),e("th",Ve,t(a(n)("col.status")),1),C.value?(l(),c("th",qe,t(a(n)("col.warranty")),1)):d("",!0)])]),e("tbody",null,[(l(!0),c(w,null,q(o.value.items,(s,M)=>(l(),c("tr",{key:M},[e("td",null,t(M+1),1),e("td",null,[e("strong",null,t(T(s.productId)?.name||a(n)("common.unknown")),1),T(s.productId)?(l(),c("div",Fe,t(T(s.productId).sku),1)):d("",!0)]),e("td",null,t(T(s.productId)?.brand||"—"),1),e("td",{class:h({"amount--canceled":s.itemStatus==="canceled"})},t(s.qty),3),e("td",{class:h({"amount--canceled":s.itemStatus==="canceled"})},t(a(_)(s.price)),3),e("td",{class:h(["font-semibold",{"amount--canceled":s.itemStatus==="canceled"}])},t(a(_)(s.qty*s.price)),3),e("td",$e,[L(B,{label:a(x)(z(s.itemStatus)),color:z(s.itemStatus).color},null,8,["label","color"])]),C.value?(l(),c("td",Re,t(s.warranty||"—"),1)):d("",!0)]))),128))])])]),e("div",We,[e("div",Ue,[e("div",Ye,[e("span",null,t(a(n)("payment.subtotal")),1),e("span",{class:h({"amount--canceled":b.value.label==="Canceled"})},t(a(_)(b.value.label==="Canceled"?o.value.totalAmount:f.value)),3)]),I.value>0?(l(),c("div",je,[e("span",null,t(a(n)("payment.paid")),1),e("span",Ge,t(a(_)(I.value)),1)])):d("",!0),N.value>0?(l(),c("div",Oe,[e("span",null,t(a(n)("payment.refunded")),1),e("span",Qe,"− "+t(a(_)(N.value)),1)])):d("",!0),P.value>0?(l(),c("div",Ze,[e("span",null,t(a(n)("payment.consignment")),1),e("span",Je,t(a(_)(P.value)),1)])):d("",!0),N.value>0?(l(),c("div",Ke,[e("span",null,t(a(n)("payment.netPaid")),1),e("span",null,t(a(_)(o.value.paidAmount)),1)])):d("",!0),b.value.label!=="Canceled"?(l(),c("div",{key:4,class:h(["invoice-view__summary-row invoice-view__summary-row--total",{"no-print":b.value.label==="Draft"}])},[e("span",null,t(p.value>0?a(n)("payment.remainingLabel"):p.value<0?a(n)("payment.refundDueLabel"):a(n)("payment.totalLabel")),1),e("span",null,t(p.value!==0?a(_)(Math.abs(p.value)):a(_)(f.value)),1)],2)):d("",!0)])]),o.value.payments.length>0?(l(),c("div",Xe,[e("h4",et,t(a(n)("payment.history")),1),e("div",tt,[e("div",at,[e("div",{class:h(["pmt-progress__fill",{"pmt-progress__fill--settled":p.value===0,"pmt-progress__fill--over":p.value<0}]),style:F({width:Z.value+"%"})},null,6)]),e("div",nt,[I.value>0?(l(),c("span",ot,t(a(n)("payment.paidLabel"))+" "+t(a(_)(I.value)),1)):(l(),c("span",st,t(a(n)("payment.noInbound")),1)),p.value>0?(l(),c("span",lt,t(a(n)("payment.remaining",{amount:a(_)(p.value)})),1)):p.value<0?(l(),c("span",it,t(a(n)("payment.refundDue",{amount:a(_)(Q.value)})),1)):(l(),c("span",ct,t(a(n)("payment.fullSettled")),1))])]),e("div",rt,[(l(!0),c(w,null,q(J.value,(s,M)=>(l(),c("div",{key:M,class:h(["pmt-ledger__entry",s.amount<0?"pmt-ledger__entry--out":"pmt-ledger__entry--in"])},[e("div",ut,[e("span",{innerHTML:a(S)(s.amount<0?"corner-up-left":"arrow-down-circle",15)},null,8,dt)]),e("div",vt,[L(B,{label:a(H)[s.method]?a(x)(a(H)[s.method]):s.method,color:a(H)[s.method]?.color||"neutral"},null,8,["label","color"]),e("span",_t,t(a(A)(s.date)),1)]),e("div",{class:h(["pmt-ledger__amount",s.amount<0?"pmt-ledger__amount--out":"pmt-ledger__amount--in"])},t(s.amount<0?"−":"+")+t(a(_)(Math.abs(s.amount))),3),e("div",{class:"pmt-ledger__balance",style:F({color:s.balance===0?"var(--color-success)":s.balance<0?"var(--color-warning)":"var(--color-text-tertiary)"})},t(s.balance===0?"✓":a(_)(Math.abs(s.balance))),5)],2))),128))])])):d("",!0),o.value.generalNote?(l(),c("div",mt,[e("strong",null,t(a(n)("common.note")),1),u(" "+t(o.value.generalNote),1)])):d("",!0),e("div",pt,[e("div",null,[e("div",yt,[u(t(a(n)("common.bank"))+" "+t(m.value.bankName1),1),r[5]||(r[5]=e("br",null,null,-1)),u(" "+t(a(n)("common.iban"))+" "+t(m.value.iban1),1)]),m.value.bankName2?(l(),c("div",ht,[u(t(a(n)("common.bank2"))+" "+t(m.value.bankName2),1),r[6]||(r[6]=e("br",null,null,-1)),u(" "+t(a(n)("common.iban"))+" "+t(m.value.iban2),1)])):d("",!0)]),e("div",null,[e("div",bt,t(a(n)("common.seller"))+" "+t(m.value.directorName),1),e("div",gt,t(a(n)("common.signature")),1)])]),e("div",ft,t(a(n)("common.createdBy"))+" "+t(O.value?.name||"—")+" | "+t(a(A)(o.value.createdAt)),1)])])])],64)):(l(),c("div",re,[e("h3",null,t(a(n)("page.invoiceView.notFound")),1),L(y,{to:"/invoices",class:"btn btn--primary"},{default:E(()=>[u(t(a(n)("btn.backToInvoices")),1)]),_:1})]))])}}};export{Lt as default};
