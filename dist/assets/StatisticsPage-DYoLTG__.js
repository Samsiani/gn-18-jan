import{a as ke,m as De,b as Se,k as p,W as $t,s as Ot,p as Te,n as vt,q as xe,o as d,c as _,d as t,t as l,e,x as b,i as y,z as m,F as C,r as O,j as R,R as tt,g as T,v as w,L as Ce,f as Rt,H as St,G as Tt,_ as we,D as k,X as Vt,B as j,l as Me,I as Ie,O as Pe,P as Et,w as Le,Q as xt,a3 as He,C as Ut}from"../gn-invoice.js";import{_ as x,u as Bt}from"./SortableHeader-rArAiVJm.js";import{_ as Nt,u as jt}from"./AppPagination-D5e3zrF_.js";import{_ as Fe}from"./AppTabs-BcecfYq9.js";import{_ as Ct}from"./AppBadge-BenmxPAy.js";import{_ as Ae,I as $e}from"./InvoiceActions-ZkZBOAub.js";import{_ as wt}from"./EmptyState-C5htIWVL.js";import{C as ht}from"./auto-sRkgK8jz.js";const Oe={class:"page-header"},Re={class:"page-header__title"},Ve={class:"page-header__subtitle",style:{margin:"0"}},Ee={class:"filter-bar",style:{"margin-bottom":"var(--space-4)"}},Ue={class:"tab-content",style:{"margin-top":"var(--space-6)"}},Be={key:0},Ne={class:"stats-kpi-grid"},je={class:"stat-card__header"},qe={class:"stat-card__label"},ze=["innerHTML"],We={class:"stat-card__value"},Ye={class:"stat-card__header"},Ge={class:"stat-card__label"},Ze=["innerHTML"],Qe={class:"stat-card__value"},Xe={class:"stat-card__header"},Je={class:"stat-card__label"},Ke=["innerHTML"],ts={class:"stat-card__value"},es={class:"stat-card__header"},ss={class:"stat-card__label"},as=["innerHTML"],os={class:"stat-card__value"},ls={class:"card",style:{"margin-bottom":"var(--space-6)"}},ns={class:"card__header"},is={class:"card__title"},rs={class:"card__body",style:{padding:"0"}},ds={class:"data-table-wrapper"},cs={class:"data-table"},us={class:"font-medium"},_s={class:"font-medium"},vs={style:{background:"var(--color-bg-tertiary)","border-radius":"var(--radius-full)",height:"8px",overflow:"hidden"}},hs={class:"stats-charts"},ps={class:"card"},ms={class:"card__header"},fs={class:"card__title"},gs={class:"chart-container"},bs={class:"card"},ys={class:"card__header"},ks={class:"card__title"},Ds={class:"chart-container"},Ss={class:"card"},Ts={class:"card__header"},xs={class:"card__title"},Cs={class:"card__body",style:{padding:"0"}},ws={class:"data-table-wrapper"},Ms={class:"data-table"},Is={style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},Ps={class:"sidebar__user-avatar",style:{width:"30px",height:"30px","font-size":"var(--text-xs)"}},Ls={class:"font-medium"},Hs={class:"font-medium"},Fs={key:1},As={class:"stats-kpi-grid",style:{"grid-template-columns":"repeat(3, 1fr)"}},$s={class:"card stat-card"},Os={class:"stat-card__header"},Rs={class:"stat-card__label"},Vs=["innerHTML"],Es={class:"stat-card__value"},Us={class:"card stat-card"},Bs={class:"stat-card__header"},Ns={class:"stat-card__label"},js=["innerHTML"],qs={class:"stat-card__value"},zs={class:"card stat-card"},Ws={class:"stat-card__header"},Ys={class:"stat-card__label"},Gs=["innerHTML"],Zs={class:"stat-card__value"},Qs={class:"card"},Xs={class:"card__header"},Js={class:"card__title"},Ks={class:"card__body",style:{padding:"0"}},ta={key:1,class:"data-table-wrapper"},ea={class:"data-table"},sa={class:"text-center",style:{width:"60px"}},aa=["onClick","href"],oa={class:"font-medium"},la={class:"text-center"},na={key:2},ia={class:"deposit-balance-card"},ra={class:"deposit-balance-card__label"},da={class:"deposit-balance-card__value"},ca={class:"card",style:{"margin-bottom":"var(--space-6)"}},ua={class:"card__header"},_a={class:"card__title"},va={class:"card__body"},ha={class:"deposit-form"},pa={class:"form-group",style:{margin:"0"}},ma={class:"form-label"},fa={class:"form-group",style:{margin:"0"}},ga={class:"form-label"},ba={class:"form-group",style:{margin:"0"}},ya={class:"form-label"},ka={value:"credit"},Da={value:"debit"},Sa={class:"form-group",style:{margin:"0"}},Ta={class:"form-label"},xa={style:{display:"flex",gap:"var(--space-2)"}},Ca=["placeholder"],wa=["innerHTML"],Ma={class:"card"},Ia={class:"card__header"},Pa={class:"card__title"},La={class:"card__body",style:{padding:"0"}},Ha={class:"data-table"},Fa={class:"text-center"},Aa={style:{"max-width":"250px"},class:"text-truncate"},$a={class:"text-center"},Oa=["onClick"],Ra=["innerHTML"],Va={key:3},Ea={class:"stats-kpi-grid",style:{"grid-template-columns":"repeat(3, 1fr)","margin-bottom":"var(--space-6)"}},Ua={class:"card stat-card"},Ba={class:"stat-card__header"},Na={class:"stat-card__label"},ja=["innerHTML"],qa={class:"stat-card__value"},za={class:"stat-card__sub"},Wa={class:"card stat-card"},Ya={class:"stat-card__header"},Ga={class:"stat-card__label"},Za=["innerHTML"],Qa={class:"stat-card__value"},Xa={class:"stat-card__sub"},Ja={class:"card stat-card"},Ka={class:"stat-card__header"},to={class:"stat-card__label"},eo=["innerHTML"],so={class:"stat-card__sub"},ao={class:"card",style:{"margin-bottom":"var(--space-6)"}},oo={class:"card__header"},lo={class:"card__title"},no={class:"card__body"},io={class:"deposit-form"},ro={class:"form-group",style:{margin:"0"}},co={class:"form-label"},uo={class:"form-group",style:{margin:"0"}},_o={class:"form-label"},vo={class:"form-group",style:{margin:"0"}},ho={class:"form-label"},po={style:{display:"flex",gap:"var(--space-2)"}},mo=["placeholder"],fo=["innerHTML"],go={class:"card"},bo={class:"card__header"},yo={class:"card__title"},ko={class:"card__body",style:{padding:"0"}},Do={key:1,class:"data-table"},So={class:"text-center",style:{width:"100px"}},To={class:"font-medium"},xo={style:{"max-width":"260px"},class:"text-truncate"},Co={class:"text-center"},wo={style:{display:"flex",gap:"4px","justify-content":"center"}},Mo=["onClick"],Io=["innerHTML"],Po=["onClick"],Lo=["innerHTML"],Ho=["placeholder"],Fo={class:"text-center"},Ao={style:{display:"flex",gap:"4px","justify-content":"center"}},$o=["onClick"],Oo=["innerHTML"],Ro=["innerHTML"],Vo={key:4},Eo={class:"card"},Uo={class:"card__header"},Bo={class:"card__title"},No={class:"card__body",style:{padding:"0"}},jo={class:"data-table"},qo={class:"font-medium"},zo={class:"font-medium"},Wo={key:5},Yo={class:"card",style:{"margin-bottom":"var(--space-6)"}},Go={class:"card__header"},Zo={class:"card__title"},Qo={class:"chart-container"},Xo={class:"card"},Jo={class:"card__header"},Ko={class:"card__title"},tl={style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},el=["placeholder"],sl=["innerHTML"],al={class:"card__body",style:{padding:"0"}},ol={class:"data-table"},ll={class:"font-medium"},nl={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},il={key:1},rl={class:"font-medium"},dl={style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},cl={style:{flex:"1","max-width":"60px",background:"var(--color-bg-tertiary)","border-radius":"var(--radius-full)",height:"6px",overflow:"hidden"}},ul={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},_l={key:1,style:{color:"var(--color-text-tertiary)"}},Dl={__name:"StatisticsPage",setup(vl){const Mt=Me(),h=ke(),et=De(),{showToast:D}=Ie(),{t:a,tLabel:qt,locale:zt}=Se(),Wt=k(()=>[{id:"overview",label:a("tab.overview")},{id:"fictive",label:a("tab.fictive")},{id:"deposits",label:a("tab.deposits")},{id:"other",label:a("tab.other")},{id:"customers",label:a("tab.customers")},{id:"products",label:a("tab.products")}]),S=p("overview"),H=p(""),F=p("");let q=[];const pt=p($t()),V=p(0),st=p("credit"),at=p(""),mt=p($t()),z=p(0),ot=p(""),lt=p(null),nt=p(""),W=p(0),it=p(""),A=p(""),E=p(!1),Y=p(""),G=p("");let Z=()=>{};const{sortField:Q,sortDir:X,toggleSort:Yt,sortItems:Gt}=Bt("filteredSpent","desc"),{currentPage:It,totalPages:Zt,paginate:Qt,resetPage:Xt}=jt(10),{sortField:M,sortDir:U,toggleSort:Jt,sortItems:Kt}=Bt("revenue","desc"),{currentPage:rt,totalPages:te,paginate:ee,resetPage:se}=jt(10),ft=p(null),gt=p(null),bt=p(null);function I(n){let o=h.invoices;return n&&(o=o.filter(s=>s.status===n)),n!=="fictive"&&(o=o.filter(s=>j(s).label!=="Canceled")),H.value&&(o=o.filter(s=>s.createdAt>=H.value)),F.value&&(o=o.filter(s=>s.createdAt<=F.value)),o}const P=k(()=>{const n=I("standard"),o=n.reduce((c,g)=>c+g.paidAmount,0),s=n.length,i=n.reduce((c,g)=>c+Math.max(0,Ut(g)-g.paidAmount),0),v=I().filter(c=>c.lifecycleStatus==="active"&&c.items.some(g=>g.itemStatus==="reserved")).length,f={};n.forEach(c=>{c.payments.forEach(g=>{g.method!=="refund"&&(f[g.method]=(f[g.method]||0)+g.amount)})});const u=Object.entries(f).sort((c,g)=>g[1]-c[1]),r=u.reduce((c,[,g])=>c+g,0);return{totalRevenue:o,totalInvoices:s,outstanding:i,pendingReservations:v,methodEntries:u,methodTotal:r}}),ae=k(()=>h.users.filter(n=>n.role!=="accountant").sort((n,o)=>o.revenue-n.revenue)),J=k(()=>{const n=I("fictive"),o=n.reduce((v,f)=>v+f.totalAmount,0),s=I().length,i=s>0?((s-n.length)/s*100).toFixed(1):0;return{count:n.length,totalAmount:o,convRate:i,invoices:n}}),oe=k(()=>[...h.deposits].sort((n,o)=>new Date(o.date)-new Date(n.date))),L=k(()=>{const n=H.value,o=F.value;let s=0;h.invoices.filter(r=>r.status==="standard"&&j(r).label!=="Canceled").forEach(r=>{r.payments.forEach(c=>{c.method==="other"&&(n&&c.date<n||o&&c.date>o||(s+=c.amount))})});const i=h.otherDeliveries.filter(r=>(!n||r.date>=n)&&(!o||r.date<=o)).reduce((r,c)=>r+c.amount,0);let v=0;h.invoices.filter(r=>r.status==="standard"&&j(r).label!=="Canceled").forEach(r=>{r.payments.forEach(c=>{c.method==="other"&&(v+=c.amount)})});const f=h.otherDeliveries.reduce((r,c)=>r+c.amount,0),u=v-f;return{accumulated:s,delivered:i,balance:u}}),Pt=k(()=>[...h.otherDeliveries].sort((n,o)=>new Date(o.date)-new Date(n.date)));function le(){if(z.value<=0){D("warning",a("msg.enterValidAmount"));return}h.addOtherDelivery({id:Vt(h.otherDeliveries),date:mt.value,amount:z.value,note:ot.value}),D("success",a("msg.recordAdded")),z.value=0,ot.value=""}function ne(n){lt.value=n.id,nt.value=n.date,W.value=n.amount,it.value=n.note}function ie(n){if(W.value<=0){D("warning",a("msg.enterValidAmount"));return}h.updateOtherDelivery(n,{date:nt.value,amount:W.value,note:it.value}),lt.value=null,D("success",a("msg.recordUpdated"))}function re(n){Y.value=a("msg.titleDeleteRecord"),G.value=a("msg.confirmDeleteRecord"),Z=()=>{h.deleteOtherDelivery(n),D("success",a("msg.recordDeleted"))},E.value=!0}const Lt=k(()=>{const n=I("standard");return h.customers.map(o=>{const s=n.filter(i=>i.customerId===o.id);return{...o,filteredSpent:s.reduce((i,v)=>i+v.paidAmount,0),filteredCount:s.length,filteredOutstanding:s.reduce((i,v)=>i+Math.max(0,Ut(v)-v.paidAmount),0)}})}),de=k(()=>Qt(Gt(Lt.value))),yt=k(()=>{const n={};I("standard").forEach(s=>{s.items.forEach(i=>{i.itemStatus!=="canceled"&&(n[i.productId]||(n[i.productId]={unitsSold:0,revenue:0,reserved:0,prices:[]}),n[i.productId].unitsSold+=i.qty,n[i.productId].revenue+=i.qty*i.price,n[i.productId].prices.push(i.price),i.itemStatus==="reserved"&&(n[i.productId].reserved+=i.qty))})});let o=Object.entries(n).map(([s,i])=>{const v=h.productById(parseInt(s));return{...i,product:v,_name:v?v.name:"",_sku:v?v.sku:"",_brand:v?v.brand:"",avgPrice:i.prices.length>0?i.prices.reduce((f,u)=>f+u,0)/i.prices.length:0}});if(A.value){const s=A.value.toLowerCase();o=o.filter(i=>i._name.toLowerCase().includes(s)||i._sku.toLowerCase().includes(s)||i._brand.toLowerCase().includes(s))}return o}),dt=k(()=>yt.value.reduce((n,o)=>n+o.revenue,0)),Ht=k(()=>{const n=M.value==="name"?"_name":M.value==="sku"?"_sku":M.value;return ee(Kt(yt.value,n))});function ce(){ut(),vt(()=>_t())}function K(n){Yt(n),Xt()}function B(n){Jt(n),se()}const ue=Pe(()=>{rt.value=1},250);function _e(){ue()}function ve(n){const o=h.customerById(n);return o?o.name:"—"}function he(n){const o=h.userById(n);return o?o.name:"—"}function ct(n,o){let s=n;const i=[];if(H.value&&i.push(`dateFrom=${H.value}`),F.value&&i.push(`dateTo=${F.value}`),i.length&&(s+=(s.includes("?")?"&":"?")+i.join("&")),o){const v={outstanding:"remaining",reserved:"lifecycle",completed:"lifecycle"},f=s.match(/filter=(\w+)/);f&&v[f[1]]&&et.setDrilldownHighlight(v[f[1]]),o==="remaining"&&et.setDrilldownHighlight("remaining"),o==="lifecycle"&&et.setDrilldownHighlight("lifecycle")}Mt.push(s)}function Ft(n){et.setNavReturn("/statistics"),Mt.push(`/invoices/${n}`)}function pe(n){Y.value=a("msg.titleMarkSold"),G.value=a("msg.confirmMarkSold",{number:n.number}),Z=()=>{const o=h.invoiceById(n.id);if(o){if(o.totalAmount-o.paidAmount>0){D("warning",a("msg.outstandingWarning",{number:o.number}));return}o.items.forEach(s=>{s.itemStatus!=="none"&&(s.itemStatus="sold")}),o.saleDate=o.saleDate||new Date().toISOString().split("T")[0],o.soldDate=o.soldDate||new Date().toISOString().split("T")[0],o.lifecycleStatus="sold",h.saveInvoice({...o}),D("success",a("msg.invoiceMarkedSold",{number:o.number}))}},E.value=!0}function me(n){Y.value=a("msg.titleDeleteInvoice"),G.value=a("msg.confirmDelete",{number:n.number}),Z=()=>{h.deleteInvoice(n.id),D("success",a("msg.invoiceDeleted"))},E.value=!0}function fe(){if(V.value<=0){D("warning",a("msg.enterValidAmount"));return}h.addDeposit({id:Vt(h.deposits),date:pt.value,amount:st.value==="debit"?-Math.abs(V.value):Math.abs(V.value),type:st.value,note:at.value,customerId:null}),D("success",a("msg.transactionAdded")),V.value=0,at.value=""}function ge(n){Y.value=a("msg.titleDeleteTx"),G.value=a("msg.confirmDeleteTx"),Z=()=>{h.deleteDeposit(n),D("success",a("msg.transactionDeleted"))},E.value=!0}function ut(){q.forEach(n=>n.destroy()),q=[]}function _t(){S.value==="overview"&&be(),S.value==="products"&&ye()}function be(){const n=getComputedStyle(document.documentElement),o=n.getPropertyValue("--color-primary").trim()||"#4f46e5",s="#16a34a",i="#f59e0b",v=n.getPropertyValue("--color-border").trim()||"#e2e8f0";ht.defaults.font.family="'FiraGO', sans-serif";const f=new Date,u=[];for(let r=5;r>=0;r--){const c=new Date(f.getFullYear(),f.getMonth()-r,1),g=c.toLocaleDateString("en",{month:"short"}),kt=new Date(c.getFullYear(),c.getMonth(),1).toISOString().split("T")[0],$=new Date(c.getFullYear(),c.getMonth()+1,0).toISOString().split("T")[0],At=I("standard").filter(N=>N.createdAt>=kt&&N.createdAt<=$);u.push({label:g,revenue:At.reduce((N,Dt)=>N+Dt.totalAmount,0),cashIn:At.reduce((N,Dt)=>N+Dt.paidAmount,0)})}if(ft.value&&q.push(new ht(ft.value,{type:"line",data:{labels:u.map(r=>r.label),datasets:[{label:a("chart.revenue"),data:u.map(r=>r.revenue),borderColor:o,backgroundColor:o+"20",fill:!0,tension:.4},{label:a("chart.cashIn"),data:u.map(r=>r.cashIn),borderColor:s,backgroundColor:s+"20",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${m(r.raw)}`}}},scales:{y:{beginAtZero:!0,grid:{color:v+"80"},ticks:{callback:r=>m(r)}},x:{grid:{display:!1}}}}})),gt.value){const r=I(),c=r.filter($=>j($).label==="Sold").length,g=r.filter($=>j($).label==="Reserved").length,kt=r.filter($=>j($).label==="Draft").length;q.push(new ht(gt.value,{type:"doughnut",data:{labels:[a("chart.sold"),a("chart.reserved"),a("chart.draft")],datasets:[{data:[c,g,kt],backgroundColor:[s+"cc",o+"cc",i+"cc"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},cutout:"65%"}}))}}function ye(){const n=getComputedStyle(document.documentElement),o=n.getPropertyValue("--color-primary").trim()||"#4f46e5",s=n.getPropertyValue("--color-border").trim()||"#e2e8f0",i={};I("standard").forEach(u=>{u.items.forEach(r=>{i[r.productId]=(i[r.productId]||0)+r.qty*r.price})});const v=Object.entries(i).map(([u,r])=>({name:h.productById(parseInt(u))?.name||a("common.unknown"),revenue:r})).sort((u,r)=>r.revenue-u.revenue).slice(0,5),f=[o,"#16a34a","#f59e0b","#0ea5e9","#dc2626"];bt.value&&q.push(new ht(bt.value,{type:"bar",data:{labels:v.map(u=>u.name.length>25?u.name.slice(0,25)+"...":u.name),datasets:[{label:a("chart.revenue"),data:v.map(u=>u.revenue),backgroundColor:f.map(u=>u+"cc"),borderColor:f,borderWidth:1,borderRadius:6,barPercentage:.5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:u=>m(u.raw)}}},scales:{x:{beginAtZero:!0,grid:{color:s+"80"},ticks:{callback:u=>m(u)}},y:{grid:{display:!1}}}}}))}return Ot(S,()=>{ut(),vt(()=>_t())}),Ot(zt,()=>{ut(),vt(()=>_t())}),Te(()=>{vt(()=>_t())}),xe(()=>ut()),(n,o)=>(d(),_("div",null,[t("div",Oe,[t("div",null,[t("h1",Re,l(e(a)("page.statistics.title")),1),t("p",Ve,l(e(a)("page.statistics.subtitle")),1)])]),t("div",Ee,[b(Ae,{dateFrom:H.value,"onUpdate:dateFrom":o[0]||(o[0]=s=>H.value=s),dateTo:F.value,"onUpdate:dateTo":o[1]||(o[1]=s=>F.value=s),prefix:"stats",onChange:ce},null,8,["dateFrom","dateTo"])]),b(Fe,{tabs:Wt.value,modelValue:S.value,"onUpdate:modelValue":o[2]||(o[2]=s=>S.value=s)},null,8,["tabs","modelValue"]),t("div",Ue,[S.value==="overview"?(d(),_("div",Be,[t("div",Ne,[t("div",{class:"card stat-card",onClick:o[3]||(o[3]=s=>ct("/invoices")),style:{cursor:"pointer"}},[t("div",je,[t("span",qe,l(e(a)("page.statistics.totalRevenue")),1),t("div",{class:"stat-card__icon stat-card__icon--success",innerHTML:e(y)("dollar-sign")},null,8,ze)]),t("div",We,l(e(m)(P.value.totalRevenue)),1)]),t("div",{class:"card stat-card",onClick:o[4]||(o[4]=s=>ct("/invoices")),style:{cursor:"pointer"}},[t("div",Ye,[t("span",Ge,l(e(a)("page.statistics.totalInvoices")),1),t("div",{class:"stat-card__icon stat-card__icon--primary",innerHTML:e(y)("file-text")},null,8,Ze)]),t("div",Qe,l(P.value.totalInvoices),1)]),t("div",{class:"card stat-card",onClick:o[5]||(o[5]=s=>ct("/invoices?filter=reserved","lifecycle")),style:{cursor:"pointer"}},[t("div",Xe,[t("span",Je,l(e(a)("page.statistics.pendingReservations")),1),t("div",{class:"stat-card__icon stat-card__icon--warning",innerHTML:e(y)("clock")},null,8,Ke)]),t("div",ts,l(P.value.pendingReservations),1)]),t("div",{class:"card stat-card",onClick:o[6]||(o[6]=s=>ct("/invoices?filter=outstanding","remaining")),style:{cursor:"pointer"}},[t("div",es,[t("span",ss,l(e(a)("page.statistics.outstanding")),1),t("div",{class:"stat-card__icon stat-card__icon--danger",innerHTML:e(y)("wallet")},null,8,as)]),t("div",os,l(e(m)(P.value.outstanding)),1)])]),t("div",ls,[t("div",ns,[t("h3",is,l(e(a)("page.statistics.methodBreakdown")),1)]),t("div",rs,[t("div",ds,[t("table",cs,[t("thead",null,[t("tr",null,[t("th",null,l(e(a)("col.method")),1),t("th",null,l(e(a)("col.amount")),1),t("th",null,l(e(a)("col.share")),1),t("th",null,l(e(a)("col.distribution")),1)])]),t("tbody",null,[(d(!0),_(C,null,O(P.value.methodEntries,([s,i])=>(d(),_("tr",{key:s},[t("td",us,l(e(Et)[s]?e(qt)(e(Et)[s]):s),1),t("td",_s,l(e(m)(i)),1),t("td",null,l(P.value.methodTotal>0?(i/P.value.methodTotal*100).toFixed(1):0)+"%",1),t("td",null,[t("div",vs,[t("div",{style:Tt([{background:"var(--color-primary)",height:"100%","border-radius":"var(--radius-full)"},{width:(P.value.methodTotal>0?i/P.value.methodTotal*100:0)+"%"}])},null,4)])])]))),128))])])])])]),t("div",hs,[t("div",ps,[t("div",ms,[t("h3",fs,l(e(a)("page.statistics.revenueVsCash")),1)]),t("div",gs,[t("canvas",{ref_key:"revenueChartRef",ref:ft},null,512)])]),t("div",bs,[t("div",ys,[t("h3",ks,l(e(a)("page.statistics.distribution")),1)]),t("div",Ds,[t("canvas",{ref_key:"distributionChartRef",ref:gt},null,512)])])]),t("div",Ss,[t("div",Ts,[t("h3",xs,l(e(a)("page.statistics.topUsers")),1)]),t("div",Cs,[t("div",ws,[t("table",Ms,[t("thead",null,[t("tr",null,[t("th",null,l(e(a)("col.user")),1),t("th",null,l(e(a)("col.invoices")),1),t("th",null,l(e(a)("col.revenue")),1),t("th",null,l(e(a)("col.average")),1)])]),t("tbody",null,[(d(!0),_(C,null,O(ae.value,s=>(d(),_("tr",{key:s.id},[t("td",null,[t("div",Is,[t("div",Ps,l(s.avatar),1),t("span",Ls,l(s.name),1)])]),t("td",null,l(s.invoiceCount),1),t("td",Hs,l(e(m)(s.revenue)),1),t("td",null,l(e(m)(s.invoiceCount>0?s.revenue/s.invoiceCount:0)),1)]))),128))])])])])])])):R("",!0),S.value==="fictive"?(d(),_("div",Fs,[t("div",As,[t("div",$s,[t("div",Os,[t("span",Rs,l(e(a)("page.statistics.fictiveInvoices")),1),t("div",{class:"stat-card__icon stat-card__icon--warning",innerHTML:e(y)("file-text")},null,8,Vs)]),t("div",Es,l(J.value.count),1)]),t("div",Us,[t("div",Bs,[t("span",Ns,l(e(a)("page.statistics.totalValue")),1),t("div",{class:"stat-card__icon stat-card__icon--info",innerHTML:e(y)("dollar-sign")},null,8,js)]),t("div",qs,l(e(m)(J.value.totalAmount)),1)]),t("div",zs,[t("div",Ws,[t("span",Ys,l(e(a)("page.statistics.conversionRate")),1),t("div",{class:"stat-card__icon stat-card__icon--success",innerHTML:e(y)("trending-up")},null,8,Gs)]),t("div",Zs,l(J.value.convRate)+"%",1)])]),t("div",Qs,[t("div",Xs,[t("h3",Js,l(e(a)("page.statistics.fictiveList")),1)]),t("div",Ks,[J.value.invoices.length===0?(d(),tt(wt,{key:0,title:e(a)("page.statistics.noFictive"),message:e(a)("page.statistics.allStandard")},null,8,["title","message"])):(d(),_("div",ta,[t("table",ea,[t("thead",null,[t("tr",null,[t("th",null,l(e(a)("col.invoiceNumber")),1),t("th",null,l(e(a)("col.date")),1),t("th",null,l(e(a)("col.customer")),1),t("th",null,l(e(a)("col.amount")),1),t("th",null,l(e(a)("col.author")),1),t("th",sa,l(e(a)("col.actions")),1)])]),t("tbody",null,[(d(!0),_(C,null,O(J.value.invoices,s=>(d(),_("tr",{key:s.id},[t("td",null,[t("a",{onClick:Le(i=>Ft(s.id),["prevent"]),href:`#/invoices/${s.id}`,class:"font-semibold"},l(s.number),9,aa)]),t("td",null,l(e(xt)(s.createdAt)),1),t("td",null,l(ve(s.customerId)),1),t("td",oa,l(e(m)(s.totalAmount)),1),t("td",null,l(he(s.authorId)),1),t("td",la,[b($e,{invoice:s,onView:i=>Ft(s.id),onEdit:i=>n.$router.push(`/invoices/${s.id}/edit`),onMarkSold:i=>pe(s),onDelete:i=>me(s)},null,8,["invoice","onView","onEdit","onMarkSold","onDelete"])])]))),128))])])]))])])])):R("",!0),S.value==="deposits"?(d(),_("div",na,[t("div",ia,[t("div",ra,l(e(a)("page.statistics.currentBalance")),1),t("div",da,l(e(m)(e(h).depositBalance)),1)]),t("div",ca,[t("div",ua,[t("h3",_a,l(e(a)("page.statistics.addTransaction")),1)]),t("div",va,[t("div",ha,[t("div",pa,[t("label",ma,l(e(a)("form.date")),1),T(t("input",{type:"date",class:"form-input","onUpdate:modelValue":o[7]||(o[7]=s=>pt.value=s)},null,512),[[w,pt.value]])]),t("div",fa,[t("label",ga,l(e(a)("form.amount")),1),T(t("input",{type:"number",class:"form-input","onUpdate:modelValue":o[8]||(o[8]=s=>V.value=s),step:"0.01",placeholder:"0.00"},null,512),[[w,V.value,void 0,{number:!0}]])]),t("div",ba,[t("label",ya,l(e(a)("form.type")),1),T(t("select",{class:"form-select","onUpdate:modelValue":o[9]||(o[9]=s=>st.value=s)},[t("option",ka,l(e(a)("filter.creditIn")),1),t("option",Da,l(e(a)("filter.debitOut")),1)],512),[[Ce,st.value]])]),t("div",Sa,[t("label",Ta,l(e(a)("col.note")),1),t("div",xa,[T(t("input",{type:"text",class:"form-input","onUpdate:modelValue":o[10]||(o[10]=s=>at.value=s),placeholder:e(a)("form.description")},null,8,Ca),[[w,at.value]]),t("button",{class:"btn btn--primary",onClick:fe},[t("span",{innerHTML:e(y)("plus",14)},null,8,wa),Rt(" "+l(e(a)("btn.add")),1)])])])])])]),t("div",Ma,[t("div",Ia,[t("h3",Pa,l(e(a)("page.statistics.txHistory")),1)]),t("div",La,[t("table",Ha,[t("thead",null,[t("tr",null,[t("th",null,l(e(a)("col.date")),1),t("th",null,l(e(a)("form.type")),1),t("th",null,l(e(a)("col.amount")),1),t("th",null,l(e(a)("col.note")),1),t("th",Fa,l(e(a)("col.actions")),1)])]),t("tbody",null,[(d(!0),_(C,null,O(oe.value,s=>(d(),_("tr",{key:s.id},[t("td",null,l(e(xt)(s.date)),1),t("td",null,[b(Ct,{label:s.type==="credit"?e(a)("filter.creditIn"):e(a)("filter.debitOut"),color:s.type==="credit"?"success":"danger"},null,8,["label","color"])]),t("td",{class:St(["font-medium",s.amount>=0?"text-success":"text-danger"])},l(e(m)(Math.abs(s.amount))),3),t("td",Aa,l(s.note),1),t("td",$a,[t("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:i=>ge(s.id)},[t("span",{innerHTML:e(y)("trash-2",14)},null,8,Ra)],8,Oa)])]))),128))])])])])])):R("",!0),S.value==="other"?(d(),_("div",Va,[t("div",Ea,[t("div",Ua,[t("div",Ba,[t("span",Na,l(e(a)("page.statistics.accumulated")),1),t("div",{class:"stat-card__icon stat-card__icon--primary",innerHTML:e(y)("trending-up")},null,8,ja)]),t("div",qa,l(e(m)(L.value.accumulated)),1),t("div",za,l(e(a)("page.statistics.selectedPeriod")),1)]),t("div",Wa,[t("div",Ya,[t("span",Ga,l(e(a)("page.statistics.delivered")),1),t("div",{class:"stat-card__icon stat-card__icon--success",innerHTML:e(y)("check-circle")},null,8,Za)]),t("div",Qa,l(e(m)(L.value.delivered)),1),t("div",Xa,l(e(a)("page.statistics.selectedPeriod")),1)]),t("div",Ja,[t("div",Ka,[t("span",to,l(e(a)("page.statistics.currentBalance")),1),t("div",{class:St(["stat-card__icon",L.value.balance>=0?"stat-card__icon--warning":"stat-card__icon--success"]),innerHTML:e(y)("wallet")},null,10,eo)]),t("div",{class:"stat-card__value",style:Tt({color:L.value.balance>0?"var(--color-warning)":L.value.balance<0?"var(--color-success)":"var(--color-text-primary)"})},l(e(m)(Math.abs(L.value.balance))),5),t("div",so,l(L.value.balance>0?e(a)("page.statistics.remainingDebt"):L.value.balance<0?e(a)("page.statistics.overDelivered"):e(a)("page.statistics.fullySettled")),1)])]),t("div",ao,[t("div",oo,[t("h3",lo,l(e(a)("page.statistics.addDelivery")),1)]),t("div",no,[t("div",io,[t("div",ro,[t("label",co,l(e(a)("form.date")),1),T(t("input",{type:"date",class:"form-input","onUpdate:modelValue":o[11]||(o[11]=s=>mt.value=s)},null,512),[[w,mt.value]])]),t("div",uo,[t("label",_o,l(e(a)("form.amount")),1),T(t("input",{type:"number",class:"form-input","onUpdate:modelValue":o[12]||(o[12]=s=>z.value=s),step:"0.01",placeholder:"0.00"},null,512),[[w,z.value,void 0,{number:!0}]])]),t("div",vo,[t("label",ho,l(e(a)("col.note")),1),t("div",po,[T(t("input",{type:"text",class:"form-input","onUpdate:modelValue":o[13]||(o[13]=s=>ot.value=s),placeholder:e(a)("form.description")},null,8,mo),[[w,ot.value]]),t("button",{class:"btn btn--primary",onClick:le},[t("span",{innerHTML:e(y)("plus",14)},null,8,fo),Rt(" "+l(e(a)("btn.add")),1)])])])])])]),t("div",go,[t("div",bo,[t("h3",yo,l(e(a)("page.statistics.deliveryRecords")),1)]),t("div",ko,[Pt.value.length===0?(d(),tt(wt,{key:0,title:e(a)("page.statistics.noRecords"),message:e(a)("page.statistics.addDeliveryAbove")},null,8,["title","message"])):(d(),_("table",Do,[t("thead",null,[t("tr",null,[t("th",null,l(e(a)("col.date")),1),t("th",null,l(e(a)("col.amount")),1),t("th",null,l(e(a)("col.note")),1),t("th",So,l(e(a)("col.actions")),1)])]),t("tbody",null,[(d(!0),_(C,null,O(Pt.value,s=>(d(),_("tr",{key:s.id},[lt.value!==s.id?(d(),_(C,{key:0},[t("td",null,l(e(xt)(s.date)),1),t("td",To,l(e(m)(s.amount)),1),t("td",xo,l(s.note||"—"),1),t("td",Co,[t("div",wo,[t("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:i=>ne(s),"data-tooltip":"Edit"},[t("span",{innerHTML:e(y)("edit",14)},null,8,Io)],8,Mo),t("button",{class:"btn btn--ghost btn--icon btn--sm",style:{color:"var(--color-danger)"},onClick:i=>re(s.id),"data-tooltip":"Delete"},[t("span",{innerHTML:e(y)("trash-2",14)},null,8,Lo)],8,Po)])])],64)):(d(),_(C,{key:1},[t("td",null,[T(t("input",{type:"date",class:"form-input form-input--sm","onUpdate:modelValue":o[14]||(o[14]=i=>nt.value=i)},null,512),[[w,nt.value]])]),t("td",null,[T(t("input",{type:"number",class:"form-input form-input--sm","onUpdate:modelValue":o[15]||(o[15]=i=>W.value=i),step:"0.01"},null,512),[[w,W.value,void 0,{number:!0}]])]),t("td",null,[T(t("input",{type:"text",class:"form-input form-input--sm","onUpdate:modelValue":o[16]||(o[16]=i=>it.value=i),placeholder:e(a)("form.description")},null,8,Ho),[[w,it.value]])]),t("td",Fo,[t("div",Ao,[t("button",{class:"btn btn--primary btn--sm",onClick:i=>ie(s.id)},[t("span",{innerHTML:e(y)("check",14)},null,8,Oo)],8,$o),t("button",{class:"btn btn--ghost btn--sm",onClick:o[17]||(o[17]=i=>lt.value=null)},[t("span",{innerHTML:e(y)("x",14)},null,8,Ro)])])])],64))]))),128))])]))])])])):R("",!0),S.value==="customers"?(d(),_("div",Vo,[t("div",Eo,[t("div",Uo,[t("h3",Bo,l(e(a)("page.statistics.customerAnalysis")),1)]),t("div",No,[t("table",jo,[t("thead",null,[t("tr",null,[b(x,{label:e(a)("col.customer"),field:"name",sortField:e(Q),sortDir:e(X),onSort:K},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.taxId"),field:"taxId",sortField:e(Q),sortDir:e(X),onSort:K},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("page.statistics.totalPurchases"),field:"filteredSpent",sortField:e(Q),sortDir:e(X),onSort:K},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.invoices"),field:"filteredCount",sortField:e(Q),sortDir:e(X),onSort:K},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.outstanding"),field:"filteredOutstanding",sortField:e(Q),sortDir:e(X),onSort:K},null,8,["label","sortField","sortDir"])])]),t("tbody",null,[(d(!0),_(C,null,O(de.value,s=>(d(),_("tr",{key:s.id,style:{cursor:"pointer"},onClick:o[18]||(o[18]=i=>n.$router.push("/customers"))},[t("td",qo,l(s.name),1),t("td",null,l(s.taxId),1),t("td",zo,l(e(m)(s.filteredSpent)),1),t("td",null,l(s.filteredCount),1),t("td",{class:St(s.filteredOutstanding>0?"text-danger font-semibold":"")},l(e(m)(s.filteredOutstanding)),3)]))),128))])]),b(Nt,{currentPage:e(It),totalPages:e(Zt),total:Lt.value.length,onPageChange:o[19]||(o[19]=s=>It.value=s)},null,8,["currentPage","totalPages","total"])])])])):R("",!0),S.value==="products"?(d(),_("div",Wo,[t("div",Yo,[t("div",Go,[t("h3",Zo,l(e(a)("page.statistics.topProducts")),1)]),t("div",Qo,[t("canvas",{ref_key:"productChartRef",ref:bt},null,512)])]),t("div",Xo,[t("div",Jo,[t("h3",Ko,l(e(a)("page.statistics.productDetails")),1),t("div",tl,[T(t("input",{type:"text",class:"form-input form-input--search","onUpdate:modelValue":o[20]||(o[20]=s=>A.value=s),onInput:_e,placeholder:e(a)("page.stock.searchPlaceholder"),style:{"min-width":"250px"}},null,40,el),[[w,A.value]]),A.value?(d(),_("button",{key:0,class:"btn btn--ghost btn--sm",onClick:o[21]||(o[21]=s=>{A.value="",rt.value=1})},[t("span",{innerHTML:e(y)("x",14)},null,8,sl)])):R("",!0)])]),t("div",al,[Ht.value.length===0?(d(),tt(wt,{key:0,title:e(a)("common.noData"),message:A.value?e(a)("common.tryDifferent"):e(a)("common.noProductData")},null,8,["title","message"])):(d(),_(C,{key:1},[t("table",ol,[t("thead",null,[t("tr",null,[b(x,{label:e(a)("col.product"),field:"name",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.sku"),field:"sku",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"]),t("th",null,l(e(a)("col.brand")),1),b(x,{label:e(a)("col.units"),field:"unitsSold",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.revenue"),field:"revenue",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"]),t("th",null,l(e(a)("col.share")),1),b(x,{label:e(a)("col.avgPrice"),field:"avgPrice",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"]),b(x,{label:e(a)("col.reserved"),field:"reserved",sortField:e(M),sortDir:e(U),onSort:B},null,8,["label","sortField","sortDir"])])]),t("tbody",null,[(d(!0),_(C,null,O(Ht.value,s=>(d(),_("tr",{key:s._name},[t("td",ll,l(s.product?s.product.name:e(a)("common.unknown")),1),t("td",null,[t("code",nl,l(s.product?s.product.sku:"—"),1)]),t("td",null,[s._brand?(d(),tt(Ct,{key:0,label:s._brand,color:"neutral"},null,8,["label"])):(d(),_("span",il,"—"))]),t("td",null,l(e(He)(s.unitsSold)),1),t("td",rl,l(e(m)(s.revenue)),1),t("td",null,[t("div",dl,[t("div",cl,[t("div",{style:Tt([{background:"var(--color-primary)",height:"100%","border-radius":"var(--radius-full)"},{width:dt.value>0?s.revenue/dt.value*100+"%":"0%"}])},null,4)]),t("span",ul,l(dt.value>0?(s.revenue/dt.value*100).toFixed(1):0)+"%",1)])]),t("td",null,l(e(m)(s.avgPrice)),1),t("td",null,[s.reserved>0?(d(),tt(Ct,{key:0,label:s.reserved.toString(),color:"warning"},null,8,["label"])):(d(),_("span",_l,"0"))])]))),128))])]),b(Nt,{currentPage:e(rt),totalPages:e(te),total:yt.value.length,onPageChange:o[22]||(o[22]=s=>rt.value=s)},null,8,["currentPage","totalPages","total"])],64))])])])):R("",!0)]),b(we,{visible:E.value,"onUpdate:visible":o[23]||(o[23]=s=>E.value=s),title:Y.value,message:G.value,danger:!0,onConfirm:e(Z)},null,8,["visible","title","message","onConfirm"])]))}};export{Dl as default};
