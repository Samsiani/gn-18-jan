import{a as et,u as st,V as ot,b as at,o as d,c as r,d as t,t as o,e,j as E,i as u,g as nt,v as lt,x as g,F as it,r as ct,A as q,z as F,a3 as p,G as dt,H as x,f as b,k as D,D as T,O as rt,I as ut,a4 as L,n as _t}from"../gn-invoice.js";import{_ as K,u as vt}from"./SortableHeader-rArAiVJm.js";import{_ as pt,u as ht}from"./AppPagination-D5e3zrF_.js";import{_ as mt}from"./SlidePanel-C0PmUBV1.js";const kt={class:"page-header"},gt={class:"page-header__title"},bt={class:"page-header__subtitle",style:{margin:"0"}},ft={class:"page-header__actions"},yt={key:0,class:"badge badge--primary"},wt={class:"stock-header"},Ct={class:"stock-header__search"},xt={style:{position:"relative"}},Tt=["innerHTML"],Lt=["placeholder"],St={class:"data-table-wrapper",style:{"overflow-x":"hidden"}},Mt={class:"data-table",style:{"table-layout":"fixed"}},Ht={class:"text-center"},Pt={class:"stock-thumb"},It={style:{overflow:"hidden"}},Ft={class:"font-medium",style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Dt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Kt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)","margin-top":"1px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},zt={style:{"font-size":"var(--text-sm)",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},$t={key:0,style:{padding:"var(--space-1) var(--space-2)"}},Nt={key:1,class:"inline-edit"},Vt=["value","onKeydown"],Ut={class:"inline-edit__actions"},Bt=["onClick"],Et=["innerHTML"],qt=["innerHTML"],At=["onClick"],jt={key:0,style:{padding:"var(--space-1) var(--space-2)"}},Ot={key:1,class:"inline-edit"},Gt=["value","onKeydown"],Qt={class:"inline-edit__actions"},Rt=["onClick"],Yt=["innerHTML"],Jt=["innerHTML"],Wt=["onClick"],Xt={class:"font-medium"},Zt={class:"text-center"},te={style:{display:"flex",gap:"4px","justify-content":"center"}},ee=["onClick","data-tooltip"],se=["innerHTML"],oe=["onClick","data-tooltip"],ae=["innerHTML"],ne={key:0,class:"product-detail"},le={class:"product-detail__image-placeholder"},ie=["innerHTML"],ce={style:{"margin-top":"var(--space-2)","font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},de={class:"product-detail__name"},re={style:{"font-size":"var(--text-sm)",color:"var(--color-text-tertiary)","margin-bottom":"var(--space-4)"}},ue={class:"product-detail__meta"},_e={class:"product-detail__meta-item"},ve={class:"product-detail__meta-label"},pe={class:"product-detail__meta-value"},he={class:"product-detail__meta-item"},me={class:"product-detail__meta-value"},ke={class:"product-detail__meta-item"},ge={class:"product-detail__meta-label"},be={class:"product-detail__meta-value"},fe={class:"product-detail__meta-item"},ye={class:"product-detail__meta-label"},we={class:"product-detail__meta-value font-semibold"},Ce={style:{"font-size":"var(--text-sm)",color:"var(--color-text-secondary)","margin-bottom":"var(--space-6)"}},xe={style:{"font-size":"var(--text-md)","font-weight":"var(--font-weight-semibold)","margin-bottom":"var(--space-3)"}},Te={class:"product-detail__stock-grid"},Le={class:"product-detail__stock-item"},Se={class:"product-detail__stock-value"},Me={class:"product-detail__stock-label"},He={class:"product-detail__stock-item"},Pe={class:"product-detail__stock-value",style:{color:"var(--color-warning)"}},Ie={class:"product-detail__stock-label"},Fe={class:"product-detail__stock-item"},De={class:"product-detail__stock-label"},Ke={style:{"margin-bottom":"var(--space-6)"}},ze=["innerHTML"],Ee={__name:"StockPage",setup($e){const h=et(),m=st(),_=ot(),{showToast:S}=ut(),{t:a}=at(),{sortField:M,sortDir:H,toggleSort:A,sortItems:j}=vt("name","asc"),{currentPage:z,totalPages:O,paginate:G,resetPage:$}=ht(20),f=D(""),v=D(null),k=D(null);function N(l){l&&_t(()=>{l.focus(),l.select()})}const V=T(()=>{let l=[...h.products];if(f.value){const n=f.value.toLowerCase();l=l.filter(s=>s.name.toLowerCase().includes(n)||s.sku.toLowerCase().includes(n)||s.brand.toLowerCase().includes(n)||s.nameKa&&s.nameKa.toLowerCase().includes(n))}return j(l)}),Q=T(()=>G(V.value)),i=T(()=>k.value?h.productById(k.value):null),P=T(()=>i.value?i.value.stock-i.value.reserved:0);function y(l){const n=l.stock-l.reserved;return n>5?"high":n>0?"medium":n===0&&l.stock>0?"low":"none"}function U(l){return{high:a("page.stock.inStock"),medium:a("page.stock.lowStock"),low:a("page.stock.outOfStock"),none:a("page.stock.unmanaged")}[l]||a("common.unknown")}const R=rt(()=>$(),400);function Y(){R()}function I(l){A(l),$()}function B(l,n){m.isConsultant||(v.value={productId:l,field:n})}function w(l,n,s){const c=s.target.tagName==="INPUT"?s.target:s.target.closest(".inline-edit")?.querySelector("input");if(c){const tt=n==="price"?parseFloat(c.value)||0:parseInt(c.value)||0;h.updateProduct(l,{[n]:tt}),S("success",a(n==="price"?"msg.priceUpdated":"msg.stockUpdated"))}v.value=null}function C(){v.value=null}function J(l){const n=_.toggleCartItem(l,h.products);S(n?"success":"info",a(n?"msg.addedToCart":"msg.removedFromCart"))}function W(l){k.value=l}function X(){k.value=null}function Z(){if(!i.value)return;const l=_.toggleCartItem(i.value.id,h.products);S(l?"success":"info",a(l?"msg.addedToCart":"msg.removedFromCart"))}return(l,n)=>(d(),r("div",null,[t("div",kt,[t("div",null,[t("h1",gt,o(e(m).isConsultant?e(a)("page.stock.consultantTitle"):e(a)("page.stock.adminTitle")),1),t("p",bt,o(e(m).isConsultant?e(a)("page.stock.consultantSubtitle"):e(a)("page.stock.adminSubtitle")),1)]),t("div",ft,[e(_).count>0?(d(),r("span",yt,o(e(a)("page.stock.inCart",{n:e(_).count})),1)):E("",!0)])]),t("div",wt,[t("div",Ct,[t("div",xt,[t("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--color-text-tertiary)"},innerHTML:e(u)("search",16)},null,8,Tt),nt(t("input",{type:"text",class:"form-input form-input--search","onUpdate:modelValue":n[0]||(n[0]=s=>f.value=s),onInput:Y,placeholder:e(a)("page.stock.searchPlaceholder"),style:{"padding-left":"36px"}},null,40,Lt),[[lt,f.value]])])])]),t("div",St,[t("table",Mt,[n[4]||(n[4]=t("colgroup",null,[t("col",{style:{width:"52px"}}),t("col",{style:{width:"220px"}}),t("col",{style:{width:"100px"}}),t("col",{style:{width:"120px"}}),t("col",{style:{width:"72px"}}),t("col",{style:{width:"82px"}}),t("col",{style:{width:"90px"}}),t("col",{style:{width:"155px"}}),t("col",{style:{width:"86px"}})],-1)),t("thead",null,[t("tr",null,[t("th",null,o(e(a)("col.image")),1),g(K,{label:e(a)("col.title"),field:"name",sortField:e(M),sortDir:e(H),onSort:I},null,8,["label","sortField","sortDir"]),t("th",null,o(e(a)("col.brand")),1),g(K,{label:e(a)("col.price"),field:"price",sortField:e(M),sortDir:e(H),onSort:I},null,8,["label","sortField","sortDir"]),g(K,{label:e(a)("col.stock"),field:"stock",sortField:e(M),sortDir:e(H),onSort:I},null,8,["label","sortField","sortDir"]),t("th",null,o(e(a)("col.reserved")),1),t("th",null,o(e(a)("col.available")),1),t("th",null,o(e(a)("col.status")),1),t("th",Ht,o(e(a)("col.actions")),1)])]),t("tbody",null,[(d(!0),r(it,null,ct(Q.value,s=>(d(),r("tr",{key:s.id},[t("td",null,[t("div",Pt,o(s.sku.slice(-3)),1)]),t("td",It,[t("div",Ft,o(s.name),1),t("div",Dt,o(s.nameKa),1),t("div",Kt,[n[2]||(n[2]=t("span",{style:{"font-weight":"var(--font-weight-medium)",color:"var(--color-text-secondary)"}},"SKU:",-1)),b(" "+o(s.sku),1)])]),t("td",zt,o(s.brand),1),t("td",null,[e(m).isConsultant?(d(),r("span",$t,o(e(F)(s.price)),1)):v.value?.productId===s.id&&v.value?.field==="price"?(d(),r("div",Nt,[t("input",{type:"number",class:"inline-edit__input",ref_for:!0,ref:c=>N(c),value:s.price,step:"0.01",min:"0",onKeydown:[L(c=>w(s.id,"price",c),["enter"]),L(C,["escape"])]},null,40,Vt),t("div",Ut,[t("button",{class:"btn btn--icon btn--sm btn--success",onClick:c=>w(s.id,"price",c)},[t("span",{innerHTML:e(u)("check",12)},null,8,Et)],8,Bt),t("button",{class:"btn btn--icon btn--sm btn--ghost",onClick:C},[t("span",{innerHTML:e(u)("x",12)},null,8,qt)])])])):(d(),r("span",{key:2,class:"inline-edit__value",onClick:c=>B(s.id,"price")},o(e(F)(s.price)),9,At))]),t("td",null,[e(m).isConsultant?(d(),r("span",jt,o(e(p)(s.stock)),1)):v.value?.productId===s.id&&v.value?.field==="stock"?(d(),r("div",Ot,[t("input",{type:"number",class:"inline-edit__input",ref_for:!0,ref:c=>N(c),value:s.stock,min:"0",onKeydown:[L(c=>w(s.id,"stock",c),["enter"]),L(C,["escape"])]},null,40,Gt),t("div",Qt,[t("button",{class:"btn btn--icon btn--sm btn--success",onClick:c=>w(s.id,"stock",c)},[t("span",{innerHTML:e(u)("check",12)},null,8,Yt)],8,Rt),t("button",{class:"btn btn--icon btn--sm btn--ghost",onClick:C},[t("span",{innerHTML:e(u)("x",12)},null,8,Jt)])])])):(d(),r("span",{key:2,class:"inline-edit__value",onClick:c=>B(s.id,"stock")},o(e(p)(s.stock)),9,Wt))]),t("td",null,o(e(p)(s.reserved)),1),t("td",Xt,o(e(p)(s.stock-s.reserved)),1),t("td",null,[t("div",{class:x(["stock-indicator",`stock-indicator--${y(s)}`])},[n[3]||(n[3]=t("span",{class:"stock-indicator__dot"},null,-1)),b(" "+o(U(y(s))),1)],2)]),t("td",Zt,[t("div",te,[t("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:c=>W(s.id),"data-tooltip":e(a)("page.stock.quickView")},[t("span",{innerHTML:e(u)("eye",14)},null,8,se)],8,ee),t("button",{class:x(["btn","btn--ghost","btn--icon","btn--sm",{"btn--primary":e(_).isInCart(s.id)}]),onClick:c=>J(s.id),"data-tooltip":e(_).isInCart(s.id)?e(a)("page.stock.inCartTooltip"):e(a)("page.stock.addToCartTooltip")},[t("span",{innerHTML:e(u)("shopping-cart",14)},null,8,ae)],10,oe)])])]))),128))])]),g(pt,{currentPage:e(z),totalPages:e(O),total:V.value.length,onPageChange:n[1]||(n[1]=s=>z.value=s)},null,8,["currentPage","totalPages","total"])]),g(mt,{visible:!!k.value,onClose:X},{header:q(()=>[b(o(e(a)("section.productDetails")),1)]),default:q(()=>[i.value?(d(),r("div",ne,[t("div",le,[t("span",{innerHTML:e(u)("package",48)},null,8,ie),t("div",ce,o(i.value.sku),1)]),t("div",de,o(i.value.name),1),t("div",re,o(i.value.nameKa),1),t("div",ue,[t("div",_e,[t("div",ve,o(e(a)("col.brand")),1),t("div",pe,o(i.value.brand),1)]),t("div",he,[n[5]||(n[5]=t("div",{class:"product-detail__meta-label"},"SKU",-1)),t("div",me,o(i.value.sku),1)]),t("div",ke,[t("div",ge,o(e(a)("col.type")),1),t("div",be,o(i.value.category),1)]),t("div",fe,[t("div",ye,o(e(a)("col.price")),1),t("div",we,o(e(F)(i.value.price)),1)])]),t("p",Ce,o(i.value.description),1),t("h4",xe,o(e(a)("section.stockBreakdown")),1),t("div",Te,[t("div",Le,[t("div",Se,o(e(p)(i.value.stock)),1),t("div",Me,o(e(a)("page.stock.total")),1)]),t("div",He,[t("div",Pe,o(e(p)(i.value.reserved)),1),t("div",Ie,o(e(a)("page.stock.reserved")),1)]),t("div",Fe,[t("div",{class:"product-detail__stock-value",style:dt({color:P.value>5?"var(--color-success)":P.value>0?"var(--color-warning)":"var(--color-danger)"})},o(e(p)(P.value)),5),t("div",De,o(e(a)("page.stock.available")),1)])]),t("div",Ke,[t("div",{class:x(["stock-indicator",`stock-indicator--${y(i.value)}`])},[n[6]||(n[6]=t("span",{class:"stock-indicator__dot"},null,-1)),b(" "+o(U(y(i.value))),1)],2)]),t("button",{class:x(["btn",e(_).isInCart(i.value.id)?"btn--danger":"btn--primary","btn--block"]),onClick:Z},[t("span",{innerHTML:e(u)("shopping-cart",16)},null,8,ze),b(" "+o(e(_).isInCart(i.value.id)?e(a)("btn.removeFromCart"):e(a)("btn.addToCart")),1)],2)])):E("",!0)]),_:1},8,["visible"])]))}};export{Ee as default};
