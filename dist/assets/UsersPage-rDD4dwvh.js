import{a as fe,u as he,m as ge,b as be,s as ye,o as u,c as d,d as e,t as a,e as t,i as g,f as V,g as p,v as y,L as ee,F as k,r as $,a6 as x,x as c,A as z,j as R,z as U,H as xe,a1 as Ue,_ as Ce,k as v,D as C,O as we,I as Te,l as De,w as Le,Q as ke,B as G}from"../gn-invoice.js";import{_ as Q,u as Ie}from"./SortableHeader-rArAiVJm.js";import{_ as Se,u as Me}from"./AppPagination-D5e3zrF_.js";import{_ as q}from"./AppBadge-BenmxPAy.js";import{_ as Ve}from"./SlidePanel-C0PmUBV1.js";import{_ as $e,I as ze}from"./InvoiceActions-ZkZBOAub.js";import{_ as Ee}from"./EmptyState-C5htIWVL.js";const Fe={class:"page-header"},Ae={class:"page-header__title"},He={class:"page-header__subtitle",style:{margin:"0"}},Pe={class:"page-header__actions"},Ne=["innerHTML"],Be={class:"filter-bar",style:{"margin-bottom":"var(--space-4)"}},Oe={style:{position:"relative",flex:"1","min-width":"250px"}},je=["innerHTML"],Re=["placeholder"],Ge={value:""},Qe=["value"],qe={key:0},Ke={key:1,class:"data-table-wrapper"},Ye={class:"data-table"},Je={class:"text-center",style:{width:"110px"}},We={class:"text-center",style:{color:"var(--color-text-tertiary)","font-size":"var(--text-sm)"}},Xe={style:{display:"flex","align-items":"center",gap:"var(--space-2)"}},Ze={class:"sidebar__user-avatar",style:{width:"30px",height:"30px","font-size":"var(--text-xs)"}},et={class:"font-medium"},tt={style:{"font-size":"var(--text-xs)",color:"var(--color-text-tertiary)"}},st={class:"font-medium"},lt={class:"text-center"},at={style:{display:"flex","align-items":"center","justify-content":"center",gap:"var(--space-1)"}},ot=["onClick","data-tooltip"],nt=["innerHTML"],it=["onClick","data-tooltip"],rt=["innerHTML"],ut=["onClick","data-tooltip"],dt=["innerHTML"],ct={class:"user-detail__header"},vt={class:"user-detail__avatar"},_t={style:{"font-size":"var(--text-lg)","font-weight":"var(--font-weight-bold)"}},mt={style:{"font-size":"var(--text-sm)",color:"var(--color-text-tertiary)"}},pt=["href"],ft=["innerHTML"],ht=["href"],gt=["innerHTML"],bt={class:"user-detail__stats"},yt={class:"user-detail__stat"},xt={class:"user-detail__stat-label"},Ut={class:"user-detail__stat-value"},Ct={class:"user-detail__stat"},wt={class:"user-detail__stat-label"},Tt={class:"user-detail__stat-value"},Dt={class:"user-detail__stat"},Lt={class:"user-detail__stat-label"},kt={class:"user-detail__stat-value"},It={class:"user-detail__stat"},St={class:"user-detail__stat-label"},Mt={style:{padding:"var(--space-5) var(--space-6)"}},Vt={style:{"margin-bottom":"var(--space-3)","font-size":"var(--text-md)"}},$t={key:0,style:{color:"var(--color-text-tertiary)","font-size":"var(--text-sm)"}},zt={key:1,class:"data-table",style:{"font-size":"var(--text-sm)"}},Et=["onClick","href"],Ft={style:{"font-size":"var(--text-xs)"}},At={class:"text-center"},Ht={style:{display:"flex","flex-direction":"column",gap:"var(--space-4)"}},Pt={class:"form-group"},Nt={class:"form-label"},Bt={class:"form-group"},Ot={class:"form-label"},jt={class:"form-group"},Rt={class:"form-label"},Gt={class:"form-group"},Qt={class:"form-label"},qt=["value"],Kt={class:"form-group"},Yt={class:"form-label"},Jt={class:"form-group"},Wt={class:"form-label"},ns={__name:"UsersPage",setup(Xt){const te=De(),f=fe(),E=he(),se=ge(),{sortField:F,sortDir:A,toggleSort:le,sortItems:ae}=Ie("_revenue","desc"),{currentPage:H,totalPages:oe,paginate:ne,resetPage:I}=Me(15),{showToast:P}=Te(),{t:o,tLabel:w}=be(),S=v(""),M=v(""),N=v(!1),h=v(null),T=v(""),D=v(""),b=v(!1),B=v(!1),L=v(null),i=v({id:null,name:"",nameEn:"",avatar:"",role:"sales",phone:"",email:""}),K=C(()=>!i.value.id),_=C(()=>{const n={};return f.invoices.filter(s=>s.status==="standard").forEach(s=>{n[s.authorId]||(n[s.authorId]={invoices:0,revenue:0,outstanding:0}),n[s.authorId].invoices++,n[s.authorId].revenue+=s.paidAmount;const l=s.totalAmount-s.paidAmount;l>0&&G(s).label!=="Sold"&&(n[s.authorId].outstanding+=l)}),n});function O(n){const s=_.value[n];return s&&s.invoices>0?s.revenue/s.invoices:0}const Y=C(()=>{let n=[...f.users];if(S.value){const s=S.value.toLowerCase();n=n.filter(l=>l.nameEn.toLowerCase().includes(s)||l.name.toLowerCase().includes(s)||l.avatar.toLowerCase().includes(s))}return M.value&&(n=n.filter(s=>s.role===M.value)),n=n.map(s=>({...s,_revenue:_.value[s.id]?.revenue||0,_invoices:_.value[s.id]?.invoices||0,_avgOrder:O(s.id)})),ae(n)}),J=C(()=>ne(Y.value)),r=C(()=>h.value?f.userById(h.value):null),W=C(()=>{if(!h.value)return[];let n=f.invoices.filter(s=>s.authorId===h.value);return T.value&&(n=n.filter(s=>s.createdAt>=T.value)),D.value&&(n=n.filter(s=>s.createdAt<=D.value)),n.sort((s,l)=>new Date(l.createdAt)-new Date(s.createdAt))}),ie=we(()=>I(),400);function re(){ie()}function j(n){le(n),I()}function ue(n){h.value=n.id,N.value=!0}function de(){N.value=!1,h.value=null,T.value="",D.value=""}function ce(){i.value={id:null,name:"",nameEn:"",avatar:"",role:"sales",phone:"",email:""},b.value=!0}function ve(n){i.value={...n},b.value=!0}function _e(){if(!i.value.nameEn.trim()||!i.value.role)return;const n=!i.value.id,s={...i.value,id:i.value.id||Date.now(),invoiceCount:0,revenue:0};f.saveUser(s),E.currentUser?.id===s.id&&(E.currentUser={...s}),b.value=!1,P("success",o(n?"msg.userAdded":"msg.userUpdated"))}function me(n){if(n.id===E.currentUser?.id){P("warning",o("msg.cannotDeleteSelf"));return}L.value=n,B.value=!0}function pe(){L.value&&(f.deleteUser(L.value.id),L.value=null,P("success",o("msg.userDeleted")))}function X(n){se.setNavReturn("/users",{selectedUserId:h.value}),te.push(`/invoices/${n}`)}return ye(()=>i.value.nameEn,n=>{i.value.id||(i.value.avatar=n.trim().split(/\s+/).map(s=>s[0]||"").join("").toUpperCase().slice(0,2))}),(n,s)=>(u(),d("div",null,[e("div",Fe,[e("div",null,[e("h1",Ae,a(t(o)("page.users.title")),1),e("p",He,a(t(o)("page.users.subtitle")),1)]),e("div",Pe,[e("button",{class:"btn btn--primary",onClick:ce},[e("span",{innerHTML:t(g)("user-plus",16)},null,8,Ne),V(" "+a(t(o)("btn.addUser")),1)])])]),e("div",Be,[e("div",Oe,[e("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--color-text-tertiary)"},innerHTML:t(g)("search",16)},null,8,je),p(e("input",{type:"text",class:"form-input form-input--search","onUpdate:modelValue":s[0]||(s[0]=l=>S.value=l),onInput:re,placeholder:t(o)("page.users.searchPlaceholder"),style:{"padding-left":"36px"}},null,40,Re),[[y,S.value]])]),p(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=l=>M.value=l),onChange:s[2]||(s[2]=(...l)=>t(I)&&t(I)(...l)),style:{"min-width":"160px"}},[e("option",Ge,a(t(o)("filter.allRoles")),1),(u(!0),d(k,null,$(t(x),(l,m)=>(u(),d("option",{key:m,value:m},a(t(w)(l)),9,Qe))),128))],544),[[ee,M.value]])]),J.value.length===0?(u(),d("div",qe,[c(Ee,{title:t(o)("page.users.notFound"),message:t(o)("page.users.adjustFilter")},null,8,["title","message"])])):(u(),d("div",Ke,[e("table",Ye,[e("thead",null,[e("tr",null,[s[15]||(s[15]=e("th",{style:{width:"40px"}},"#",-1)),e("th",null,a(t(o)("col.user")),1),e("th",null,a(t(o)("col.role")),1),c(Q,{label:t(o)("col.invoices"),field:"_invoices",sortField:t(F),sortDir:t(A),onSort:j},null,8,["label","sortField","sortDir"]),c(Q,{label:t(o)("col.revenue"),field:"_revenue",sortField:t(F),sortDir:t(A),onSort:j},null,8,["label","sortField","sortDir"]),c(Q,{label:t(o)("col.average"),field:"_avgOrder",sortField:t(F),sortDir:t(A),onSort:j},null,8,["label","sortField","sortDir"]),e("th",Je,a(t(o)("col.actions")),1)])]),e("tbody",null,[(u(!0),d(k,null,$(J.value,(l,m)=>(u(),d("tr",{key:l.id},[e("td",We,a((t(H)-1)*15+m+1),1),e("td",null,[e("div",Xe,[e("div",Ze,a(l.avatar),1),e("div",null,[e("div",et,a(l.nameEn),1),e("div",tt,a(l.name),1)])])]),e("td",null,[c(q,{label:t(w)(t(x)[l.role]),color:t(x)[l.role]?.color||"neutral"},null,8,["label","color"])]),e("td",null,a(_.value[l.id]?.invoices||0),1),e("td",st,a(t(U)(_.value[l.id]?.revenue||0)),1),e("td",null,a(t(U)(O(l.id))),1),e("td",lt,[e("div",at,[e("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:Z=>ue(l),"data-tooltip":t(o)("section.userDetails")},[e("span",{innerHTML:t(g)("eye",14)},null,8,nt)],8,ot),e("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:Z=>ve(l),"data-tooltip":t(o)("btn.edit")},[e("span",{innerHTML:t(g)("edit",14)},null,8,rt)],8,it),e("button",{class:"btn btn--ghost btn--icon btn--sm",onClick:Z=>me(l),"data-tooltip":t(o)("btn.delete"),style:{color:"var(--color-danger)"}},[e("span",{innerHTML:t(g)("trash-2",14)},null,8,dt)],8,ut)])])]))),128))])]),c(Se,{currentPage:t(H),totalPages:t(oe),total:Y.value.length,onPageChange:s[3]||(s[3]=l=>H.value=l)},null,8,["currentPage","totalPages","total"])])),c(Ve,{visible:N.value,onClose:de,size:"lg"},{header:z(()=>[V(a(t(o)("section.userDetails")),1)]),default:z(()=>[r.value?(u(),d(k,{key:0},[e("div",ct,[e("div",vt,a(r.value.avatar),1),e("div",null,[e("div",_t,a(r.value.nameEn),1),e("div",mt,a(r.value.name),1),c(q,{label:t(w)(t(x)[r.value.role]),color:t(x)[r.value.role]?.color||"neutral",style:{"margin-top":"var(--space-1)"}},null,8,["label","color"]),r.value.phone?(u(),d("a",{key:0,href:`tel:${r.value.phone}`,style:{display:"flex","align-items":"center",gap:"6px","font-size":"var(--text-sm)",color:"var(--color-text-secondary)","text-decoration":"none","margin-top":"var(--space-2)"}},[e("span",{innerHTML:t(g)("phone",14)},null,8,ft),V(a(r.value.phone),1)],8,pt)):R("",!0),r.value.email?(u(),d("a",{key:1,href:`mailto:${r.value.email}`,style:{display:"flex","align-items":"center",gap:"6px","font-size":"var(--text-sm)",color:"var(--color-text-secondary)","text-decoration":"none","margin-top":"2px"}},[e("span",{innerHTML:t(g)("mail",14)},null,8,gt),V(a(r.value.email),1)],8,ht)):R("",!0)])]),e("div",bt,[e("div",yt,[e("div",xt,a(t(o)("page.users.invoicesCreated")),1),e("div",Ut,a(_.value[r.value.id]?.invoices||0),1)]),e("div",Ct,[e("div",wt,a(t(o)("page.users.revenueGenerated")),1),e("div",Tt,a(t(U)(_.value[r.value.id]?.revenue||0)),1)]),e("div",Dt,[e("div",Lt,a(t(o)("page.users.avgOrderValue")),1),e("div",kt,a(t(U)(O(r.value.id))),1)]),e("div",It,[e("div",St,a(t(o)("page.users.outstandingBal")),1),e("div",{class:xe(["user-detail__stat-value",(_.value[r.value.id]?.outstanding||0)>0?"text-danger":""])},a(t(U)(_.value[r.value.id]?.outstanding||0)),3)])]),e("div",Mt,[e("h4",Vt,a(t(o)("section.invoiceHistory")),1),c($e,{dateFrom:T.value,"onUpdate:dateFrom":s[4]||(s[4]=l=>T.value=l),dateTo:D.value,"onUpdate:dateTo":s[5]||(s[5]=l=>D.value=l),prefix:"user-panel",onChange:()=>{}},null,8,["dateFrom","dateTo"]),s[17]||(s[17]=e("div",{style:{"margin-bottom":"var(--space-4)"}},null,-1)),W.value.length===0?(u(),d("p",$t,a(t(o)("page.users.noInvoices")),1)):(u(),d("table",zt,[e("thead",null,[e("tr",null,[e("th",null,a(t(o)("col.invoiceNumber")),1),e("th",null,a(t(o)("col.date")),1),e("th",null,a(t(o)("col.customer")),1),e("th",null,a(t(o)("col.total")),1),e("th",null,a(t(o)("col.status")),1),s[16]||(s[16]=e("th",{class:"text-center",style:{width:"40px"}},null,-1))])]),e("tbody",null,[(u(!0),d(k,null,$(W.value,l=>(u(),d("tr",{key:l.id},[e("td",null,[e("a",{onClick:Le(m=>X(l.id),["prevent"]),href:`#/invoices/${l.id}`,class:"font-medium"},a(l.number),9,Et)]),e("td",null,a(t(ke)(l.createdAt)),1),e("td",Ft,a(t(f).customerById(l.customerId)?.nameEn||"—"),1),e("td",null,a(t(U)(l.totalAmount)),1),e("td",null,[c(q,{label:t(w)(t(G)(l)),color:t(G)(l).color,dot:!0},null,8,["label","color"])]),e("td",At,[c(ze,{compact:"",invoice:l,onView:m=>X(l.id)},null,8,["invoice","onView"])])]))),128))])]))])],64)):R("",!0)]),_:1},8,["visible"]),c(Ue,{visible:b.value,"onUpdate:visible":s[13]||(s[13]=l=>b.value=l),title:K.value?t(o)("page.users.addTitle"):t(o)("page.users.editTitle"),size:"sm"},{footer:z(()=>[e("button",{class:"btn btn--ghost",onClick:s[12]||(s[12]=l=>b.value=!1)},a(t(o)("btn.cancel")),1),e("button",{class:"btn btn--primary",onClick:_e},a(K.value?t(o)("btn.saveUser"):t(o)("btn.updateUser")),1)]),default:z(()=>[e("div",Ht,[e("div",Pt,[e("label",Nt,a(t(o)("form.fullNameKa")),1),p(e("input",{type:"text",class:"form-input","onUpdate:modelValue":s[6]||(s[6]=l=>i.value.name=l),placeholder:"e.g. გიორგი ნოზაძე"},null,512),[[y,i.value.name]])]),e("div",Bt,[e("label",Ot,a(t(o)("form.fullNameEn")),1),p(e("input",{type:"text",class:"form-input","onUpdate:modelValue":s[7]||(s[7]=l=>i.value.nameEn=l),placeholder:"e.g. Giorgi Nozadze"},null,512),[[y,i.value.nameEn]])]),e("div",jt,[e("label",Rt,a(t(o)("form.avatar")),1),p(e("input",{type:"text",class:"form-input","onUpdate:modelValue":s[8]||(s[8]=l=>i.value.avatar=l),maxlength:"2",placeholder:"GN",style:{"text-transform":"uppercase"}},null,512),[[y,i.value.avatar]])]),e("div",Gt,[e("label",Qt,a(t(o)("form.role")),1),p(e("select",{class:"form-select","onUpdate:modelValue":s[9]||(s[9]=l=>i.value.role=l)},[(u(!0),d(k,null,$(t(x),(l,m)=>(u(),d("option",{key:m,value:m},a(t(w)(l)),9,qt))),128))],512),[[ee,i.value.role]])]),e("div",Kt,[e("label",Yt,a(t(o)("col.phone")),1),p(e("input",{type:"tel",class:"form-input","onUpdate:modelValue":s[10]||(s[10]=l=>i.value.phone=l),placeholder:"+995 599 000 000"},null,512),[[y,i.value.phone]])]),e("div",Jt,[e("label",Wt,a(t(o)("col.email")),1),p(e("input",{type:"email",class:"form-input","onUpdate:modelValue":s[11]||(s[11]=l=>i.value.email=l),placeholder:"name@company.ge"},null,512),[[y,i.value.email]])])])]),_:1},8,["visible","title"]),c(Ce,{visible:B.value,"onUpdate:visible":s[14]||(s[14]=l=>B.value=l),title:t(o)("msg.titleDeleteUser"),message:t(o)("msg.confirmDeleteUser",{name:L.value?.nameEn||"this user"}),danger:!0,onConfirm:pe},null,8,["visible","title","message"])]))}};export{ns as default};
